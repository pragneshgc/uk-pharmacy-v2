const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Modal-PiY0E_4J.js","assets/app-82NRaNNR.js","assets/app-DWMI0VDG.css"])))=>i.map(i=>d[i]);
import{_ as k,s as _,u as g,d as v,E as C,C as P,e as O,o as r,c as l,a as e,F as p,f,n as u,g as c,t as n,b as a,h as I,i as S,j as b,k as w,l as A}from"./app-82NRaNNR.js";const D={setup(){const{checked:t,visible:s,tray:d}=_(g()),{replaceChecked:m}=g();return{checked:t,visible:s,tray:d,replaceChecked:m}},components:{Modal:v(()=>A(()=>import("./Modal-PiY0E_4J.js"),__vite__mapDeps([0,1,2])))},mixins:[C,P],data:function(){return{statistics:{},pendingPrescriberCount:0,pendingPharmacyOrdersCount:0,pendingPharmacyOrders:[],onHoldOrders:[],pendingOrderAlerts:[],loadingPendingPharmacy:!1,loaded:!1,orderFilter:this.$route.query.orderFilter||localStorage.getItem("dashboard.orderFilter")?localStorage.getItem("dashboard.orderFilter"):userInfo.role==20||userInfo.role==19?"approved":"new",checkboxStatus:!1,duplicateReference:0,userInfo,mapping:{safety:"safety check",new:"new",approved:"approved",dpd:"dpd",ups:"ups",dhl:"dhl",rml:"rml",awaiting:"awaiting shipped",shipped:"shipped",onhold:"onhold",queried:"queried",rejected:"rejected",cancelled:"cancelled",return:"returned"},roleVisibility:{60:[],50:[],40:[],35:[],30:[],29:[],25:[],20:[],19:[],10:[],5:[]},countTimer:null}},computed:{match(){return this.checked.length==0?!1:this.visible.every(t=>this.checked.indexOf(t)>=0)},currentChecked(){return this.checked.length==0?!1:this.checked.some(t=>this.visible.indexOf(t)>=0)},trayLength(){return this.tray.length}},mounted(){this.getStatistics(),this.getCount(),this.getOrderAlerts(),this.getOnHoldOrders(),this.emitter.on("changefilter",t=>{this.orderFilter=t.filter}),this.emitter.on("orderupdate",this.getOrderAlerts)},destroyed(){this.emitter.off("changefilter"),this.emitter.off("orderupdate"),clearInterval(this.countTimer)},methods:{getStatistics(){axios.get("/statistics").then(t=>{this.statistics=t.data.data,this.statistics.total=t.data.data.total,this.loaded=!0}).catch(t=>{this.postError(t.response.data.message)})},getCount(t=!1){this.loadingPendingPharmacy=!0,t?(this.getOrderAlerts(),this.checkOrders(()=>{this.getCount(),this.getOnHoldOrders(),this.emitter.emit("alertupdate")})):axios.get("/api/check-orders/results").then(s=>{this.pendingPrescriberCount=s.data.data.pendingPrescriberCount,this.pendingPharmacyOrders=s.data.data.pendingPharmacyOrders,this.pendingPharmacyOrdersCount=s.data.data.pendingPharmacyOrdersCount}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loadingPendingPharmacy=!1,this.emitter.emit("alertupdate")})},getOrderAlerts(){axios.get("/note/pending-alerts").then(t=>{this.pendingOrderAlerts=t.data.data}).catch(t=>{this.postError(t.response.data.message)})},getOnHoldOrders(){axios.get("/orders/on-hold-postponed").then(t=>{this.onHoldOrders=t.data.data}).catch(t=>{this.postError(t.response.data.message)})},deleteNote(t){this.$swal({title:"Delete Alert",html:"Are you sure you want to delete this alert?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(s=>{s.value&&axios.post("/note/"+t+"/delete").then(d=>{this.postSuccess(d.data.message)}).catch(d=>{this.postError(d.response.data.message)}).finally(()=>{this.getOrderAlerts(),this.emitter.emit("alertupdate")})})},editNote(t=!1){this.emitter.emit("modal.open","note",t)},getPendingCSV(){let t=[];this.pendingPharmacyOrders.forEach(s=>{t.push({ReferenceNumber:s.Value})}),this.exportCSV(t,`Pending Pharmacy Orders ${new Date().toLocaleString()}`)},checkOrders(t=!1){axios.get("/api/check-orders").then(s=>{t&&t()}).catch(s=>{this.postError(s.response.data.data),this.loadingPendingPharmacy=!1})},redirectCallback(){this.orderFilter=="new"&&this.trayLength<1&&(this.userInfo.role==30||this.userInfo.role==35||this.userInfo.role==29)&&axios.post("/tray/new/insert/20").then(t=>{this.postSuccess(t.data.message),this.emitter.emit("tray.refresh")}).catch(t=>{this.postError(t.response.data.message)})},changeOrder(t){t=="queried"?localStorage.setItem("dashboard.orderFilter",t):localStorage.setItem("dashboard.orderFilter",this.userInfo.role==20||this.userInfo.role==19?"approved":"new"),this.orderFilter=t,this.getStatistics(),this.getCount()},addToTray(){axios.post("/tray",{PrescriptionID:this.checked}).then(t=>{this.postSuccess(t.data.message),this.replaceChecked([]),this.emitter.emit("tray.refresh"),this.emitter.emit("table.refresh")}).catch(t=>{this.postError(t.response.data.message)})},safe(t){axios.post(`/order-edit/${t}/status`,{status:1}).then(s=>{this.emitter.emit("table.refresh")}).catch(s=>{this.emitter.emit("table.refresh"),this.postError(s.response.data.message)}).finally(()=>{this.getStatistics()})},checkAll(t=!1){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&limit=${t}`).then(s=>{this.replaceChecked(s.data.data)}).catch(s=>{this.postError(s.response.data.message)})},checkByProperty(t,s){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&type=${t}&property=${s}`).then(d=>{this.replaceChecked(d.data.data)}).catch(d=>{this.postError(d.response.data.message)})},checkAllVisible(){this.currentChecked&&!this.match?this.emitter.emit("table.uncheck.all"):this.currentChecked&&this.match?this.emitter.emit("table.uncheck.all"):this.emitter.emit("table.check.all")},clearChecked(){this.checkboxStatus=!1,this.replaceChecked([])},viewOrder(t){this.$router.push({name:"prescription",params:{id:t}})}}},N={class:"content"},E={class:"prescriptionStats flex-center"},R=e("div",{class:"title flex-align-center"},"Order Statistics",-1),T={class:"list"},F={key:0},B=["onClick"],V=e("span",null,"Alert",-1),H={key:1,style:{overflow:"hidden"}},$=e("li",null,[e("div",{class:"loader loader-relative",style:{}},"Loading...")],-1),L=[$],M={key:0,class:"total flex-align-center clickable"},j=e("span",null,"Total",-1),G=e("a",{href:'/orders/csv?page=1&limit=1000&f={"dashboard": true}&strict=true',class:"btn smallTextBtn secondaryBtn",title:"Download dashboard orders"},"Download",-1),q={class:"orderSearch"},z={class:"row check-row"},Y={class:"button-group"},U=["checked"],J=e("label",{for:"checkall"},null,-1),K={class:"btn btnSize02 secondaryBtn dropdown"},Q=e("i",{"aria-hidden":"true",class:"fa fa-caret-down"},null,-1),W={class:"dropdown-menu"},X=e("li",null,[e("hr")],-1),Z=e("li",null,[e("hr")],-1),x=e("li",null,[e("hr")],-1),ee={key:0,class:"check-options"},te={key:0},se={key:1},oe=["onClick"],re={key:1,class:"card prescription-pool"},le={class:"card-body order-id-list"},ie={class:"pool-list-title pb-10",style:{display:"flex","justify-content":"space-between","align-items":"center"}},ne=e("i",{"aria-hidden":"true",class:"fa fa-file"},null,-1),ae=[ne],de={key:0,class:"pool-list-layout"},ce=e("div",{class:"pool-column"},[e("b",null,"Reference Number")],-1),he=e("div",{class:"pool-column"},[e("b",null,"Client")],-1),ue=e("div",{class:"pool-column"},[e("b",null,"Status")],-1),pe=[ce,he,ue],me={class:"pool-column"},fe={class:"pool-column"},ge=e("div",{class:"pool-column"},[e("b",null,"Pending")],-1),be={key:0},ye=e("li",{class:"pool-list-title"},[e("b",null,"NO PENDING PHARMACY ORDERS FOUND")],-1),ke=[ye],_e={class:"mt-10"},ve={class:"pool-list-title pb-10",style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ce={key:0,class:"pool-list-layout"},Pe=w('<div class="pool-column"><b>ID</b></div><div class="pool-column"><b>Reference Number</b></div><div class="pool-column"><b>Postponed At</b></div><div class="pool-column"><b>Postponed By</b></div><div class="pool-column">Tools</div>',5),Oe=[Pe],Ie={class:"pool-column"},Se={class:"pool-column"},we=["innerHTML"],Ae={class:"pool-column"},De={class:"pool-column"},Ne={class:"pool-column"},Ee=["href"],Re=e("i",{"aria-hidden":"true",class:"fa fa-search-plus"},null,-1),Te=[Re],Fe={class:"mt-10"},Be={class:"pool-list-title pb-10",style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ve={key:0,class:"pool-list-layout"},He=e("div",{class:"pool-column"},[e("b",null,"Reference Number")],-1),$e=e("div",{class:"pool-column"},[e("b",null,"Note")],-1),Le=e("div",{class:"pool-column"},[e("b",null,"Created By")],-1),Me=e("div",{class:"pool-column"},[e("b",null,"Created At")],-1),je={key:0,class:"pool-column"},Ge={class:"pool-column"},qe={key:0},ze=e("br",null,null,-1),Ye=e("small",null,"Reference number not set",-1),Ue={key:1},Je={class:"pool-column"},Ke=["innerHTML"],Qe={class:"pool-column"},We={class:"pool-column"},Xe={key:0,class:"pool-column"},Ze=["onClick"],xe=e("i",{"aria-hidden":"true",class:"fa fa-edit"},null,-1),et=[xe],tt=["onClick"],st=e("i",{"aria-hidden":"true",class:"fa fa-trash"},null,-1),ot=[st];function rt(t,s,d,m,lt,i){const y=O("data-table");return r(),l("div",null,[e("div",N,[e("section",null,[e("div",E,[R,e("div",T,[t.loaded?(r(),l("ul",F,[(r(!0),l(p,null,f(t.statistics.statistics,(o,h)=>(r(),l(p,null,[t.roleVisibility[t.userInfo.role].includes(h)?a("",!0):(r(),l("li",{key:0,class:u(["list-item-background",{active:h==t.orderFilter}]),onClick:it=>i.changeOrder(h)},[e("span",null,n(t.mapping[h]),1),c(n(o),1)],10,B))],64))),256)),t.roleVisibility[t.userInfo.role].includes("ordercount")?a("",!0):(r(),l("li",{key:0,class:u([[t.orderFilter=="ordercount"?"active":"",t.pendingPharmacyOrdersCount>0?"blink_me":""],"list-item-background"]),onClick:s[0]||(s[0]=o=>{t.orderFilter="ordercount"})},[V,c(n(t.pendingPharmacyOrdersCount),1)],2))])):(r(),l("ul",H,L))]),t.loaded?(r(),l("div",M,[j,c(" "+n(t.statistics.total)+" ",1),G])):a("",!0)])]),e("section",null,[e("div",q,[t.orderFilter!="ordercount"?(r(),I(y,{key:0,"data-url":"/orders","column-class":"col-lg-12","table-title":"InTray","redirect-name":"prescription","redirect-id":"PrescriptionID",filters:t.orderFilter,"redirect-callback":i.redirectCallback,"checkbox-visible":t.orderFilter=="new"&&[29,30,35].includes(t.userInfo.role),"hidden-columns":["checked","disabled","UPSAccessPointAddress"],"not-orderable":["Products"],"column-map":{PrescriptionID:"ID",DeliveryID:"Courier",CompanyName:"Client",ReferenceNumber:"Ref"}},S({_:2},[t.orderFilter=="new"&&[29,30,35].includes(t.userInfo.role)?{name:"filters",fn:b(()=>[e("div",z,[e("div",Y,[e("div",{class:"btn btnSize02 secondaryBtn",onClick:s[1]||(s[1]=o=>i.checkAllVisible())},[e("input",{class:u({unchecked:!i.match&&i.currentChecked}),checked:i.match||i.currentChecked,type:"checkbox",name:"checkall"},null,10,U),J]),e("div",K,[Q,e("ul",W,[e("li",{onClick:s[2]||(s[2]=o=>i.checkAll()),class:"dropdown-menu-item"}," Check All In "+n(t.orderFilter),1),e("li",{onClick:s[3]||(s[3]=o=>i.checkAll(10)),class:"dropdown-menu-item"}," Check 10 "),e("li",{onClick:s[4]||(s[4]=o=>i.checkAll(20)),class:"dropdown-menu-item"}," Check 20 "),e("li",{onClick:s[5]||(s[5]=o=>i.checkAll(50)),class:"dropdown-menu-item"}," Check 50 "),e("li",{onClick:s[6]||(s[6]=o=>i.checkAll(100)),class:"dropdown-menu-item"}," Check 100 "),X,e("li",{onClick:s[7]||(s[7]=o=>i.checkByProperty("delivery",4)),class:"dropdown-menu-item"}," Check DPD "),e("li",{onClick:s[8]||(s[8]=o=>i.checkByProperty("delivery",5)),class:"dropdown-menu-item"}," Check RM "),Z,e("li",{onClick:s[9]||(s[9]=o=>i.checkByProperty("client",50)),class:"dropdown-menu-item"}," Check Treated "),e("li",{onClick:s[10]||(s[10]=o=>i.checkByProperty("client",51)),class:"dropdown-menu-item"}," Check EveAdam "),e("li",{onClick:s[11]||(s[11]=o=>i.checkByProperty("client",49)),class:"dropdown-menu-item"}," Check Apport Sarl "),x,e("li",{onClick:s[12]||(s[12]=o=>i.clearChecked()),class:"dropdown-menu-item"}," Clear checked ")])])]),m.checked.length>0?(r(),l("div",ee,[e("button",{onClick:s[13]||(s[13]=o=>i.addToTray()),class:"btn btnSize02 secondaryBtn"},[t.userInfo.role==20||t.userInfo.role==19?(r(),l("span",te,"Take over")):(r(),l("span",se,"Add To Tray")),c(" ("+n(m.checked.length)+" orders) ",1)])])):a("",!0)])]),key:"0"}:void 0,t.orderFilter=="safety"&&t.userInfo.role==40?{name:"tools",fn:b(o=>[e("a",{class:"btn btn-primary waves-effect table-icon clickable",onClick:h=>i.safe(o.id)}," Safe ",8,oe)]),key:"1"}:void 0]),1032,["filters","redirect-callback","checkbox-visible"])):t.orderFilter=="ordercount"?(r(),l("div",re,[e("div",le,[e("ul",null,[e("li",ie,[e("b",null,[c("MISSING PHARMACY ORDERS "),e("span",{class:u(["badge",[t.pendingPharmacyOrders.length>0?"red":""]])},n(t.pendingPharmacyOrders.length),3)]),e("div",null,[e("button",{class:"btn btn-primary table-icon",title:"Download CSV with a list of reference numbers",onClick:s[14]||(s[14]=o=>i.getPendingCSV())},ae),e("button",{class:"btn btn-primary table-icon",title:"Refresh the pending pharmacy orders list manually",onClick:s[15]||(s[15]=o=>i.getCount(!0))},[e("i",{class:u(["fa fa-refresh",[t.loadingPendingPharmacy?"spin-animation":""]])},null,2)])])]),t.pendingPharmacyOrders.length>0?(r(),l("li",de,pe)):a("",!0),(r(!0),l(p,null,f(t.pendingPharmacyOrders,o=>(r(),l("li",{class:"pool-list-layout",key:o.SyncOrderID},[e("div",me,n(o.Value),1),e("div",fe,[e("span",null,n(o.CompanyName),1)]),ge]))),128))]),t.pendingPharmacyOrdersCount+t.pendingPrescriberCount==0?(r(),l("ul",be,ke)):a("",!0),e("ul",_e,[e("li",ve,[e("b",null,[c("POSTPONED SHIPPING ORDERS PENDING "),e("span",{class:u(["badge",[t.onHoldOrders.length>0?"red":""]])},n(t.onHoldOrders.length),3)])]),t.onHoldOrders.length>0?(r(),l("li",Ce,Oe)):a("",!0),(r(!0),l(p,null,f(t.onHoldOrders,o=>(r(),l("li",{class:"pool-list-layout",key:o.PrescriptionID},[e("div",Ie,[e("b",null,n(o.PrescriptionID),1)]),e("div",Se,[e("div",{innerHTML:o.ReferenceNumber},null,8,we)]),e("div",Ae,n(o.PostponedAt),1),e("div",De,n(o.PostponedBy),1),e("div",Ne,[e("a",{title:"View Order",class:"btn btn-primary table-icon",target:"_blank",href:`#/prescription/${o.PrescriptionID}`},Te,8,Ee)])]))),128))]),e("ul",Fe,[e("li",Be,[e("b",null,[c("PENDING ORDER ALERTS "),e("span",{class:u(["badge",[t.pendingOrderAlerts.length>0?"red":""]])},n(t.pendingOrderAlerts.length),3)]),e("div",null,[e("button",{title:"Create an alert for a prescription that is not yet imported on ESA",onClick:s[16]||(s[16]=o=>{t.$root.$emit("modal.open","note","preimport")}),class:"btn btn-primary table-icon"}," Create Alert ")])]),t.pendingOrderAlerts.length>0?(r(),l("li",Ve,[He,$e,Le,Me,t.userInfo.role>=40?(r(),l("div",je,"Tools")):a("",!0)])):a("",!0),(r(!0),l(p,null,f(t.pendingOrderAlerts,o=>(r(),l("li",{class:"pool-list-layout",key:o.NoteID},[e("div",Ge,[o.Subscription?(r(),l("div",qe,[e("small",null,[c("Subscription ID: "),e("b",null,n(o.Subscription),1)]),ze,Ye])):(r(),l("b",Ue,n(o.ReferenceNumber),1))]),e("div",Je,[e("div",{innerHTML:o.Note},null,8,Ke)]),e("div",Qe,n(o.name)+" "+n(o.surname),1),e("div",We,n(o.CreatedAt),1),t.userInfo.role>=40?(r(),l("div",Xe,[e("button",{title:"Edit alert",class:"btn btn-primary table-icon",onClick:h=>i.editNote(o)},et,8,Ze),e("button",{title:"Delete this alert",class:"btn btn-primary table-icon",onClick:h=>i.deleteNote(o.NoteID)},ot,8,tt)])):a("",!0)]))),128))])])])):a("",!0)])])])])}const at=k(D,[["render",rt]]);export{at as default};
//# sourceMappingURL=Dashboard-BtfHFoxP.js.map
