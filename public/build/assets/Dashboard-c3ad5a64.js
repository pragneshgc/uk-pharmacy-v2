import{n as a,_ as o,E as n,C as l}from"./app-a3e6dddd.js";const c={components:{Modal:()=>o(()=>import("./Modal-76bda924.js"),["assets/Modal-76bda924.js","assets/app-a3e6dddd.js","assets/app-7eda0943.css"])},mixins:[n,l],data:function(){return{statistics:{},pendingPrescriberCount:0,pendingPharmacyOrdersCount:0,pendingPharmacyOrders:[],onHoldOrders:[],pendingOrderAlerts:[],loadingPendingPharmacy:!1,loaded:!1,orderFilter:this.$route.query.orderFilter||localStorage.getItem("dashboard.orderFilter")?localStorage.getItem("dashboard.orderFilter"):userInfo.role==20||userInfo.role==19?"approved":"new",checkboxStatus:!1,duplicateReference:0,userInfo,mapping:{safety:"safety check",new:"new",approved:"approved",dpd:"dpd",ups:"ups",dhl:"dhl",rml:"rml",awaiting:"awaiting shipped",shipped:"shipped",onhold:"onhold",queried:"queried",rejected:"rejected",cancelled:"cancelled",return:"returned"},roleVisibility:{60:[],50:[],40:[],35:[],30:[],29:[],25:[],20:[],19:[],10:[],5:[]},countTimer:null}},computed:{checked(){return this.$store.state.checked},visible(){return this.$store.state.visible},match(){return this.checked.length==0?!1:this.visible.every(s=>this.checked.indexOf(s)>=0)},currentChecked(){return this.checked.length==0?!1:this.checked.some(s=>this.visible.indexOf(s)>=0)},trayLength(){return this.$store.state.tray.length}},mounted(){this.getStatistics(),this.getCount(),this.getOrderAlerts(),this.getOnHoldOrders(),this.$root.$on("changefilter",s=>{this.orderFilter=s.filter}),this.$root.$on("orderupdate",this.getOrderAlerts)},destroyed(){this.$root.$off("changefilter"),this.$root.$off("orderupdate"),clearInterval(this.countTimer)},methods:{getStatistics(){axios.get("/statistics").then(s=>{this.statistics=s.data.data,this.statistics.total=s.data.data.total,this.loaded=!0}).catch(s=>{this.postError(s.response.data.message)})},getCount(s=!1){this.loadingPendingPharmacy=!0,s?(this.getOrderAlerts(),this.checkOrders(()=>{this.getCount(),this.getOnHoldOrders(),this.$root.$emit("alertupdate")})):axios.get("/api/check-orders/results").then(t=>{this.pendingPrescriberCount=t.data.data.pendingPrescriberCount,this.pendingPharmacyOrders=t.data.data.pendingPharmacyOrders,this.pendingPharmacyOrdersCount=t.data.data.pendingPharmacyOrdersCount}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.loadingPendingPharmacy=!1,this.$root.$emit("alertupdate")})},getOrderAlerts(){axios.get("/note/pending-alerts").then(s=>{this.pendingOrderAlerts=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},getOnHoldOrders(){axios.get("/orders/on-hold-postponed").then(s=>{this.onHoldOrders=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},deleteNote(s){this.$swal({title:"Delete Alert",html:"Are you sure you want to delete this alert?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(t=>{t.value&&axios.post("/note/"+s+"/delete").then(e=>{this.postSuccess(e.data.message)}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.getOrderAlerts(),this.$root.$emit("alertupdate")})})},editNote(s=!1){this.$root.$emit("modal.open","note",s)},getPendingCSV(){let s=[];this.pendingPharmacyOrders.forEach(t=>{s.push({ReferenceNumber:t.Value})}),this.exportCSV(s,`Pending Pharmacy Orders ${new Date().toLocaleString()}`)},checkOrders(s=!1){axios.get("/api/check-orders").then(t=>{s&&s()}).catch(t=>{this.postError(t.response.data.data),this.loadingPendingPharmacy=!1})},redirectCallback(){this.orderFilter=="new"&&this.trayLength<1&&(this.userInfo.role==30||this.userInfo.role==35||this.userInfo.role==29)&&axios.post("/tray/new/insert/20").then(s=>{this.postSuccess(s.data.message),this.$root.$emit("tray.refresh")}).catch(s=>{this.postError(s.response.data.message)})},changeOrder(s){s=="queried"?localStorage.setItem("dashboard.orderFilter",s):localStorage.setItem("dashboard.orderFilter",this.userInfo.role==20||this.userInfo.role==19?"approved":"new"),this.orderFilter=s,this.getStatistics(),this.getCount()},addToTray(){axios.post("/tray",{PrescriptionID:this.checked}).then(s=>{this.postSuccess(s.data.message),this.$store.commit("replaceChecked",[]),this.$root.$emit("tray.refresh"),this.$root.$emit("table.refresh")}).catch(s=>{this.postError(s.response.data.message)})},safe(s){axios.post(`/order-edit/${s}/status`,{status:1}).then(t=>{this.$root.$emit("table.refresh")}).catch(t=>{this.$root.$emit("table.refresh"),this.postError(t.response.data.message)}).finally(()=>{this.getStatistics()})},checkAll(s=!1){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&limit=${s}`).then(t=>{this.$store.commit("replaceChecked",t.data.data)}).catch(t=>{this.postError(t.response.data.message)})},checkByProperty(s,t){axios.get(`/orders/ids?f=${this.orderFilter}&intray=false&type=${s}&property=${t}`).then(e=>{this.$store.commit("replaceChecked",e.data.data)}).catch(e=>{this.postError(e.response.data.message)})},checkAllVisible(){this.currentChecked&&!this.match?this.$root.$emit("table.uncheck.all"):this.currentChecked&&this.match?this.$root.$emit("table.uncheck.all"):this.$root.$emit("table.check.all")},clearChecked(){this.checkboxStatus=!1,this.$store.commit("replaceChecked",[])},viewOrder(s){this.$router.push({name:"prescription",params:{id:s}})}}};var d=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"content"},[e("section",[e("div",{staticClass:"prescriptionStats flex-center"},[e("div",{staticClass:"title flex-align-center"},[t._v("Order Statistics")]),e("div",{staticClass:"list"},[t.loaded?e("ul",[t._l(t.statistics.statistics,function(r,i){return t.roleVisibility[t.userInfo.role].includes(i)?t._e():e("li",{staticClass:"list-item-background",class:{active:i==t.orderFilter},on:{click:function(p){return t.changeOrder(i)}}},[e("span",[t._v(t._s(t.mapping[i]))]),t._v(t._s(r)+" ")])}),t.roleVisibility[t.userInfo.role].includes("ordercount")?t._e():e("li",{staticClass:"list-item-background",class:[t.orderFilter=="ordercount"?"active":"",t.pendingPharmacyOrdersCount>0?"blink_me":""],on:{click:function(r){t.orderFilter="ordercount"}}},[e("span",[t._v("Alert")]),t._v(t._s(t.pendingPharmacyOrdersCount)+" ")])],2):e("ul",{staticStyle:{overflow:"hidden"}},[t._m(0)])]),t.loaded?e("div",{staticClass:"total flex-align-center clickable"},[e("span",[t._v("Total")]),t._v(" "+t._s(t.statistics.total)+" "),e("a",{staticClass:"btn smallTextBtn secondaryBtn",attrs:{href:'/orders/csv?page=1&limit=1000&f={"dashboard": true}&strict=true',title:"Download dashboard orders"}},[t._v("Download")])]):t._e()])]),e("section",[e("div",{staticClass:"orderSearch"},[t.orderFilter!="ordercount"?e("data-table",{attrs:{"data-url":"/orders","column-class":"col-lg-12","table-title":"InTray","redirect-name":"prescription","redirect-id":"PrescriptionID",filters:t.orderFilter,"redirect-callback":t.redirectCallback,"checkbox-visible":t.orderFilter=="new"&&[29,30,35].includes(t.userInfo.role),"hidden-columns":["checked","disabled","UPSAccessPointAddress"],"not-orderable":["Products"],"column-map":{PrescriptionID:"ID",DeliveryID:"Courier",CompanyName:"Client",ReferenceNumber:"Ref"}},scopedSlots:t._u([t.orderFilter=="new"&&[29,30,35].includes(t.userInfo.role)?{key:"filters",fn:function(){return[e("div",{staticClass:"row check-row"},[e("div",{staticClass:"button-group"},[e("div",{staticClass:"btn btnSize02 secondaryBtn",on:{click:function(r){return t.checkAllVisible()}}},[e("input",{class:{unchecked:!t.match&&t.currentChecked},attrs:{type:"checkbox",name:"checkall"},domProps:{checked:t.match||t.currentChecked}}),e("label",{attrs:{for:"checkall"}})]),e("div",{staticClass:"btn btnSize02 secondaryBtn dropdown"},[e("i",{staticClass:"fa fa-caret-down",attrs:{"aria-hidden":"true"}}),e("ul",{staticClass:"dropdown-menu"},[e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkAll()}}},[t._v(" Check All In "+t._s(t.orderFilter)+" ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkAll(10)}}},[t._v(" Check 10 ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkAll(20)}}},[t._v(" Check 20 ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkAll(50)}}},[t._v(" Check 50 ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkAll(100)}}},[t._v(" Check 100 ")]),e("li",[e("hr")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkByProperty("delivery",4)}}},[t._v(" Check DPD ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkByProperty("delivery",5)}}},[t._v(" Check RM ")]),e("li",[e("hr")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkByProperty("client",50)}}},[t._v(" Check Treated ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkByProperty("client",51)}}},[t._v(" Check EveAdam ")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.checkByProperty("client",49)}}},[t._v(" Check Apport Sarl ")]),e("li",[e("hr")]),e("li",{staticClass:"dropdown-menu-item",on:{click:function(r){return t.clearChecked()}}},[t._v(" Clear checked ")])])])]),t.checked.length>0?e("div",{staticClass:"check-options"},[e("button",{staticClass:"btn btnSize02 secondaryBtn",on:{click:function(r){return t.addToTray()}}},[t.userInfo.role==20||t.userInfo.role==19?e("span",[t._v("Take over")]):e("span",[t._v("Add To Tray")]),t._v(" ("+t._s(t.checked.length)+" orders) ")])]):t._e()])]},proxy:!0}:null,t.orderFilter=="safety"&&t.userInfo.role==40?{key:"tools",fn:function(r){return[e("a",{staticClass:"btn btn-primary waves-effect table-icon clickable",on:{click:function(i){return t.safe(r.id)}}},[t._v(" Safe ")])]}}:null],null,!0)}):t.orderFilter=="ordercount"?e("div",{staticClass:"card prescription-pool"},[e("div",{staticClass:"card-body order-id-list"},[e("ul",[e("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("b",[t._v("MISSING PHARMACY ORDERS "),e("span",{staticClass:"badge",class:[t.pendingPharmacyOrders.length>0?"red":""]},[t._v(t._s(t.pendingPharmacyOrders.length))])]),e("div",[e("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Download CSV with a list of reference numbers"},on:{click:function(r){return t.getPendingCSV()}}},[e("i",{staticClass:"fa fa-file",attrs:{"aria-hidden":"true"}})]),e("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Refresh the pending pharmacy orders list manually"},on:{click:function(r){return t.getCount(!0)}}},[e("i",{staticClass:"fa fa-refresh",class:[t.loadingPendingPharmacy?"spin-animation":""]})])])]),t.pendingPharmacyOrders.length>0?e("li",{staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[e("b",[t._v("Reference Number")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Client")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Status")])])]):t._e(),t._l(t.pendingPharmacyOrders,function(r){return e("li",{key:r.SyncOrderID,staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[t._v(t._s(r.Value))]),e("div",{staticClass:"pool-column"},[e("span",[t._v(t._s(r.CompanyName))])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Pending")])])])})],2),t.pendingPharmacyOrdersCount+t.pendingPrescriberCount==0?e("ul",[e("li",{staticClass:"pool-list-title"},[e("b",[t._v("NO PENDING PHARMACY ORDERS FOUND")])])]):t._e(),e("ul",{staticClass:"mt-10"},[e("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("b",[t._v("POSTPONED SHIPPING ORDERS PENDING "),e("span",{staticClass:"badge",class:[t.onHoldOrders.length>0?"red":""]},[t._v(t._s(t.onHoldOrders.length))])])]),t.onHoldOrders.length>0?e("li",{staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[e("b",[t._v("ID")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Reference Number")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Postponed At")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Postponed By")])]),e("div",{staticClass:"pool-column"},[t._v("Tools")])]):t._e(),t._l(t.onHoldOrders,function(r){return e("li",{key:r.PrescriptionID,staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[e("b",[t._v(t._s(r.PrescriptionID))])]),e("div",{staticClass:"pool-column"},[e("div",{domProps:{innerHTML:t._s(r.ReferenceNumber)}})]),e("div",{staticClass:"pool-column"},[t._v(t._s(r.PostponedAt))]),e("div",{staticClass:"pool-column"},[t._v(t._s(r.PostponedBy))]),e("div",{staticClass:"pool-column"},[e("a",{staticClass:"btn btn-primary table-icon",attrs:{title:"View Order",target:"_blank",href:`#/prescription/${r.PrescriptionID}`}},[e("i",{staticClass:"fa fa-search-plus",attrs:{"aria-hidden":"true"}})])])])})],2),e("ul",{staticClass:"mt-10"},[e("li",{staticClass:"pool-list-title pb-10",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("b",[t._v("PENDING ORDER ALERTS "),e("span",{staticClass:"badge",class:[t.pendingOrderAlerts.length>0?"red":""]},[t._v(t._s(t.pendingOrderAlerts.length))])]),e("div",[e("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Create an alert for a prescription that is not yet imported on ESA"},on:{click:function(r){return t.$root.$emit("modal.open","note","preimport")}}},[t._v(" Create Alert ")])])]),t.pendingOrderAlerts.length>0?e("li",{staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[e("b",[t._v("Reference Number")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Note")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Created By")])]),e("div",{staticClass:"pool-column"},[e("b",[t._v("Created At")])]),t.userInfo.role>=40?e("div",{staticClass:"pool-column"},[t._v("Tools")]):t._e()]):t._e(),t._l(t.pendingOrderAlerts,function(r){return e("li",{key:r.NoteID,staticClass:"pool-list-layout"},[e("div",{staticClass:"pool-column"},[r.Subscription?e("div",[e("small",[t._v("Subscription ID: "),e("b",[t._v(t._s(r.Subscription))])]),e("br"),e("small",[t._v("Reference number not set")])]):e("b",[t._v(t._s(r.ReferenceNumber))])]),e("div",{staticClass:"pool-column"},[e("div",{domProps:{innerHTML:t._s(r.Note)}})]),e("div",{staticClass:"pool-column"},[t._v(t._s(r.name)+" "+t._s(r.surname))]),e("div",{staticClass:"pool-column"},[t._v(t._s(r.CreatedAt))]),t.userInfo.role>=40?e("div",{staticClass:"pool-column"},[e("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Edit alert"},on:{click:function(i){return t.editNote(r)}}},[e("i",{staticClass:"fa fa-edit",attrs:{"aria-hidden":"true"}})]),e("button",{staticClass:"btn btn-primary table-icon",attrs:{title:"Delete this alert"},on:{click:function(i){return t.deleteNote(r.NoteID)}}},[e("i",{staticClass:"fa fa-trash",attrs:{"aria-hidden":"true"}})])]):t._e()])})],2)])]):t._e()],1)])])])},h=[function(){var s=this,t=s._self._c;return t("li",[t("div",{staticClass:"loader loader-relative"},[s._v("Loading...")])])}],u=a(c,d,h,!1,null,null,null,null);const v=u.exports;export{v as default};
