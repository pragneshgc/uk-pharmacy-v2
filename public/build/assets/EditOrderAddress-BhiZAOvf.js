import{_ as w,E as P,W as E,X as I,h as V,o as i,c as d,d as h,b as a,j as C,w as b,e as D,t as u,T as k,F as f,r as p,z as N,n as c,s as m,u as S,v as y}from"./app-Day-6uLD.js";const O={mixins:[P,E],props:["orderID","orderStatus","products"],components:{DiffTableAddress:I},data:function(){return{countries:[],companies:[],details:{order:{},oldOrder:{},ups:{},oldUps:{},details:{}},columnHome:["Address1","Address2","Address3","Address4","Postcode","CountryCode","APNotificationLanguage","APNotificationValue"],columnPatient:["Name","Surname","Telephone","Email"],disabledFields:["TokenID","Repeats"],loading:!0,dragEventTriggered:!1,backdrop:!0,watch:!1,saveConfirmation:!1,confirmationChanges:{},confirmationChangesUPS:{},confirmationOld:{},confirmationOldUPS:{}}},watch:{"details.order.DCountryCode":function(){this.watch&&this.getDeliveryCompany()},"details.order.DeliveryID":function(){this.watch&&this.getPostcodeFormatting()},loading(){!this.loading&&!this.dragEventTriggered&&document.getElementById("draggable-div-address")?setTimeout(()=>{this.dragEventTriggered=!0,e(document.getElementById("draggable-div-address"));function e(s){var l=0,g=0,v=0,n=0;document.getElementById("draggable-div-header-address")?document.getElementById("draggable-div-header-address").onmousedown=U:s.onmousedown=U;function U(o){o=o||window.event,o.preventDefault(),v=o.clientX,n=o.clientY,document.onmouseup=t,document.onmousemove=r}function r(o){o=o||window.event,o.preventDefault(),l=v-o.clientX,g=n-o.clientY,v=o.clientX,n=o.clientY,s.style.top=s.offsetTop-g+"px",s.style.left=s.offsetLeft-l+"px"}function t(){document.onmouseup=null,document.onmousemove=null}}},100):(this.dragEventTriggered=!1,this.backdrop=!0)}},computed:{columnDelivery(){let e=["DAddress1","DAddress2","DAddress3","DAddress4","DPostcode","DCountryCode","DeliveryID","UPSAccessPointAddress","TrackingCode","Repeats","TokenID"];return this.details.details.ClientID==51&&this.details.details.JVM!=2&&e.push("JVM"),e},canSetSaturdayDelivery(){let e=new Date,s=e.getDay(),l=e.getHours();return(s==4||s==5)&&(s==4&&l>=17||s==5&&l<=17)}},mounted(){this.getCountries(),this.getCompanies(),this.getOrderDetails(),this.emitter.on("modal.close.all",this.close)},destroyed(){this.emitter.off("modal.close.all")},methods:{getOrderDetails(){this.watch=!1,axios.get("/order-edit/"+this.orderID).then(e=>{this.details=e.data.data,this.loading=!1}).catch(e=>{this.postError(e.response.data.message),this.loading=!1}).finally(()=>{this.watch=!0})},getCountries(){axios.get("/countries").then(e=>{this.countries=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getCompanies(){axios.get("/delivery-companies").then(e=>{this.companies=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getDeliveryCompany(){axios.post(`/order-edit/${this.orderID}/delivery-company`,this.details.order).then(e=>{let s=e.data.data;s.DeliveryID&&(this.details.order.DeliveryID=s.DeliveryID),s.CountryCode&&(this.details.order.CountryCode=s.CountryCode),this.getPostcodeFormatting(),this.postSuccess("Delivery company updated")}).catch(e=>{this.postError(e.response.data.message)})},getPostcodeFormatting(){this.details.order.DeliveryID==10&&axios.post(`/order-edit/${this.orderID}/postcode-formatting`,this.details.order).then(e=>{let s=e.data.data;s.Postcode&&(this.details.order.Postcode=s.Postcode),s.DPostcode&&(this.details.order.DPostcode=s.DPostcode)}).catch(e=>{this.postError(e.response.data.message)})},getCountryTitle(e,s=!1){let l="Unknown";return s||(s=this.countries),s.forEach(g=>{g.CountryID==e&&(l=g.Name)}),l},getCompanyTitle(e,s=!1){let l="Unknown";return s||(s=this.companies),s.forEach(g=>{g.SettingID==e&&(l=g.Name)}),l},getCounterColor(e,s){if(s[e]!=null&&this.alias[e].value){if(s[e].length>0&&this.alias[e].combined&&s[this.alias[e].combined]!=null)return s[e].length+s[this.alias[e].combined].length<=this.alias[e].value?"input-count-success":"input-count-danger";if(s[e].length>0&&s[e].length<=this.alias[e].value)return"input-count-success";if(s[e].length>this.alias[e].value)return"input-count-danger"}return""},close(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationOld={},this.confirmationOld={},this.confirmationOldUPS={},this.details={order:{},oldOrder:{},ups:{},oldUps:{}},this.$emit("closeorder")},toggleBackdrop(){this.backdrop=!this.backdrop},save(e=!1){if(this.saveConfirmation)this.submit(e);else{let s=JSON.parse(JSON.stringify(this.details.order));delete s.ClientID,axios.post(`/order-edit/check/${this.orderID}`,{order:s,ups:this.details.ups}).then(l=>{Object.keys(l.data.data.changes).length>0||Object.keys(l.data.data.changesUPS).length?(this.confirmationChanges=l.data.data.changes,this.confirmationChangesUPS=l.data.data.changesUPS,this.confirmationOld=l.data.data.old,this.confirmationOldUPS=l.data.data.oldUPS,this.saveConfirmation=!0):(this.saveConfirmation=!1,this.$emit("closeorder"))}).catch(l=>{this.saveConfirmation=!1,this.postError(l)})}},saturdayDeliveryCheck(){this.details.order.SaturdayDelivery==0?this.$swal({title:"DPD Saturday Delivery should not be selected without authorisation",html:"If authorisation has been granted, click OK, otherwise click Cancel",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"OK"}).then(e=>{e.value&&(this.details.order.SaturdayDelivery=1)}):this.details.order.SaturdayDelivery=0},submit(e=!1){let s=JSON.parse(JSON.stringify(this.details.order));delete s.ClientID,axios.post("/order-edit/"+this.orderID,{order:s,ups:this.details.ups}).then(l=>{this.postSuccess("Saved"),e&&this.emitter.emit("prescription.validate")}).catch(l=>{this.postError(l)}).finally(()=>{this.close(),this.saveConfirmation=!1,this.emitter.emit("orderupdate")})},back(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationChangesUPS={}},isEqual:_.isEqual}},T={class:"modal",id:"draggable-div-address",ref:"parentEl"},A={key:0,class:"modal-header draggable-div-header",id:"draggable-div-header-address",target:"parentEl"},B={class:"flexContent"},F={class:"orderDetails"},j=["src"],q=a("span",null,"Order #: ",-1),J=a("span",null,"Name: ",-1),M=a("span",null,"Surname: ",-1),z=a("span",null,"Status: ",-1),L={key:0},R=a("span",null,"Tracking Code: ",-1),Y={key:1},H=a("span",null,"Commercial value: ",-1),X={key:0,class:"flexContent"},K={class:"productListItem mb-10"},Q={class:"title"},W={class:"form-column"},G=a("h3",null,"Patient Details",-1),Z=["for"],$=["for"],x=["disabled","name","onUpdate:modelValue"],ee=a("h3",null,"Delivery Details",-1),te=["for"],se=["for"],oe=["disabled","name","onUpdate:modelValue"],ie=["onUpdate:modelValue"],de=["value"],ae=["onUpdate:modelValue"],re=["value"],le=["onUpdate:modelValue"],ne=a("option",{value:"0"},"No",-1),ue=a("option",{value:"1"},"Yes",-1),he=[ne,ue],ce=["onUpdate:modelValue"],me=a("option",{value:"0"},"No",-1),fe=a("option",{value:"1"},"Yes",-1),pe=[me,fe],ge={class:"form-group form-group-2"},ye=a("label",{for:"saturday-delivery"},"Saturday Delivery",-1),Ce=["title"],De=["disabled","value"],be=a("span",{class:"slider"},null,-1),ke={key:2,class:"form-group form-group-2"},Se={for:"Notes"},ve={class:"form-column"},Ue=a("h3",null,"Home Details",-1),we=["for"],Pe=["disabled","name","onUpdate:modelValue"],Ee=["onUpdate:modelValue"],Ie=["value"],Ve=["onUpdate:modelValue"],Ne=["value"],Oe={class:"form-column"},Te={key:0},Ae=["for"],Be=["disabled","name","onUpdate:modelValue"],Fe=["for"],_e=["onUpdate:modelValue"],je=["value"],qe=["onUpdate:modelValue"],Je=["value"],Me={key:0,class:"pxp-form mb-20"},ze=a("div",{class:"infoBox warning"},[a("p",null,"Please review and confirm all the changes in the order before saving!")],-1),Le={key:0,class:"modal-footer"},Re={key:0},Ye={key:1},He=a("span",null," Back ",-1),Xe=[He],Ke={key:1,class:"loader",style:{}},Qe=a("i",{class:"fa fa-clone"},null,-1),We=[Qe],Ge=a("i",{class:"fa fa-close"},null,-1),Ze=[Ge];function $e(e,s,l,g,v,n){const U=V("DiffTableAddress");return i(),d("div",null,[e.backdrop?(i(),d("div",{key:0,class:"backdrop",onClick:s[0]||(s[0]=r=>n.close())})):h("",!0),a("div",T,[e.loading?h("",!0):(i(),d("div",A,[C(k,{name:"fade"},{default:b(()=>[a("section",B,[a("div",F,[a("img",{src:e.iconPaper},null,8,j),a("ul",null,[a("li",null,[q,D(u(l.orderID),1)]),a("li",null,[J,D(u(e.details.order.Name),1)]),a("li",null,[M,D(u(e.details.order.Surname),1)]),a("li",null,[z,D(u(l.orderStatus),1)]),e.details.order.TrackingCode!=""&&e.details.order.TrackingCode!=null?(i(),d("li",L,[R,D(u(e.details.order.TrackingCode),1)])):h("",!0),e.details.order.Repeats!="0"&&e.details.order.Repeats!=""&&[143,162,205,243].includes(e.details.order.DCountryCode)?(i(),d("li",Y,[H,D(u(e.details.order.Repeats),1)])):h("",!0)])])])]),_:1}),C(k,{name:"fade"},{default:b(()=>[l.products.length!=0?(i(),d("section",X,[(i(!0),d(f,null,p(l.products,r=>(i(),d("div",K,[a("div",Q,[a("h3",null,u(r.Name)+", "+u(r.Dosage)+" x "+u(r.Quantity)+" "+u(r.Unit),1)])]))),256))])):h("",!0)]),_:1})])),C(k,{name:"fade"},{default:b(()=>[e.countries.length!=0&&e.companies.length!=0&&!e.loading&&Object.keys(e.confirmationChanges).length==0&&Object.keys(e.confirmationChangesUPS).length==0?(i(),d("form",{key:0,onSubmit:s[3]||(s[3]=N((...r)=>n.save&&n.save(...r),["prevent"])),class:"pxp-form address-form mb-20"},[a("div",W,[G,e.columnPatient.includes(e.value)?(i(!0),d(f,{key:0},p(e.details.order,(r,t)=>(i(),d("div",{class:"form-group form-group-2 pb-10",key:t},[a("label",{for:r},u(e.alias[t].title),9,Z),e.alias[t].value?(i(),d("label",{key:0,class:c([n.getCounterColor(t,e.details.order),"input-count"]),for:r},u(e.details.order[t]?e.details.order[t].length+e.details.order[e.alias[t].combined].length:0)+"/"+u(e.alias[t].value),11,$)):h("",!0),m(a("input",{disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":o=>e.details.order[t]=o},null,8,x),[[S,e.details.order[t]]])]))),128)):h("",!0),ee,n.columnDelivery.includes(e.value)?(i(!0),d(f,{key:1},p(e.details.order,(r,t)=>(i(),d("div",{class:"form-group form-group-2",key:t},[a("label",{for:r},u(e.alias[t].title),9,te),e.alias[t].value?(i(),d("label",{key:0,class:c([n.getCounterColor(t,e.details.order),"input-count"]),for:r},u(e.details.order[t]?e.details.order[t].length:0)+"/"+u(e.alias[t].value),11,se)):h("",!0),["JVM","UPSAccessPointAddress","CountryCode","DCountryCode","DeliveryID","Notes"].includes(t)?["DCountryCode","CountryCode"].includes(t)?m((i(),d("select",{key:2,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.countries,o=>(i(),d("option",{value:o.CountryID},u(o.Name),9,de))),256))],10,ie)),[[y,e.details.order[t]]]):["DeliveryID"].includes(t)?m((i(),d("select",{key:3,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.companies,o=>(i(),d("option",{value:o.SettingID},u(o.Name),9,re))),256))],10,ae)),[[y,e.details.order[t]]]):["UPSAccessPointAddress"].includes(t)?m((i(),d("select",{key:4,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},he,10,le)),[[y,e.details.order[t]]]):["JVM"].includes(t)?m((i(),d("select",{key:5,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},pe,10,ce)),[[y,e.details.order[t]]]):h("",!0):m((i(),d("input",{key:1,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":o=>e.details.order[t]=o},null,8,oe)),[[S,e.details.order[t]]])]))),128)):h("",!0),a("div",ge,[ye,a("label",{class:c(["switch",[n.canSetSaturdayDelivery?"":"disabled-slider"]]),style:{width:"60px"},title:n.canSetSaturdayDelivery?"Switch to Saturday Delivery":"Can not switch Saturday Delivery on when the day is not Thursday after 17:00 or Friday before 17:00"},[a("input",{id:"saturday-delivery",class:c([e.details.order.SaturdayDelivery==1?"slider-checked":""]),type:"checkbox",onClick:s[1]||(s[1]=r=>n.saturdayDeliveryCheck()),disabled:!n.canSetSaturdayDelivery,value:e.details.order.SaturdayDelivery==1},null,10,De),be],10,Ce)]),e.details.order.Notes!=null&&e.details.order.Notes!=""?(i(),d("div",ke,[a("label",Se,u(e.alias.Notes.title),1),m(a("textarea",{style:{"min-width":"300px","min-height":"60px","line-height":"1"},placeholder:"Add notes here if you want them to show for dispensers and customer support","onUpdate:modelValue":s[2]||(s[2]=r=>e.details.order.Notes=r),class:"form-control tBoxSize02"},null,512),[[S,e.details.order.Notes]])])):h("",!0)]),a("div",ve,[Ue,e.columnHome.includes(e.value)?(i(!0),d(f,{key:0},p(e.details.order,(r,t)=>(i(),d("div",{class:"form-group form-group-2",key:t},[a("label",{for:r},u(e.alias[t].title),9,we),["CountryCode","DCountryCode","DeliveryID","Notes"].includes(t)?["DCountryCode","CountryCode"].includes(t)?m((i(),d("select",{key:1,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.countries,o=>(i(),d("option",{value:o.CountryID},u(o.Name),9,Ie))),256))],10,Ee)),[[y,e.details.order[t]]]):["DeliveryID"].includes(t)?m((i(),d("select",{key:2,"onUpdate:modelValue":o=>e.details.order[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.companies,o=>(i(),d("option",{value:o.SettingID},u(o.Name),9,Ne))),256))],10,Ve)),[[y,e.details.order[t]]]):h("",!0):m((i(),d("input",{key:0,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":o=>e.details.order[t]=o},null,8,Pe)),[[S,e.details.order[t]]])]))),128)):h("",!0)]),a("div",Oe,[e.details.ups!=null?(i(),d("h3",Te,"UPS Access Point")):h("",!0),(i(!0),d(f,null,p(e.details.ups,(r,t)=>(i(),d("div",{class:"form-group",key:t},[a("label",{for:r},u(e.alias[t].title),9,Ae),["CountryCode","DCountryCode","APNotificationLanguage"].includes(t)?h("",!0):m((i(),d("input",{key:0,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":o=>e.details.ups[t]=o},null,8,Be)),[[S,e.details.ups[t]]]),e.alias[t].value?(i(),d("label",{key:1,class:c([n.getCounterColor(t,e.details.ups),"input-count"]),for:r},u(e.details.ups[t]?e.details.ups[t].length:0)+"/"+u(e.alias[t].value),11,Fe)):["DCountryCode","CountryCode"].includes(t)?m((i(),d("select",{key:2,"onUpdate:modelValue":o=>e.details.ups[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.countries,o=>(i(),d("option",{value:o.CountryID},u(o.Name),9,je))),256))],10,_e)),[[y,e.details.ups[t]]]):["APNotificationLanguage"].includes(t)?m((i(),d("select",{key:3,"onUpdate:modelValue":o=>e.details.ups[t]=o,class:c([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(i(!0),d(f,null,p(e.countries,o=>(i(),d("option",{value:o.CountryID},u(o.Name),9,Je))),256))],10,qe)),[[y,e.details.ups[t]]]):h("",!0)]))),128))])],32)):h("",!0)]),_:1}),C(k,{name:"fade"},{default:b(()=>[(Object.keys(e.confirmationChanges).length>0||Object.keys(e.confirmationChangesUPS).length>0)&&!e.loading?(i(),d("div",Me,[ze,C(U,{"old-object":e.confirmationOld,"new-object":e.confirmationChanges,"old-object-u-p-s":e.confirmationOldUPS,"new-object-u-p-s":e.confirmationChangesUPS,"countries-prop":e.countries,"companies-prop":e.companies},null,8,["old-object","new-object","old-object-u-p-s","new-object-u-p-s","countries-prop","companies-prop"])])):h("",!0)]),_:1}),C(k,{name:"fade"},{default:b(()=>[e.loading?h("",!0):(i(),d("div",Le,[!n.isEqual(e.details.order,e.details.oldOrder)||!n.isEqual(e.details.ups,e.details.oldUPS)?(i(),d("button",{key:0,class:"btn btnSize01 tertiaryBtn bigButton",onClick:s[4]||(s[4]=r=>n.save())},[e.saveConfirmation?(i(),d("span",Ye," Save ")):(i(),d("span",Re," Review "))])):h("",!0),(!n.isEqual(e.details.order,e.details.oldOrder)||!n.isEqual(e.details.ups,e.details.oldUPS))&&e.saveConfirmation&&l.orderStatus=="SAFETYCHECK"?(i(),d("button",{key:1,class:"btn btnSize01 tertiaryBtn bigButton",onClick:s[5]||(s[5]=r=>n.save(!0))}," Save & Validate ")):h("",!0),(!n.isEqual(e.details.order,e.details.oldOrder)||!n.isEqual(e.details.ups,e.details.oldUPS))&&e.saveConfirmation?(i(),d("button",{key:2,onClick:s[6]||(s[6]=r=>n.back()),class:"btn btnSize01 tertiaryBtn bigButton"},Xe)):h("",!0),a("button",{onClick:s[7]||(s[7]=r=>n.close()),class:"btn btnSize01 secondaryBtn bigButton"},"Cancel")]))]),_:1}),e.loading?(i(),d("div",Ke,"Loading...")):h("",!0),a("span",{class:"backdrop-toggle",onClick:s[8]||(s[8]=r=>n.toggleBackdrop()),title:"Unfocus the modal"},We),a("span",{class:"close",onClick:s[9]||(s[9]=r=>n.close()),title:"Close the modal"},Ze)],512)])}const et=w(O,[["render",$e]]);export{et as default};
//# sourceMappingURL=EditOrderAddress-BhiZAOvf.js.map
