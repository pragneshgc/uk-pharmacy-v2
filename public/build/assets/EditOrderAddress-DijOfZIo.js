import{_ as w,E as P,a5 as E,a6 as I,e as N,o,c as i,b as h,a,m as C,j as b,g as D,t as u,T as k,F as c,f as p,D as V,n as m,w as f,B as S,A as y}from"./app-CzB2aCin.js";const O="/build/assets/iconPaper-mzJ3qGNQ.png",A={mixins:[P,E],props:["orderID","orderStatus","products"],components:{DiffTableAddress:I},data:function(){return{countries:[],companies:[],details:{order:{},oldOrder:{},ups:{},oldUps:{},details:{}},columnHome:["Address1","Address2","Address3","Address4","Postcode","CountryCode","APNotificationLanguage","APNotificationValue"],columnPatient:["Name","Surname","Telephone","Email"],disabledFields:["TokenID","Repeats"],loading:!0,dragEventTriggered:!1,backdrop:!0,watch:!1,saveConfirmation:!1,confirmationChanges:{},confirmationChangesUPS:{},confirmationOld:{},confirmationOldUPS:{},iconPaper:O}},watch:{"details.order.DCountryCode":function(){this.watch&&this.getDeliveryCompany()},"details.order.DeliveryID":function(){this.watch&&this.getPostcodeFormatting()},loading(){!this.loading&&!this.dragEventTriggered&&document.getElementById("draggable-div-address")?setTimeout(()=>{this.dragEventTriggered=!0,e(document.getElementById("draggable-div-address"));function e(s){var n=0,g=0,v=0,l=0;document.getElementById("draggable-div-header-address")?document.getElementById("draggable-div-header-address").onmousedown=U:s.onmousedown=U;function U(d){d=d||window.event,d.preventDefault(),v=d.clientX,l=d.clientY,document.onmouseup=t,document.onmousemove=r}function r(d){d=d||window.event,d.preventDefault(),n=v-d.clientX,g=l-d.clientY,v=d.clientX,l=d.clientY,s.style.top=s.offsetTop-g+"px",s.style.left=s.offsetLeft-n+"px"}function t(){document.onmouseup=null,document.onmousemove=null}}},100):(this.dragEventTriggered=!1,this.backdrop=!0)}},computed:{columnDelivery(){let e=["DAddress1","DAddress2","DAddress3","DAddress4","DPostcode","DCountryCode","DeliveryID","UPSAccessPointAddress","TrackingCode","Repeats","TokenID"];return this.details.details.ClientID==51&&this.details.details.JVM!=2&&e.push("JVM"),e},canSetSaturdayDelivery(){let e=new Date,s=e.getDay(),n=e.getHours();return(s==4||s==5)&&(s==4&&n>=17||s==5&&n<=17)}},mounted(){this.getCountries(),this.getCompanies(),this.getOrderDetails(),this.emitter.on("modal.close.all",this.close)},destroyed(){this.emitter.off("modal.close.all")},methods:{getOrderDetails(){this.watch=!1,axios.get("/order-edit/"+this.orderID).then(e=>{this.details=e.data.data,this.loading=!1}).catch(e=>{this.postError(e.response.data.message),this.loading=!1}).finally(()=>{this.watch=!0})},getCountries(){axios.get("/countries").then(e=>{this.countries=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getCompanies(){axios.get("/delivery-companies").then(e=>{this.companies=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getDeliveryCompany(){axios.post(`/order-edit/${this.orderID}/delivery-company`,this.details.order).then(e=>{let s=e.data.data;s.DeliveryID&&(this.details.order.DeliveryID=s.DeliveryID),s.CountryCode&&(this.details.order.CountryCode=s.CountryCode),this.getPostcodeFormatting(),this.postSuccess("Delivery company updated")}).catch(e=>{this.postError(e.response.data.message)})},getPostcodeFormatting(){this.details.order.DeliveryID==10&&axios.post(`/order-edit/${this.orderID}/postcode-formatting`,this.details.order).then(e=>{let s=e.data.data;s.Postcode&&(this.details.order.Postcode=s.Postcode),s.DPostcode&&(this.details.order.DPostcode=s.DPostcode)}).catch(e=>{this.postError(e.response.data.message)})},getCountryTitle(e,s=!1){let n="Unknown";return s||(s=this.countries),s.forEach(g=>{g.CountryID==e&&(n=g.Name)}),n},getCompanyTitle(e,s=!1){let n="Unknown";return s||(s=this.companies),s.forEach(g=>{g.SettingID==e&&(n=g.Name)}),n},getCounterColor(e,s){if(s[e]!=null&&this.alias[e].value){if(s[e].length>0&&this.alias[e].combined&&s[this.alias[e].combined]!=null)return s[e].length+s[this.alias[e].combined].length<=this.alias[e].value?"input-count-success":"input-count-danger";if(s[e].length>0&&s[e].length<=this.alias[e].value)return"input-count-success";if(s[e].length>this.alias[e].value)return"input-count-danger"}return""},close(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationOld={},this.confirmationOld={},this.confirmationOldUPS={},this.details={order:{},oldOrder:{},ups:{},oldUps:{}},this.$emit("closeorder")},toggleBackdrop(){this.backdrop=!this.backdrop},save(e=!1){if(this.saveConfirmation)this.submit(e);else{let s=JSON.parse(JSON.stringify(this.details.order));delete s.ClientID,axios.post(`/order-edit/check/${this.orderID}`,{order:s,ups:this.details.ups}).then(n=>{Object.keys(n.data.data.changes).length>0||Object.keys(n.data.data.changesUPS).length?(this.confirmationChanges=n.data.data.changes,this.confirmationChangesUPS=n.data.data.changesUPS,this.confirmationOld=n.data.data.old,this.confirmationOldUPS=n.data.data.oldUPS,this.saveConfirmation=!0):(this.saveConfirmation=!1,this.$emit("closeorder"))}).catch(n=>{this.saveConfirmation=!1,this.postError(n)})}},saturdayDeliveryCheck(){this.details.order.SaturdayDelivery==0?this.$swal({title:"DPD Saturday Delivery should not be selected without authorisation",html:"If authorisation has been granted, click OK, otherwise click Cancel",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"OK"}).then(e=>{e.value&&(this.details.order.SaturdayDelivery=1)}):this.details.order.SaturdayDelivery=0},submit(e=!1){let s=JSON.parse(JSON.stringify(this.details.order));delete s.ClientID,axios.post("/order-edit/"+this.orderID,{order:s,ups:this.details.ups}).then(n=>{this.postSuccess("Saved"),e&&this.emitter.emit("prescription.validate")}).catch(n=>{this.postError(n)}).finally(()=>{this.close(),this.saveConfirmation=!1,this.emitter.emit("orderupdate")})},back(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationChangesUPS={}},isEqual:_.isEqual}},T={class:"modal",id:"draggable-div-address",ref:"parentEl"},B={key:0,class:"modal-header draggable-div-header",id:"draggable-div-header-address",target:"parentEl"},F={class:"flexContent"},q={class:"orderDetails"},J=["src"],j=a("span",null,"Order #: ",-1),M=a("span",null,"Name: ",-1),z=a("span",null,"Surname: ",-1),L=a("span",null,"Status: ",-1),R={key:0},Y=a("span",null,"Tracking Code: ",-1),H={key:1},K=a("span",null,"Commercial value: ",-1),X={key:0,class:"flexContent"},Q={class:"productListItem mb-10"},G={class:"title"},W={class:"form-column"},Z=a("h3",null,"Patient Details",-1),$={key:0,class:"form-group form-group-2 pb-10"},x=["for"],ee=["for"],te=["disabled","name","onUpdate:modelValue"],se=a("h3",null,"Delivery Details",-1),oe={key:0,class:"form-group form-group-2"},ie=["for"],de=["for"],ae=["disabled","name","onUpdate:modelValue"],re=["onUpdate:modelValue"],ne=["value"],le=["onUpdate:modelValue"],ue=["value"],he=["onUpdate:modelValue"],ce=a("option",{value:"0"},"No",-1),me=a("option",{value:"1"},"Yes",-1),fe=[ce,me],pe=["onUpdate:modelValue"],ge=a("option",{value:"0"},"No",-1),ye=a("option",{value:"1"},"Yes",-1),Ce=[ge,ye],De={class:"form-group form-group-2"},be=a("label",{for:"saturday-delivery"},"Saturday Delivery",-1),ke=["title"],Se=["disabled","value"],ve=a("span",{class:"slider"},null,-1),Ue={key:0,class:"form-group form-group-2"},we={for:"Notes"},Pe={class:"form-column"},Ee=a("h3",null,"Home Details",-1),Ie={key:0,class:"form-group form-group-2"},Ne=["for"],Ve=["disabled","name","onUpdate:modelValue"],Oe=["onUpdate:modelValue"],Ae=["value"],Te=["onUpdate:modelValue"],Be=["value"],_e={class:"form-column"},Fe={key:0},qe=["for"],Je=["disabled","name","onUpdate:modelValue"],je=["for"],Me=["onUpdate:modelValue"],ze=["value"],Le=["onUpdate:modelValue"],Re=["value"],Ye={key:0,class:"pxp-form mb-20"},He=a("div",{class:"infoBox warning"},[a("p",null,"Please review and confirm all the changes in the order before saving!")],-1),Ke={key:0,class:"modal-footer"},Xe={key:0},Qe={key:1},Ge=a("span",null," Back ",-1),We=[Ge],Ze={key:1,class:"loader",style:{}},$e=a("i",{class:"fa fa-clone"},null,-1),xe=[$e],et=a("i",{class:"fa fa-close"},null,-1),tt=[et];function st(e,s,n,g,v,l){const U=N("DiffTableAddress");return o(),i("div",null,[e.backdrop?(o(),i("div",{key:0,class:"backdrop",onClick:s[0]||(s[0]=r=>l.close())})):h("",!0),a("div",T,[e.loading?h("",!0):(o(),i("div",B,[C(k,{name:"fade"},{default:b(()=>[a("section",F,[a("div",q,[a("img",{src:e.iconPaper},null,8,J),a("ul",null,[a("li",null,[j,D(u(n.orderID),1)]),a("li",null,[M,D(u(e.details.order.Name),1)]),a("li",null,[z,D(u(e.details.order.Surname),1)]),a("li",null,[L,D(u(n.orderStatus),1)]),e.details.order.TrackingCode!=""&&e.details.order.TrackingCode!=null?(o(),i("li",R,[Y,D(u(e.details.order.TrackingCode),1)])):h("",!0),e.details.order.Repeats!="0"&&e.details.order.Repeats!=""&&[143,162,205,243].includes(e.details.order.DCountryCode)?(o(),i("li",H,[K,D(u(e.details.order.Repeats),1)])):h("",!0)])])])]),_:1}),C(k,{name:"fade"},{default:b(()=>[n.products.length!=0?(o(),i("section",X,[(o(!0),i(c,null,p(n.products,r=>(o(),i("div",Q,[a("div",G,[a("h3",null,u(r.Name)+", "+u(r.Dosage)+" x "+u(r.Quantity)+" "+u(r.Unit),1)])]))),256))])):h("",!0)]),_:1})])),C(k,{name:"fade"},{default:b(()=>[e.countries.length!=0&&e.companies.length!=0&&!e.loading&&Object.keys(e.confirmationChanges).length==0&&Object.keys(e.confirmationChangesUPS).length==0?(o(),i("form",{key:0,onSubmit:s[3]||(s[3]=V((...r)=>l.save&&l.save(...r),["prevent"])),class:"pxp-form address-form mb-20"},[a("div",W,[Z,(o(!0),i(c,null,p(e.details.order,(r,t)=>(o(),i(c,{key:t},[e.columnPatient.includes(t)?(o(),i("div",$,[a("label",{for:r},u(e.alias[t].title),9,x),e.alias[t].value?(o(),i("label",{key:0,class:m([l.getCounterColor(t,e.details.order),"input-count"]),for:r},u(e.details.order[t]?e.details.order[t].length+e.details.order[e.alias[t].combined].length:0)+"/"+u(e.alias[t].value),11,ee)):h("",!0),f(a("input",{disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":d=>e.details.order[t]=d},null,8,te),[[S,e.details.order[t]]])])):h("",!0)],64))),128)),se,(o(!0),i(c,null,p(e.details.order,(r,t)=>(o(),i(c,{key:t},[l.columnDelivery.includes(t)?(o(),i("div",oe,[a("label",{for:r},u(e.alias[t].title),9,ie),e.alias[t].value?(o(),i("label",{key:0,class:m([l.getCounterColor(t,e.details.order),"input-count"]),for:r},u(e.details.order[t]?e.details.order[t].length:0)+"/"+u(e.alias[t].value),11,de)):h("",!0),["JVM","UPSAccessPointAddress","CountryCode","DCountryCode","DeliveryID","Notes"].includes(t)?["DCountryCode","CountryCode"].includes(t)?f((o(),i("select",{key:2,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.countries,d=>(o(),i("option",{value:d.CountryID},u(d.Name),9,ne))),256))],10,re)),[[y,e.details.order[t]]]):["DeliveryID"].includes(t)?f((o(),i("select",{key:3,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.companies,d=>(o(),i("option",{value:d.SettingID},u(d.Name),9,ue))),256))],10,le)),[[y,e.details.order[t]]]):["UPSAccessPointAddress"].includes(t)?f((o(),i("select",{key:4,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},fe,10,he)),[[y,e.details.order[t]]]):["JVM"].includes(t)?f((o(),i("select",{key:5,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},Ce,10,pe)),[[y,e.details.order[t]]]):h("",!0):f((o(),i("input",{key:1,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":d=>e.details.order[t]=d},null,8,ae)),[[S,e.details.order[t]]])])):h("",!0)],64))),128)),a("div",De,[be,a("label",{class:m(["switch",[l.canSetSaturdayDelivery?"":"disabled-slider"]]),style:{width:"60px"},title:l.canSetSaturdayDelivery?"Switch to Saturday Delivery":"Can not switch Saturday Delivery on when the day is not Thursday after 17:00 or Friday before 17:00"},[a("input",{id:"saturday-delivery",class:m([e.details.order.SaturdayDelivery==1?"slider-checked":""]),type:"checkbox",onClick:s[1]||(s[1]=r=>l.saturdayDeliveryCheck()),disabled:!l.canSetSaturdayDelivery,value:e.details.order.SaturdayDelivery==1},null,10,Se),ve],10,ke)]),e.details.order.Notes!=null&&e.details.order.Notes!=""?(o(),i("div",Ue,[a("label",we,u(e.alias.Notes.title),1),f(a("textarea",{style:{"min-width":"300px","min-height":"60px","line-height":"1"},placeholder:"Add notes here if you want them to show for dispensers and customer support","onUpdate:modelValue":s[2]||(s[2]=r=>e.details.order.Notes=r),class:"form-control tBoxSize02"},null,512),[[S,e.details.order.Notes]])])):h("",!0)]),a("div",Pe,[Ee,(o(!0),i(c,null,p(e.details.order,(r,t)=>(o(),i(c,{key:t},[e.columnHome.includes(t)?(o(),i("div",Ie,[a("label",{for:r},u(e.alias[t].title),9,Ne),["CountryCode","DCountryCode","DeliveryID","Notes"].includes(t)?["DCountryCode","CountryCode"].includes(t)?f((o(),i("select",{key:1,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.countries,d=>(o(),i("option",{value:d.CountryID},u(d.Name),9,Ae))),256))],10,Oe)),[[y,e.details.order[t]]]):["DeliveryID"].includes(t)?f((o(),i("select",{key:2,"onUpdate:modelValue":d=>e.details.order[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.companies,d=>(o(),i("option",{value:d.SettingID},u(d.Name),9,Be))),256))],10,Te)),[[y,e.details.order[t]]]):h("",!0):f((o(),i("input",{key:0,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":d=>e.details.order[t]=d},null,8,Ve)),[[S,e.details.order[t]]])])):h("",!0)],64))),128))]),a("div",_e,[e.details.ups!=null?(o(),i("h3",Fe,"UPS Access Point")):h("",!0),(o(!0),i(c,null,p(e.details.ups,(r,t)=>(o(),i("div",{class:"form-group",key:t},[a("label",{for:r},u(e.alias[t].title),9,qe),["CountryCode","DCountryCode","APNotificationLanguage"].includes(t)?h("",!0):f((o(),i("input",{key:0,disabled:e.disabledFields.includes(t),class:"",name:r,placeholder:"","onUpdate:modelValue":d=>e.details.ups[t]=d},null,8,Je)),[[S,e.details.ups[t]]]),e.alias[t].value?(o(),i("label",{key:1,class:m([l.getCounterColor(t,e.details.ups),"input-count"]),for:r},u(e.details.ups[t]?e.details.ups[t].length:0)+"/"+u(e.alias[t].value),11,je)):["DCountryCode","CountryCode"].includes(t)?f((o(),i("select",{key:2,"onUpdate:modelValue":d=>e.details.ups[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.countries,d=>(o(),i("option",{value:d.CountryID},u(d.Name),9,ze))),256))],10,Me)),[[y,e.details.ups[t]]]):["APNotificationLanguage"].includes(t)?f((o(),i("select",{key:3,"onUpdate:modelValue":d=>e.details.ups[t]=d,class:m([e.details.order[t]&&e.details.order[t]!=""?"select-dropdown-active":""])},[(o(!0),i(c,null,p(e.countries,d=>(o(),i("option",{value:d.CountryID},u(d.Name),9,Re))),256))],10,Le)),[[y,e.details.ups[t]]]):h("",!0)]))),128))])],32)):h("",!0)]),_:1}),C(k,{name:"fade"},{default:b(()=>[(Object.keys(e.confirmationChanges).length>0||Object.keys(e.confirmationChangesUPS).length>0)&&!e.loading?(o(),i("div",Ye,[He,C(U,{"old-object":e.confirmationOld,"new-object":e.confirmationChanges,"old-object-u-p-s":e.confirmationOldUPS,"new-object-u-p-s":e.confirmationChangesUPS,"countries-prop":e.countries,"companies-prop":e.companies},null,8,["old-object","new-object","old-object-u-p-s","new-object-u-p-s","countries-prop","companies-prop"])])):h("",!0)]),_:1}),C(k,{name:"fade"},{default:b(()=>[e.loading?h("",!0):(o(),i("div",Ke,[!l.isEqual(e.details.order,e.details.oldOrder)||!l.isEqual(e.details.ups,e.details.oldUPS)?(o(),i("button",{key:0,class:"btn btnSize01 tertiaryBtn bigButton",onClick:s[4]||(s[4]=r=>l.save())},[e.saveConfirmation?(o(),i("span",Qe," Save ")):(o(),i("span",Xe," Review "))])):h("",!0),(!l.isEqual(e.details.order,e.details.oldOrder)||!l.isEqual(e.details.ups,e.details.oldUPS))&&e.saveConfirmation&&n.orderStatus=="SAFETYCHECK"?(o(),i("button",{key:1,class:"btn btnSize01 tertiaryBtn bigButton",onClick:s[5]||(s[5]=r=>l.save(!0))}," Save & Validate ")):h("",!0),(!l.isEqual(e.details.order,e.details.oldOrder)||!l.isEqual(e.details.ups,e.details.oldUPS))&&e.saveConfirmation?(o(),i("button",{key:2,onClick:s[6]||(s[6]=r=>l.back()),class:"btn btnSize01 tertiaryBtn bigButton"},We)):h("",!0),a("button",{onClick:s[7]||(s[7]=r=>l.close()),class:"btn btnSize01 secondaryBtn bigButton"},"Cancel")]))]),_:1}),e.loading?(o(),i("div",Ze,"Loading...")):h("",!0),a("span",{class:"backdrop-toggle",onClick:s[8]||(s[8]=r=>l.toggleBackdrop()),title:"Unfocus the modal"},xe),a("span",{class:"close",onClick:s[9]||(s[9]=r=>l.close()),title:"Close the modal"},tt)],512)])}const it=w(A,[["render",st]]);export{it as default};
//# sourceMappingURL=EditOrderAddress-DijOfZIo.js.map
