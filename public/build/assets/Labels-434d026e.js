import{n as l,P as u,T as p,E as f,v as h,p as m}from"./app-a3e6dddd.js";import{l as v}from"./logging-e11bbfe7.js";const g={mixins:[u],data:function(){return{userInfo,productCodeId:!1,productCode:{},productCodeEdit:{},pricingId:!1,errors:[],options:[],list:[],clients:[],countries:[],editing:!1,type:"product",form:{country:{price:!1,country:!1},pricing:{price:!1,client:0},product:{}},saving:!1,callback:!1,callbackData:!1,buttonText:!1,override:!1,visible:!1}},computed:{saveButtonText(){return this.buttonText?this.buttonText:!this.productCodeId&&this.editing?"Add":this.pricingId&&this.editing?"Update":"Save Changes"},title(){return this.editing&&this.productCodeId?"Edit Product":this.editing&&!this.productCodeId?"Create Product":"Product List"}},mounted(){this.$root.$on("label.details",this.getProductDetails),this.$root.$on("label.add",this.addProduct),this.clear()},beforeDestroy(){this.$root.$off("product.details",this.getProductDetails),this.$root.$off("product.add"),$("#productEditor").off("hidden.bs.modal")},watch:{productCodeId(){this.getPriceList(),this.getProductCode()},type(s){s=="country"&&this.getCountries()}},methods:{getProductDetails(s){this.productCode=s,this.editing=!1,this.type="product",this.productCodeId=this.productCode.ProductCodeID,this.show()},show(){this.options.length==0&&this.getOptions(),this.visible=!0},getCountries(){axios.get("/countries").then(s=>{this.countries=s.data.data}).catch(s=>{console.log(s)})},getOptions(){axios.get("/inventory/products/list").then(s=>{this.options=s.data.data}).catch(s=>{console.log(s)})},getPriceList(){axios.get(`/inventory/products/${this.productCodeId}/list`).then(s=>{this.list=s.data.data}).catch(s=>{console.log(s)})},getDeliveryCompanies(s=!1){axios.get("/inventory/delivery/list").then(t=>{this.deliveryCompanies=t.data.data,s&&s()}).catch(t=>{console.log(t)})},getClients(s=!1){axios.get("/inventory/clients/list").then(t=>{this.clients=t.data.data,s&&s()}).catch(t=>{console.log(t)})},getProductCode(){axios.get(`/inventory/products/${this.productCodeId}`).then(s=>{this.productCode=s.data.data}).catch(s=>{console.log(s)})},addProduct(){this.editing=!0,this.type="product",this.productCodeId=!1,this.show()},addCountry(){this.editing=!0,this.type="country",this.productCodeId=!1,this.show()},removePricing(s){this.$swal({title:"Are you sure you want to remove this pricing?",text:"This cannot be reverted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, remove it!"}).then(t=>{t.value&&axios.delete(`/inventory/products/pricing/${s}`).then(e=>{this.$swal({title:"Pricing removed",type:"error",showConfirmButton:!0}),this.getPriceList()}).catch(e=>{console.log(e)})})},deleteProduct(){this.$swal({title:"Are you sure you want to deactivate this product?",text:"This can be reverted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, deactivate it!"}).then(s=>{s.value&&axios.delete(`/inventory/products/${this.productCodeId}/delete`).then(t=>{this.$swal({title:"Product has been deactivated",type:"error",showConfirmButton:!0}),this.getProductCode(),this.$root.$emit("product.refresh")}).catch(t=>{console.log(t)})})},reactivateProduct(){this.$swal({title:"Are you sure you want to activate this product?",text:"This can be reverted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, deactivate it!"}).then(s=>{s.value&&axios.post(`/inventory/products/${this.productCodeId}/reactivate`).then(t=>{this.$swal({title:"Product has been reactivated",type:"success",showConfirmButton:!0}),this.getProductCode(),this.$root.$emit("product.refresh")}).catch(t=>{console.log(t)})})},save(){if(!this.productCodeId&&this.type=="country")axios.post("/inventory/countries/pricing",this.form.country).then(s=>{this.$swal({title:"Default pricing for country added",type:"success",showConfirmButton:!0}),this.$root.$emit("product.refresh"),this.clear()}).catch(s=>{console.log(s)});else if(!this.pricingId&&this.type=="pricing"&&this.editing){let s={pricing:this.form.pricing,productCode:this.productCode};axios.post("/inventory/products/pricing",s).then(t=>{this.$swal({title:"Pricing for country added",type:"success",showConfirmButton:!0}),this.$root.$emit("product.refresh"),this.back()}).catch(t=>{console.log(t)})}else this.pricingId&&(this.type=="country"||this.type=="product")?axios.patch(`/inventory/countries/pricing/${this.pricingId}`,this.form.country).then(s=>{this.$swal({title:"Pricing updated",type:"success",showConfirmButton:!0}),this.back()}).catch(s=>{console.log(s)}):this.productCodeId&&this.type=="product"?axios.patch(`/inventory/products/${this.productCodeId}`,this.productCodeEdit).then(s=>{this.$swal({title:"Product updated",type:"success",showConfirmButton:!0}),this.$root.$emit("product.refresh"),this.getOptions(),this.back()}).catch(s=>{this.errors=s.response.data.errors}):!this.productCodeId&&this.type=="product"&&axios.post("/inventory/products",this.productCodeEdit).then(s=>{this.$swal({title:"Product added",type:"success",showConfirmButton:!0}),this.$root.$emit("product.refresh"),this.clear()}).catch(s=>{this.errors=s.response.data.errors})},back(){let s=JSON.parse(JSON.stringify(this.productCodeId));this.clear(!1),this.productCodeId=s,this.getProductCode(),this.getPriceList(),this.editing=!1},edit(s){this.editing=!0,this.productCode.Type==2?this.type="country":this.type="product",this.form.country.country=s.Code,this.form.country.price=s.UnformattedPrice,this.pricingId=s.PricingID},editProduct(s=!1){this.editing=!0,this.type="product",this.productCodeEdit=JSON.parse(JSON.stringify(this.productCode))},addPricing(){this.clients.length==0?this.getClients(()=>{this.editing=!0,this.type="pricing"}):(this.editing=!0,this.type="pricing")},clear(s=!0){s&&(this.visible=!1),this.form={country:{price:!1,country:!1},pricing:{price:!1,client:!1},product:{}},this.editing=!1,this.productCodeId=!1,this.productCodeEdit={},this.pricingId=!1,this.errors=[]},checkFields(s){if(this.override){s();return}this.selectedItem.FMDExpiryDate==""||this.selectedItem.FMDExpiryDate==null||!/[\d]{2}\/[\d]{4}/.test(this.selectedItem.FMDExpiryDate)?this.errors.FMDExpiryDate=!0:this.errors.FMDExpiryDate=!1,this.errors.FMDBatchID=this.selectedItem.FMDBatchID==""||this.selectedItem.FMDBatchID==null,!this.errors.FMDExpiryDate&&!this.errors.FMDBatchID&&s()},setOptions(s){s?(this.callback=s.callback?s.callback:!1,this.callbackData=s.callbackData?s.callbackData:!1,this.buttonText=s.text?s.text:!1):(this.callback=!1,this.callbackData=!1,this.buttonText=!1)}}};var C=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[t.visible?e("div",{staticClass:"esa-modal",attrs:{id:"productEditor",tabindex:"-1",role:"dialog","aria-labelledby":"itemEditorLabel","aria-modal":"true"}},[e("div",{staticClass:"backdrop",on:{click:function(r){return t.clear()}}}),e("div",{staticClass:"modal",attrs:{role:"document"}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"heading lead"},[t._v(" "+t._s(t.title)+" ")]),e("span",{staticClass:"close",on:{click:function(r){return t.clear()}}},[t._v("X")])]),t.productCodeId&&!t.pricingId&&!t.editing?e("div",{staticClass:"modal-header",staticStyle:{background:"transparent","box-shadow":"none","border-bottom":"1px solid gainsboro",display:"flex","align-items":"center"}},[e("button",{staticClass:"btn btnSize02 tertiaryBtn",on:{click:function(r){return t.editProduct(t.productCode)}}},[t._v(" Update Product Code ")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeId,expression:"productCodeId"}],staticClass:"ml-10 browser-default custom-select",attrs:{name:"ProductCodeID"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.productCodeId=r.target.multiple?o:o[0]}}},[e("option",{attrs:{value:""}},[t._v("SELECT")]),t._l(t.options,function(r){return e("option",{key:r.ProductCodeID,domProps:{value:r.ProductCodeID}},[t._v(t._s(r.Name))])})],2),t.productCode.Status==1?e("button",{staticClass:"ml-10 btn btnSize02 tertiaryBtn",on:{click:function(r){return t.deleteProduct()}}},[t._v(" DEACTIVATE ProductCode ")]):e("button",{staticClass:"ml-10 btn btnSize02 tertiaryBtn",on:{click:function(r){return t.reactivateProduct()}}},[t._v(" ACTIVATE ProductCode ")])]):t._e(),e("div",{staticClass:"modal-body text-center"},[e("div",{staticClass:"expand-100 d-flex justify-content-between"},[e("div",{staticClass:"row wow fadeIn",staticStyle:{width:"100%"}},[t.productCodeId&&!t.pricingId&&!t.editing?e("div",{staticClass:"col-lg-12 wow fadeIn"},[t.list.length>0?e("table",{staticClass:"table table-hover",attrs:{id:"products-table"}},[e("thead",{staticClass:"primary-color text-white"},[t._l(t.list[0],function(r,o){return["UnformattedPrice","PricingID"].includes(o)?t._e():e("th",{key:o},[t._v(" "+t._s(o)+" ")])}),e("th",[t._v(" Options ")])],2),e("tbody",t._l(t.list,function(r){return e("tr",{key:r.Code},[t._l(r,function(o,i){return["UnformattedPrice","PricingID"].includes(i)?t._e():e("td",{key:i},[t._v(" "+t._s(o)+" ")])}),e("td",[e("button",{staticClass:"table-icon",on:{click:function(o){return t.edit(r)}}},[e("i",{staticClass:"fa fa-edit",staticStyle:{color:"white"}})]),r.ClientID!="DEFAULT"?e("button",{staticClass:"table-icon",on:{click:function(o){return t.removePricing(r.PricingID)}}},[e("i",{staticClass:"fa fa-trash",staticStyle:{color:"white"}})]):t._e()])],2)}),0)]):t._e()]):!t.productCodeId&&t.type=="country"?e("div",{staticClass:"pxp-form"},[e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"CountryID"}},[t._v("Select Country")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.country.country,expression:"form.country.country"}],staticClass:"browser-default custom-select",attrs:{name:"CountryID"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.form.country,"country",r.target.multiple?o:o[0])}}},t._l(t.countries,function(r){return e("option",{key:r.CountryID,domProps:{value:r.CountryID}},[t._v(t._s(r.Name))])}),0)])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Price"}},[t._v("Price")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.country.price,expression:"form.country.price"}],staticClass:"form-control",attrs:{name:"Price",autocomplete:"off",type:"number",id:"value",placeholder:"Default Price"},domProps:{value:t.form.country.price},on:{input:function(r){r.target.composing||t.$set(t.form.country,"price",r.target.value)}}})])])]):t.pricingId&&t.editing?e("div",{staticClass:"pxp-form"},[e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Price"}},[t._v("Price")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.country.price,expression:"form.country.price"}],staticClass:"form-control",attrs:{name:"Price",autocomplete:"off",type:"number",id:"value",placeholder:"Price"},domProps:{value:t.form.country.price},on:{input:function(r){r.target.composing||t.$set(t.form.country,"price",r.target.value)}}})])])]):t.type=="pricing"&&t.editing?e("div",{staticClass:"pxp-form wow fadeIn"},[e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"ClientID"}},[t._v("Client")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.pricing.client,expression:"form.pricing.client"}],staticClass:"browser-default custom-select",attrs:{name:"ClientID"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.form.pricing,"client",r.target.multiple?o:o[0])}}},[e("option",{domProps:{value:0}},[t._v("DEFAULT")]),t._l(t.clients,function(r){return e("option",{key:r.ClientID,domProps:{value:r.ClientID}},[t._v(t._s(r.CompanyName))])})],2)])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Price"}},[t._v("Price")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.pricing.price,expression:"form.pricing.price"}],staticClass:"form-control",attrs:{name:"Price",autocomplete:"off",type:"number",id:"value",placeholder:"Price"},domProps:{value:t.form.pricing.price},on:{input:function(r){r.target.composing||t.$set(t.form.pricing,"price",r.target.value)}}})])])]):t.type=="product"&&t.editing?e("div",{staticClass:"pxp-form wow fadeIn"},[e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"code"}},[t._v("Code")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Code,expression:"productCodeEdit.Code"}],staticClass:"form-control mb-3",attrs:{type:"text",id:"code",placeholder:"Code"},domProps:{value:t.productCodeEdit.Code},on:{input:function(r){r.target.composing||t.$set(t.productCodeEdit,"Code",r.target.value)}}}),e("label",{attrs:{for:"code"}},[t._v("CAUTION : changing this will affect pricing")]),t.errors.Code?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Code[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"name"}},[t._v("Name")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Name,expression:"productCodeEdit.Name"}],staticClass:"form-control mb-3",attrs:{type:"text",id:"name",placeholder:"Name"},domProps:{value:t.productCodeEdit.Name},on:{input:function(r){r.target.composing||t.$set(t.productCodeEdit,"Name",r.target.value)}}}),t.errors.Name?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Name[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Quantity"}},[t._v("Quantity")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Quantity,expression:"productCodeEdit.Quantity"}],staticClass:"form-control mb-3",attrs:{type:"text",id:"Quantity",placeholder:"Quantity"},domProps:{value:t.productCodeEdit.Quantity},on:{input:function(r){r.target.composing||t.$set(t.productCodeEdit,"Quantity",r.target.value)}}}),e("label",{attrs:{for:"Quantity"}},[t._v("CAUTION : changing this will affect pricing")]),t.errors.Quantity?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Quantity[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Units"}},[t._v("Units")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Units,expression:"productCodeEdit.Units"}],staticClass:"form-control mb-3",attrs:{type:"text",id:"Units",placeholder:"Units"},domProps:{value:t.productCodeEdit.Units},on:{input:function(r){r.target.composing||t.$set(t.productCodeEdit,"Units",r.target.value)}}}),t.errors.Units?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Units[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"TariffCode"}},[t._v("Tariff Code")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.TariffCode,expression:"productCodeEdit.TariffCode"}],staticClass:"form-control mb-3",attrs:{type:"text",id:"TariffCode",placeholder:"Tariff Code"},domProps:{value:t.productCodeEdit.TariffCode},on:{input:function(r){r.target.composing||t.$set(t.productCodeEdit,"TariffCode",r.target.value)}}}),t.errors.TariffCode?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.TariffCode[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Fridge"}},[t._v("Fridge")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Fridge,expression:"productCodeEdit.Fridge"}],staticClass:"browser-default custom-select",attrs:{name:"Fridge"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"Fridge",r.target.multiple?o:o[0])}}},[t.productCodeEdit.Units=="SHIPPING"?e("option",{domProps:{value:null}},[t._v("NOT APPLICABLE")]):t._e(),t.productCodeEdit.Units!="SHIPPING"?e("option",{attrs:{value:"0",selected:""}},[t._v("No")]):t._e(),t.productCodeEdit.Units!="SHIPPING"?e("option",{attrs:{value:"1"}},[t._v("Yes")]):t._e()]),t.errors.Fridge?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Fridge[0]))]):t._e()])]),e("div",{staticClass:"form-column"},[e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"ProductType"}},[t._v("Product Type")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.ProductType,expression:"productCodeEdit.ProductType"}],staticClass:"browser-default custom-select",attrs:{name:"ProductType"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"ProductType",r.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"1",selected:""}},[t._v("Medicine")]),e("option",{attrs:{value:"2"}},[t._v("Test Kit")])]),t.errors.ProductType?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.ProductType[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"OTC"}},[t._v("Reclassification")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.OTC,expression:"productCodeEdit.OTC"}],staticClass:"browser-default custom-select",attrs:{name:"OTC"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"OTC",r.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"0",selected:""}},[t._v("POM")]),e("option",{attrs:{value:"1"}},[t._v("p")])]),t.errors.OTC?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.OTC[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Pack"}},[t._v("Pack")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Pack,expression:"productCodeEdit.Pack"}],staticClass:"browser-default custom-select",attrs:{name:"Pack"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"Pack",r.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"0",selected:""}},[t._v("No")]),e("option",{attrs:{value:"1"}},[t._v("Yes")])]),t.errors.Pack?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Pack[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"Status"}},[t._v("Status")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.Status,expression:"productCodeEdit.Status"}],staticClass:"browser-default custom-select",attrs:{name:"Status"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"Status",r.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"1",selected:""}},[t._v("Active")]),e("option",{attrs:{value:"0"}},[t._v("Inactive")]),e("option",{attrs:{value:"2"}},[t._v("Discontinued")])]),t.errors.Status?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.Status[0]))]):t._e()]),e("div",{staticClass:"form-group form-group-2"},[e("label",{attrs:{for:"VAT"}},[t._v("VAT %")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.productCodeEdit.VAT,expression:"productCodeEdit.VAT"}],staticClass:"browser-default custom-select",attrs:{name:"VAT"},on:{change:function(r){var o=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var a="_value"in i?i._value:i.value;return a});t.$set(t.productCodeEdit,"VAT",r.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"",disabled:""}},[t._v("Please select VAT value")]),e("option",{attrs:{value:"0",selected:""}},[t._v("0.00%")]),e("option",{attrs:{value:"5"}},[t._v("5.00%")]),e("option",{attrs:{value:"20"}},[t._v("20.00%")])]),t.errors.VAT?e("div",{staticClass:"invalid-feedback d-block"},[t._v(t._s(t.errors.VAT[0]))]):t._e()])])]):t._e()])])]),e("div",{staticClass:"modal-footer"},[t.editing?e("button",{staticClass:"btn btnSize02 tertiaryBtn",attrs:{disabled:t.saving,type:"button"},on:{click:function(r){return t.save()}}},[t._v(" "+t._s(t.saveButtonText)+" ")]):t._e(),!t.editing&&t.productCodeId?e("button",{staticClass:"btn btnSize02 tertiaryBtn",attrs:{disabled:t.saving,type:"button"},on:{click:function(r){return t.addPricing()}}},[t._v(" Add New Pricing ")]):t._e(),t.editing&&t.productCodeId?e("button",{staticClass:"btn btnSize02 tertiaryBtn",attrs:{disabled:t.saving,type:"button"},on:{click:function(r){return t.back()}}},[t._v(" Back ")]):t._e(),e("button",{staticClass:"btn btnSize02 tertiaryBtn",attrs:{disabled:t.saving,type:"button"},on:{click:function(r){return t.clear()}}},[t._v(" Cancel ")])])])]):t._e()])},b=[],y=l(g,C,b,!1,null,null,null,null);const x=y.exports,P={components:{LabelEdit:x,Treeselect:p},mixins:[f,v],data(){return{loading:!1,filtersVisible:!1,hiddenColumns:["WLID","CountryID","Group","Status","editing","new","Description"],labels:[],productFilter:[],labelsUnedited:[],products:[],productsList:[],productsExpanded:[],productsAdd:[],countries:[],alphabet:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],columns:{label:["Country","Description","Options"]},filter:{letter:"all",company:0,fridge:"all",productType:"all",reclassification:"all",package:"all",fdb:"0",name:{status:!1,value:""},code:{status:!1,value:""}},values:{name:"",code:""},tab:"drug"}},mounted(){this.getLabels(),this.getCountries(),this.$root.$on("product.refresh",()=>{this.getLabels()})},destroyed(){this.$root.$off("product.refresh")},computed:{visibleColumns(){return this.columns.label},searchString(){return`?product=${this.productFilter}`},visibleLabels(){return this.labels},groupedLabels(){let s=[],t=[];this.labels.forEach(e=>{typeof s[e.Group]>"u"&&(s[e.Group]={array:[],group:e.Group}),s[e.Group].array.push(e)});for(const e in s)t.push(s[e]);return t},groups(){let s=[];return this.labels.forEach(t=>{s.includes(t.Group)||s.push(t.Group)}),s},csvUrl(){return this.tab=="drug"?`/inventory/products/csv${this.searchString}`:`/inventory/countries/csv${this.searchString}`}},watch:{searchString(){this.getLabels()}},methods:{loadOptions:_.debounce(function({action:s,searchQuery:t,callback:e}){s===h.ASYNC_SEARCH&&this.getProductList(t,r=>{let o=[];r.forEach(i=>{o.push({id:i.ProductCodeID,label:i.Name})}),e(null,o)})},500),sanitizeDescription(s){return m.sanitize(s)},getLabels(){this.loading=!0,axios.get(`/labels${this.searchString}`).then(s=>{this.labels=s.data.data,this.labelsUnedited=JSON.parse(JSON.stringify(s.data.data)),this.push=0}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loading=!1})},saveFilter(s){this.filter[s].value=this.values[s],this.toggleFilter(s)},clearFilter(s){this.filter[s].value="",this.values[s]="",this.filter[s].status=!1},toggleFilter(s){this.filter[s].status=!this.filter[s].status,this.filter[s].status&&setTimeout(()=>{let t=document.getElementById(`${s}-filter`);t.focus(),t.select()},10)},getCountries(){this.loading=!0,axios.get("/countries").then(s=>{this.countries=s.data.data}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loading=!1})},getProductList(s="",t=!1){let e=s!=""?`?filter=${s}`:"";axios.get(`/products${e}`).then(r=>{t?t(r.data.data):this.productsList=r.data.data}).catch(r=>{console.log(r),this.postError(r.response.data.message)})},editLabel(s){s.editing=!0},addLabel(s){let t={CountryID:1,Description:"",Group:s,Status:1,editing:!0,new:!0,WLID:Date.now()};this.labels.unshift(t)},updateLabel(s){axios.patch(`/labels/${s.WLID}`,s).then(t=>{this.logSystemActivity(s.WLID,6,608,s),this.postSuccess("Changes saved"),this.getLabels()}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{s.editing=!1})},cancelEdit(s){let t=this.labelsUnedited.find(e=>e.WLID===s.WLID);s.Description=t.Description,s.editing=!1},saveLabel(s){axios.post("/labels",s).then(t=>{this.labels.splice(this.labels.findIndex(e=>e.WLID===s.WLID),1),this.labels.unshift(t.data.data),this.logSystemActivity(0,6,600,s),this.postSuccess(t.data.message)}).catch(t=>{this.postError(t.response.data.message)})},deleteLabel(s){this.$swal({title:"Delete Label",html:"Are you sure you want to delete this label?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(t=>{t.value&&axios.delete(`/labels/${s.WLID}`).then(e=>{this.labels.splice(this.labels.findIndex(r=>r.WLID===s.WLID),1),this.logSystemActivity(s.WLID,6,601,[]),this.postSuccess(e.data.message)}).catch(e=>{this.postError(e.response.data.message)})})},removeProduct(s,t){this.$swal({title:"Remove product",html:"Are you sure you want to remove product from this group?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(e=>{e.value&&axios.delete(`/labels/group/${t}/products/${s}`).then(r=>{this.getProducts(t),this.logSystemActivity(s,6,602,{group:t,productCodeId:s}),this.postSuccess(r.data.message)}).catch(r=>{this.postError(r.response.data.message)})})},addProduct(s,t){axios.put(`/labels/group/${t}/products/${s}`).then(e=>{this.getProducts(t),this.logSystemActivity(s,6,603,{group:t,productCodeId:s}),this.postSuccess(e.data.message)}).catch(e=>{this.postError(e.response.data.message)})},addGroup(){this.labels.unshift({Group:0,editing:!0,new:!0,CountryID:1,Country:"",Description:"",Status:1,Name:""})},showProducts(s){this.productsExpanded.includes(s)?(this.productsExpanded.splice(this.productsExpanded.indexOf(s),1),this.products.splice(s,1)):this.getProducts(s,()=>{this.productsExpanded.push(s)})},getProducts(s,t=!1){axios.get(`/labels/group/${s}/products`).then(e=>{this.products.splice(s,1),this.products[s]=e.data.data,t&&t()}).catch(e=>{this.postError(e.response.data.message)})},cancelLabel(s){this.labels.splice(this.labels.findIndex(t=>t.WLID===s.WLID),1)},openEditModal(s){this.$root.$emit("label.add")},check(s,t){t==1?axios.post(`/labels/${s}/disable`).then(e=>{this.logSystemActivity(s,6,604,[]),this.postWarning("Label disabled")}).catch(e=>{console.log(e)}).finally(()=>{this.getLabels()}):axios.post(`/labels/${s}/enable`).then(e=>{this.logSystemActivity(s,6,607,[]),this.postSuccess("Label enabled")}).catch(e=>{console.log(e)}).finally(()=>{this.getLabels()})},checkProduct(s,t,e){e==1?axios.post(`/labels/${t}/disable/product`,{code:s}).then(r=>{this.logSystemActivity(t,6,605,{code:s,group:t}),this.postWarning("Label disabled")}).catch(r=>{console.log(r)}).finally(()=>{this.getProducts(t)}):axios.post(`/labels/${t}/enable/product`,{code:s}).then(r=>{this.logSystemActivity(t,6,606,{code:s,group:t}),this.postSuccess("Label enabled")}).catch(r=>{console.log(r)}).finally(()=>{this.getProducts(t)})}}};var w=function(){var t=this,e=t._self._c;return e("section",{staticClass:"products natcol-table content"},[e("section",{staticClass:"card"},[t._m(0),e("div",{staticClass:"products-header mb-10"},[e("div",{staticClass:"products-navigation"},[e("div",{staticClass:"products-buttons",staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[e("button",{staticClass:"btn btnSize02 secondaryBtn mt-10 ml-10",attrs:{title:"Add New Cautionary and Advisory Label"},on:{click:function(r){return t.addGroup()}}},[e("i",{staticClass:"fa fa-plus"}),t._v(" Add New Group ")]),e("treeselect",{staticClass:"mt-10 ml-10",attrs:{async:!0,searchable:!0,multiple:!0,"close-on-select":!1,"open-on-click":!0,"open-on-focus":!0,"clear-on-select":!0,"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"default-options":t.productsList,"load-options":t.loadOptions,"append-to-body":!1,disabled:t.loading},model:{value:t.productFilter,callback:function(r){t.productFilter=r},expression:"productFilter"}})],1)])]),e("div",{staticClass:"card-body"},[e("div",{staticClass:"products-body",attrs:{id:"warning-label-table"}},[e("table",{staticClass:"table table-hover"},[e("thead",{staticClass:"primary-color text-white"},[e("tr",t._l(t.visibleColumns,function(r,o){return e("th",{key:o},[e("span",[t._v(t._s(r))])])}),0)]),t._l(t.groupedLabels,function(r,o){return t.labels.length>0?e("tbody",{key:o},[e("tr",[e("td",{staticStyle:{background:"rgb(60 165 168)",border:"solid 1px rgb(60 165 168)",color:"#fff","padding-left":"15px!important","font-size":"18px"},attrs:{colspan:"2"}},[r.group==0?e("span",[t._v("New Group")]):e("span",[t._v("Group "+t._s(r.group))])]),e("td",{staticStyle:{background:"rgb(60 165 168)",border:"solid 1px rgb(60 165 168)",color:"#fff"},attrs:{colspan:"1"}},[e("button",{staticClass:"btn btn-primary waves-effect table-icon",attrs:{title:"Add Label"},on:{click:function(i){return t.addLabel(r.group)}}},[e("i",{staticClass:"fa fa-plus"})]),e("button",{staticClass:"btn btn-primary waves-effect table-icon",attrs:{title:"Show products"},on:{click:function(i){return t.showProducts(r.group)}}},[e("i",{staticClass:"fa",class:[t.productsExpanded.includes(r.group)?"fa-caret-up":"fa-caret-down"]})])])]),t.productsExpanded.includes(r.group)?e("tr",[e("td",{attrs:{colspan:"3"}},[t.products[r.group]&&t.products[r.group].length>0?e("table",[e("thead",[e("tr",[e("th",{staticStyle:{background:"white","border-bottom":"1px solid gainsboro"},attrs:{colspan:"4"}},[e("div",{staticStyle:{display:"flex","justify-content":"flex-start","align-items":"center"}},[e("treeselect",{attrs:{"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"load-options":t.loadOptions,async:!0,"append-to-body":!1,disabled:t.loading},model:{value:t.productsAdd[r.group],callback:function(i){t.$set(t.productsAdd,r.group,i)},expression:"productsAdd[v.group]"}}),t.productsAdd[r.group]?e("button",{staticClass:"btn btnSize02 tertiaryBtn ml-10",on:{click:function(i){return t.addProduct(t.productsAdd[r.group],r.group)}}},[t._v("Add")]):t._e()],1)])]),t._m(1,!0)]),e("tbody",t._l(t.products[r.group],function(i){return e("tr",{key:i.Code},[e("td",[t._v(" "+t._s(i.Code)+" ")]),e("td",[t._v(" "+t._s(i.Name)+" ("+t._s(i.Quantity)+" "+t._s(i.Units)+") ")]),e("td",[e("button",{staticClass:"btn btn-primary table-icon table-icon-danger",attrs:{title:"Remove product from group"},on:{click:function(a){return t.removeProduct(i.ProductCodeID,r.group)}}},[e("i",{staticClass:"fa fa-trash"})])])])}),0)]):e("div",{staticStyle:{height:"80px"}},[e("ul",{staticStyle:{"z-index":"9",position:"absolute"}},[e("li",{staticStyle:{"padding-bottom":"10px","padding-top":"10px"}},[e("div",{staticStyle:{display:"flex","justify-content":"flex-start","align-items":"center"}},[e("treeselect",{attrs:{"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"load-options":t.loadOptions,async:!0,"append-to-body":!1,disabled:t.loading},model:{value:t.productsAdd[r.group],callback:function(i){t.$set(t.productsAdd,r.group,i)},expression:"productsAdd[v.group]"}}),t.productsAdd[r.group]?e("button",{staticClass:"btn btnSize02 tertiaryBtn ml-10",on:{click:function(i){return t.addProduct(t.productsAdd[r.group],r.group)}}},[t._v("Add")]):t._e()],1)]),e("li",[t._v("No products found in this group")])])])])]):t._e(),t._l(r.array,function(i){return e("tr",{key:i.ProductCodeID},[i.editing?e("td",{staticStyle:{"padding-left":"15px!important","max-width":"120px!important"}},[e("select",{directives:[{name:"model",rawName:"v-model",value:i.CountryID,expression:"value.CountryID"}],staticStyle:{padding:"5px"},attrs:{name:"country"},on:{change:function(a){var c=Array.prototype.filter.call(a.target.options,function(n){return n.selected}).map(function(n){var d="_value"in n?n._value:n.value;return d});t.$set(i,"CountryID",a.target.multiple?c:c[0])}}},t._l(t.countries,function(a){return e("option",{key:a.CountryID,domProps:{value:a.CountryID}},[t._v(t._s(a.Name))])}),0)]):e("td",{staticStyle:{"padding-left":"15px!important","max-width":"120px!important"}},[e("span",{domProps:{innerHTML:t._s(i.Country)}})]),e("td",[i.editing?e("textarea",{directives:[{name:"model",rawName:"v-model",value:i.Description,expression:"value.Description"}],staticStyle:{width:"100%",padding:"5px"},attrs:{type:"text"},domProps:{value:i.Description},on:{input:function(a){a.target.composing||t.$set(i,"Description",a.target.value)}}}):e("div",{staticStyle:{padding:"10px"},domProps:{innerHTML:t._s(t.sanitizeDescription(i.Description))}})]),e("td",[i.new?e("div",[i.editing?e("button",{staticClass:"btn btn-primary waves-effect table-icon",attrs:{title:"Save label"},on:{click:function(a){return t.saveLabel(i)}}},[e("i",{staticClass:"fa fa-save"})]):t._e(),i.editing?e("button",{staticClass:"btn btn-primary table-icon table-icon-danger",attrs:{title:"Cancel creating this label"},on:{click:function(a){return t.cancelLabel(i)}}},[e("i",{staticClass:"fa fa-minus"})]):t._e()]):e("div",[i.editing?t._e():e("button",{staticClass:"btn btn-primary waves-effect table-icon",attrs:{title:"Edit this label"},on:{click:function(a){return t.editLabel(i)}}},[e("i",{staticClass:"fa fa-edit"})]),i.editing?t._e():e("button",{staticClass:"btn btn-primary table-icon table-icon-danger",attrs:{title:"Delete this label"},on:{click:function(a){return t.deleteLabel(i)}}},[e("i",{staticClass:"fa fa-trash"})]),i.editing?e("button",{staticClass:"btn btn-primary waves-effect table-icon",attrs:{title:"Save changes to this label"},on:{click:function(a){return t.updateLabel(i)}}},[e("i",{staticClass:"fa fa-save"})]):t._e(),i.editing?e("button",{staticClass:"btn btn-primary table-icon table-icon-danger",attrs:{title:"Undo changes to this label"},on:{click:function(a){return t.cancelEdit(i)}}},[e("i",{staticClass:"fa fa-undo"})]):t._e()])])])})],2):e("tbody",[e("tr",[e("td",{attrs:{colspan:t.visibleColumns.length}},[e("div",{staticClass:"no-results-found"},[t._v(" No matching search results found! ")])])])])})],2)])]),e("div",{staticClass:"products-footer card-footer"})]),e("LabelEdit")],1)},I=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"card-header"},[t("h3",[s._v("Labels")])])},function(){var s=this,t=s._self._c;return t("tr",[t("th",[s._v("Code")]),t("th",[s._v("Name")]),t("th",[s._v("Tools")])])}],D=l(P,w,I,!1,null,null,null,null);const S=D.exports;export{S as default};
