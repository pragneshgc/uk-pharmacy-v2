import{_ as w,P as D,o,f as E,w as L,c as i,b as e,t as p,s as f,v as y,F as m,r as b,d as a,u as C,T,A as S,E as A,B,e as U,j as k,h as I,n as V}from"./app-Day-6uLD.js";import{l as N}from"./logging-D8Y4Ru6_.js";const F={mixins:[D],data:function(){return{userInfo,productCodeId:!1,productCode:{},productCodeEdit:{},pricingId:!1,errors:[],options:[],list:[],clients:[],countries:[],editing:!1,type:"product",form:{country:{price:!1,country:!1},pricing:{price:!1,client:0},product:{}},saving:!1,callback:!1,callbackData:!1,buttonText:!1,override:!1,visible:!1}},computed:{saveButtonText(){return this.buttonText?this.buttonText:!this.productCodeId&&this.editing?"Add":this.pricingId&&this.editing?"Update":"Save Changes"},title(){return this.editing&&this.productCodeId?"Edit Product":this.editing&&!this.productCodeId?"Create Product":"Product List"}},mounted(){this.emitter.on("label.details",this.getProductDetails),this.emitter.on("label.add",this.addProduct),this.clear()},beforeDestroy(){this.emitter.off("product.details",this.getProductDetails),this.emitter.off("product.add"),$("#productEditor").off("hidden.bs.modal")},watch:{productCodeId(){this.getPriceList(),this.getProductCode()},type(t){t=="country"&&this.getCountries()}},methods:{getProductDetails(t){this.productCode=t,this.editing=!1,this.type="product",this.productCodeId=this.productCode.ProductCodeID,this.show()},show(){this.options.length==0&&this.getOptions(),this.visible=!0},getCountries(){axios.get("/countries").then(t=>{this.countries=t.data.data}).catch(t=>{console.log(t)})},getOptions(){axios.get("/inventory/products/list").then(t=>{this.options=t.data.data}).catch(t=>{console.log(t)})},getPriceList(){axios.get(`/inventory/products/${this.productCodeId}/list`).then(t=>{this.list=t.data.data}).catch(t=>{console.log(t)})},getDeliveryCompanies(t=!1){axios.get("/inventory/delivery/list").then(s=>{this.deliveryCompanies=s.data.data,t&&t()}).catch(s=>{console.log(s)})},getClients(t=!1){axios.get("/inventory/clients/list").then(s=>{this.clients=s.data.data,t&&t()}).catch(s=>{console.log(s)})},getProductCode(){axios.get(`/inventory/products/${this.productCodeId}`).then(t=>{this.productCode=t.data.data}).catch(t=>{console.log(t)})},addProduct(){this.editing=!0,this.type="product",this.productCodeId=!1,this.show()},addCountry(){this.editing=!0,this.type="country",this.productCodeId=!1,this.show()},removePricing(t){this.$swal({title:"Are you sure you want to remove this pricing?",text:"This cannot be reverted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, remove it!"}).then(s=>{s.value&&axios.delete(`/inventory/products/pricing/${t}`).then(d=>{this.$swal({title:"Pricing removed",type:"error",showConfirmButton:!0}),this.getPriceList()}).catch(d=>{console.log(d)})})},deleteProduct(){this.$swal({title:"Are you sure you want to deactivate this product?",text:"This can be reverted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, deactivate it!"}).then(t=>{t.value&&axios.delete(`/inventory/products/${this.productCodeId}/delete`).then(s=>{this.$swal({title:"Product has been deactivated",type:"error",showConfirmButton:!0}),this.getProductCode(),this.emitter.emit("product.refresh")}).catch(s=>{console.log(s)})})},reactivateProduct(){this.$swal({title:"Are you sure you want to activate this product?",text:"This can be reverted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, deactivate it!"}).then(t=>{t.value&&axios.post(`/inventory/products/${this.productCodeId}/reactivate`).then(s=>{this.$swal({title:"Product has been reactivated",type:"success",showConfirmButton:!0}),this.getProductCode(),this.emitter.emit("product.refresh")}).catch(s=>{console.log(s)})})},save(){if(!this.productCodeId&&this.type=="country")axios.post("/inventory/countries/pricing",this.form.country).then(t=>{this.$swal({title:"Default pricing for country added",type:"success",showConfirmButton:!0}),this.emitter.emit("product.refresh"),this.clear()}).catch(t=>{console.log(t)});else if(!this.pricingId&&this.type=="pricing"&&this.editing){let t={pricing:this.form.pricing,productCode:this.productCode};axios.post("/inventory/products/pricing",t).then(s=>{this.$swal({title:"Pricing for country added",type:"success",showConfirmButton:!0}),this.emitter.emit("product.refresh"),this.back()}).catch(s=>{console.log(s)})}else this.pricingId&&(this.type=="country"||this.type=="product")?axios.patch(`/inventory/countries/pricing/${this.pricingId}`,this.form.country).then(t=>{this.$swal({title:"Pricing updated",type:"success",showConfirmButton:!0}),this.back()}).catch(t=>{console.log(t)}):this.productCodeId&&this.type=="product"?axios.patch(`/inventory/products/${this.productCodeId}`,this.productCodeEdit).then(t=>{this.$swal({title:"Product updated",type:"success",showConfirmButton:!0}),this.emitter.emit("product.refresh"),this.getOptions(),this.back()}).catch(t=>{this.errors=t.response.data.errors}):!this.productCodeId&&this.type=="product"&&axios.post("/inventory/products",this.productCodeEdit).then(t=>{this.$swal({title:"Product added",type:"success",showConfirmButton:!0}),this.emitter.emit("product.refresh"),this.clear()}).catch(t=>{this.errors=t.response.data.errors})},back(){let t=JSON.parse(JSON.stringify(this.productCodeId));this.clear(!1),this.productCodeId=t,this.getProductCode(),this.getPriceList(),this.editing=!1},edit(t){this.editing=!0,this.productCode.Type==2?this.type="country":this.type="product",this.form.country.country=t.Code,this.form.country.price=t.UnformattedPrice,this.pricingId=t.PricingID},editProduct(t=!1){this.editing=!0,this.type="product",this.productCodeEdit=JSON.parse(JSON.stringify(this.productCode))},addPricing(){this.clients.length==0?this.getClients(()=>{this.editing=!0,this.type="pricing"}):(this.editing=!0,this.type="pricing")},clear(t=!0){t&&(this.visible=!1),this.form={country:{price:!1,country:!1},pricing:{price:!1,client:!1},product:{}},this.editing=!1,this.productCodeId=!1,this.productCodeEdit={},this.pricingId=!1,this.errors=[]},checkFields(t){if(this.override){t();return}this.selectedItem.FMDExpiryDate==""||this.selectedItem.FMDExpiryDate==null||!/[\d]{2}\/[\d]{4}/.test(this.selectedItem.FMDExpiryDate)?this.errors.FMDExpiryDate=!0:this.errors.FMDExpiryDate=!1,this.errors.FMDBatchID=this.selectedItem.FMDBatchID==""||this.selectedItem.FMDBatchID==null,!this.errors.FMDExpiryDate&&!this.errors.FMDBatchID&&t()},setOptions(t){t?(this.callback=t.callback?t.callback:!1,this.callbackData=t.callbackData?t.callbackData:!1,this.buttonText=t.text?t.text:!1):(this.callback=!1,this.callbackData=!1,this.buttonText=!1)}}},O={key:0,class:"esa-modal",id:"productEditor",tabindex:"-1",role:"dialog","aria-labelledby":"itemEditorLabel","aria-modal":"true"},x={class:"modal",role:"document"},M={class:"modal-header"},G={class:"heading lead"},W={key:0,class:"modal-header",style:{background:"transparent","box-shadow":"none","border-bottom":"1px solid gainsboro",display:"flex","align-items":"center"}},z=e("option",{value:""},"SELECT",-1),Q=["value"],H={class:"modal-body text-center"},Y={class:"expand-100 d-flex justify-content-between"},J={class:"row wow fadeIn",style:{width:"100%"}},j={key:0,class:"col-lg-12 wow fadeIn"},R={key:0,id:"products-table",class:"table table-hover"},K={class:"primary-color text-white"},X=e("th",null," Options ",-1),Z=["onClick"],q=e("i",{class:"fa fa-edit",style:{color:"white"}},null,-1),tt=[q],et=["onClick"],st=e("i",{class:"fa fa-trash",style:{color:"white"}},null,-1),ot=[st],it={key:1,class:"pxp-form"},rt={class:"form-column"},dt={class:"form-group form-group-2"},nt=e("label",{for:"CountryID"},"Select Country",-1),lt=["value"],at={class:"form-column"},ct={class:"form-group form-group-2"},ut=e("label",{for:"Price"},"Price",-1),pt={key:2,class:"pxp-form"},ht={class:"form-column"},ft={class:"form-group form-group-2"},gt=e("label",{for:"Price"},"Price",-1),mt={key:3,class:"pxp-form wow fadeIn"},bt={class:"form-column"},yt={class:"form-group form-group-2"},Ct=e("label",{for:"ClientID"},"Client",-1),_t=e("option",{value:0},"DEFAULT",-1),vt=["value"],kt={class:"form-column"},Pt={class:"form-group form-group-2"},It=e("label",{for:"Price"},"Price",-1),wt={key:4,class:"pxp-form wow fadeIn"},Dt={class:"form-column"},$t={class:"form-group form-group-2"},Et=e("label",{for:"code"},"Code",-1),Lt=e("label",{for:"code"},"CAUTION : changing this will affect pricing",-1),Tt={key:0,class:"invalid-feedback d-block"},St={class:"form-group form-group-2"},At=e("label",{for:"name"},"Name",-1),Bt={key:0,class:"invalid-feedback d-block"},Ut={class:"form-group form-group-2"},Vt=e("label",{for:"Quantity"},"Quantity",-1),Nt=e("label",{for:"Quantity"},"CAUTION : changing this will affect pricing",-1),Ft={key:0,class:"invalid-feedback d-block"},Ot={class:"form-group form-group-2"},xt=e("label",{for:"Units"},"Units",-1),Mt={key:0,class:"invalid-feedback d-block"},Gt={class:"form-group form-group-2"},Wt=e("label",{for:"TariffCode"},"Tariff Code",-1),zt={key:0,class:"invalid-feedback d-block"},Qt={class:"form-group form-group-2"},Ht=e("label",{for:"Fridge"},"Fridge",-1),Yt={key:0,value:null},Jt={key:1,value:"0",selected:""},jt={key:2,value:"1"},Rt={key:0,class:"invalid-feedback d-block"},Kt={class:"form-column"},Xt={class:"form-group form-group-2"},Zt=e("label",{for:"ProductType"},"Product Type",-1),qt=e("option",{value:"1",selected:""},"Medicine",-1),te=e("option",{value:"2"},"Test Kit",-1),ee=[qt,te],se={key:0,class:"invalid-feedback d-block"},oe={class:"form-group form-group-2"},ie=e("label",{for:"OTC"},"Reclassification",-1),re=e("option",{value:"0",selected:""},"POM",-1),de=e("option",{value:"1"},"p",-1),ne=[re,de],le={key:0,class:"invalid-feedback d-block"},ae={class:"form-group form-group-2"},ce=e("label",{for:"Pack"},"Pack",-1),ue=e("option",{value:"0",selected:""},"No",-1),pe=e("option",{value:"1"},"Yes",-1),he=[ue,pe],fe={key:0,class:"invalid-feedback d-block"},ge={class:"form-group form-group-2"},me=e("label",{for:"Status"},"Status",-1),be=e("option",{value:"1",selected:""},"Active",-1),ye=e("option",{value:"0"},"Inactive",-1),Ce=e("option",{value:"2"},"Discontinued",-1),_e=[be,ye,Ce],ve={key:0,class:"invalid-feedback d-block"},ke={class:"form-group form-group-2"},Pe=e("label",{for:"VAT"},"VAT %",-1),Ie=e("option",{value:"",disabled:""},"Please select VAT value",-1),we=e("option",{value:"0",selected:""},"0.00%",-1),De=e("option",{value:"5"},"5.00%",-1),$e=e("option",{value:"20"},"20.00%",-1),Ee=[Ie,we,De,$e],Le={key:0,class:"invalid-feedback d-block"},Te={class:"modal-footer"},Se=["disabled"],Ae=["disabled"],Be=["disabled"],Ue=["disabled"];function Ve(t,s,d,h,u,l){return o(),E(T,{name:"fade"},{default:L(()=>[t.visible?(o(),i("div",O,[e("div",{class:"backdrop",onClick:s[0]||(s[0]=r=>l.clear())}),e("div",x,[e("div",M,[e("h3",G,p(l.title),1),e("span",{class:"close",onClick:s[1]||(s[1]=r=>l.clear())},"X")]),t.productCodeId&&!t.pricingId&&!t.editing?(o(),i("div",W,[e("button",{onClick:s[2]||(s[2]=r=>l.editProduct(t.productCode)),class:"btn btnSize02 tertiaryBtn"}," Update Product Code "),f(e("select",{class:"ml-10 browser-default custom-select","onUpdate:modelValue":s[3]||(s[3]=r=>t.productCodeId=r),name:"ProductCodeID"},[z,(o(!0),i(m,null,b(t.options,r=>(o(),i("option",{key:r.ProductCodeID,value:r.ProductCodeID},p(r.Name),9,Q))),128))],512),[[y,t.productCodeId]]),t.productCode.Status==1?(o(),i("button",{key:0,onClick:s[4]||(s[4]=r=>l.deleteProduct()),class:"ml-10 btn btnSize02 tertiaryBtn"}," DEACTIVATE ProductCode ")):(o(),i("button",{key:1,onClick:s[5]||(s[5]=r=>l.reactivateProduct()),class:"ml-10 btn btnSize02 tertiaryBtn"}," ACTIVATE ProductCode "))])):a("",!0),e("div",H,[e("div",Y,[e("div",J,[t.productCodeId&&!t.pricingId&&!t.editing?(o(),i("div",j,[t.list.length>0?(o(),i("table",R,[e("thead",K,[["UnformattedPrice","PricingID"].includes(t.key)?a("",!0):(o(!0),i(m,{key:0},b(t.list[0],(r,v)=>(o(),i("th",{key:v},p(v),1))),128)),X]),e("tbody",null,[(o(!0),i(m,null,b(t.list,r=>(o(),i("tr",{key:r.Code},[["UnformattedPrice","PricingID"].includes(t.k)?a("",!0):(o(!0),i(m,{key:0},b(r,(v,c)=>(o(),i("td",{key:c},p(v),1))),128)),e("td",null,[e("button",{onClick:v=>l.edit(r),class:"table-icon"},tt,8,Z),r.ClientID!="DEFAULT"?(o(),i("button",{key:0,onClick:v=>l.removePricing(r.PricingID),class:"table-icon"},ot,8,et)):a("",!0)])]))),128))])])):a("",!0)])):!t.productCodeId&&t.type=="country"?(o(),i("div",it,[e("div",rt,[e("div",dt,[nt,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[6]||(s[6]=r=>t.form.country.country=r),name:"CountryID"},[(o(!0),i(m,null,b(t.countries,r=>(o(),i("option",{key:r.CountryID,value:r.CountryID},p(r.Name),9,lt))),128))],512),[[y,t.form.country.country]])])]),e("div",at,[e("div",ct,[ut,f(e("input",{name:"Price","onUpdate:modelValue":s[7]||(s[7]=r=>t.form.country.price=r),autocomplete:"off",type:"number",id:"value",placeholder:"Default Price",class:"form-control"},null,512),[[C,t.form.country.price]])])])])):t.pricingId&&t.editing?(o(),i("div",pt,[e("div",ht,[e("div",ft,[gt,f(e("input",{name:"Price","onUpdate:modelValue":s[8]||(s[8]=r=>t.form.country.price=r),autocomplete:"off",type:"number",id:"value",placeholder:"Price",class:"form-control"},null,512),[[C,t.form.country.price]])])])])):t.type=="pricing"&&t.editing?(o(),i("div",mt,[e("div",bt,[e("div",yt,[Ct,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[9]||(s[9]=r=>t.form.pricing.client=r),name:"ClientID"},[_t,(o(!0),i(m,null,b(t.clients,r=>(o(),i("option",{key:r.ClientID,value:r.ClientID},p(r.CompanyName),9,vt))),128))],512),[[y,t.form.pricing.client]])])]),e("div",kt,[e("div",Pt,[It,f(e("input",{name:"Price","onUpdate:modelValue":s[10]||(s[10]=r=>t.form.pricing.price=r),autocomplete:"off",type:"number",id:"value",placeholder:"Price",class:"form-control"},null,512),[[C,t.form.pricing.price]])])])])):t.type=="product"&&t.editing?(o(),i("div",wt,[e("div",Dt,[e("div",$t,[Et,f(e("input",{"onUpdate:modelValue":s[11]||(s[11]=r=>t.productCodeEdit.Code=r),type:"text",id:"code",class:"form-control mb-3",placeholder:"Code"},null,512),[[C,t.productCodeEdit.Code]]),Lt,t.errors.Code?(o(),i("div",Tt,p(t.errors.Code[0]),1)):a("",!0)]),e("div",St,[At,f(e("input",{"onUpdate:modelValue":s[12]||(s[12]=r=>t.productCodeEdit.Name=r),type:"text",id:"name",class:"form-control mb-3",placeholder:"Name"},null,512),[[C,t.productCodeEdit.Name]]),t.errors.Name?(o(),i("div",Bt,p(t.errors.Name[0]),1)):a("",!0)]),e("div",Ut,[Vt,f(e("input",{"onUpdate:modelValue":s[13]||(s[13]=r=>t.productCodeEdit.Quantity=r),type:"text",id:"Quantity",class:"form-control mb-3",placeholder:"Quantity"},null,512),[[C,t.productCodeEdit.Quantity]]),Nt,t.errors.Quantity?(o(),i("div",Ft,p(t.errors.Quantity[0]),1)):a("",!0)]),e("div",Ot,[xt,f(e("input",{"onUpdate:modelValue":s[14]||(s[14]=r=>t.productCodeEdit.Units=r),type:"text",id:"Units",class:"form-control mb-3",placeholder:"Units"},null,512),[[C,t.productCodeEdit.Units]]),t.errors.Units?(o(),i("div",Mt,p(t.errors.Units[0]),1)):a("",!0)]),e("div",Gt,[Wt,f(e("input",{"onUpdate:modelValue":s[15]||(s[15]=r=>t.productCodeEdit.TariffCode=r),type:"text",id:"TariffCode",class:"form-control mb-3",placeholder:"Tariff Code"},null,512),[[C,t.productCodeEdit.TariffCode]]),t.errors.TariffCode?(o(),i("div",zt,p(t.errors.TariffCode[0]),1)):a("",!0)]),e("div",Qt,[Ht,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[16]||(s[16]=r=>t.productCodeEdit.Fridge=r),name:"Fridge"},[t.productCodeEdit.Units=="SHIPPING"?(o(),i("option",Yt,"NOT APPLICABLE")):a("",!0),t.productCodeEdit.Units!="SHIPPING"?(o(),i("option",Jt,"No ")):a("",!0),t.productCodeEdit.Units!="SHIPPING"?(o(),i("option",jt,"Yes")):a("",!0)],512),[[y,t.productCodeEdit.Fridge]]),t.errors.Fridge?(o(),i("div",Rt,p(t.errors.Fridge[0]),1)):a("",!0)])]),e("div",Kt,[e("div",Xt,[Zt,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[17]||(s[17]=r=>t.productCodeEdit.ProductType=r),name:"ProductType"},ee,512),[[y,t.productCodeEdit.ProductType]]),t.errors.ProductType?(o(),i("div",se,p(t.errors.ProductType[0]),1)):a("",!0)]),e("div",oe,[ie,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[18]||(s[18]=r=>t.productCodeEdit.OTC=r),name:"OTC"},ne,512),[[y,t.productCodeEdit.OTC]]),t.errors.OTC?(o(),i("div",le,p(t.errors.OTC[0]),1)):a("",!0)]),e("div",ae,[ce,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[19]||(s[19]=r=>t.productCodeEdit.Pack=r),name:"Pack"},he,512),[[y,t.productCodeEdit.Pack]]),t.errors.Pack?(o(),i("div",fe,p(t.errors.Pack[0]),1)):a("",!0)]),e("div",ge,[me,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[20]||(s[20]=r=>t.productCodeEdit.Status=r),name:"Status"},_e,512),[[y,t.productCodeEdit.Status]]),t.errors.Status?(o(),i("div",ve,p(t.errors.Status[0]),1)):a("",!0)]),e("div",ke,[Pe,f(e("select",{class:"browser-default custom-select","onUpdate:modelValue":s[21]||(s[21]=r=>t.productCodeEdit.VAT=r),name:"VAT"},Ee,512),[[y,t.productCodeEdit.VAT]]),t.errors.VAT?(o(),i("div",Le,p(t.errors.VAT[0]),1)):a("",!0)])])])):a("",!0)])])]),e("div",Te,[t.editing?(o(),i("button",{key:0,disabled:t.saving,onClick:s[22]||(s[22]=r=>l.save()),type:"button",class:"btn btnSize02 tertiaryBtn"},p(l.saveButtonText),9,Se)):a("",!0),!t.editing&&t.productCodeId?(o(),i("button",{key:1,disabled:t.saving,onClick:s[23]||(s[23]=r=>l.addPricing()),type:"button",class:"btn btnSize02 tertiaryBtn"}," Add New Pricing ",8,Ae)):a("",!0),t.editing&&t.productCodeId?(o(),i("button",{key:2,disabled:t.saving,onClick:s[24]||(s[24]=r=>l.back()),type:"button",class:"btn btnSize02 tertiaryBtn"}," Back ",8,Be)):a("",!0),e("button",{disabled:t.saving,onClick:s[25]||(s[25]=r=>l.clear()),type:"button",class:"btn btnSize02 tertiaryBtn"}," Cancel ",8,Ue)])])])):a("",!0)]),_:1})}const Ne=w(F,[["render",Ve]]),Fe={components:{LabelEdit:Ne,Treeselect:S},mixins:[A,N],data(){return{loading:!1,filtersVisible:!1,hiddenColumns:["WLID","CountryID","Group","Status","editing","new","Description"],labels:[],productFilter:[],labelsUnedited:[],products:[],productsList:[],productsExpanded:[],productsAdd:[],countries:[],alphabet:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],columns:{label:["Country","Description","Options"]},filter:{letter:"all",company:0,fridge:"all",productType:"all",reclassification:"all",package:"all",fdb:"0",name:{status:!1,value:""},code:{status:!1,value:""}},values:{name:"",code:""},tab:"drug"}},mounted(){this.getLabels(),this.getCountries(),this.emitter.on("product.refresh",()=>{this.getLabels()})},destroyed(){this.emitter.off("product.refresh")},computed:{visibleColumns(){return this.columns.label},searchString(){return`?product=${this.productFilter}`},visibleLabels(){return this.labels},groupedLabels(){let t=[],s=[];this.labels.forEach(d=>{typeof t[d.Group]>"u"&&(t[d.Group]={array:[],group:d.Group}),t[d.Group].array.push(d)});for(const d in t)s.push(t[d]);return s},groups(){let t=[];return this.labels.forEach(s=>{t.includes(s.Group)||t.push(s.Group)}),t},csvUrl(){return this.tab=="drug"?`/inventory/products/csv${this.searchString}`:`/inventory/countries/csv${this.searchString}`}},watch:{searchString(){this.getLabels()}},methods:{loadOptions:_.debounce(function({action:t,searchQuery:s,callback:d}){t===ASYNC_SEARCH&&this.getProductList(s,h=>{let u=[];h.forEach(l=>{u.push({id:l.ProductCodeID,label:l.Name})}),d(null,u)})},500),sanitizeDescription(t){return B.sanitize(t)},getLabels(){this.loading=!0,axios.get(`/labels${this.searchString}`).then(t=>{this.labels=t.data.data,this.labelsUnedited=JSON.parse(JSON.stringify(t.data.data)),this.push=0}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.loading=!1})},saveFilter(t){this.filter[t].value=this.values[t],this.toggleFilter(t)},clearFilter(t){this.filter[t].value="",this.values[t]="",this.filter[t].status=!1},toggleFilter(t){this.filter[t].status=!this.filter[t].status,this.filter[t].status&&setTimeout(()=>{let s=document.getElementById(`${t}-filter`);s.focus(),s.select()},10)},getCountries(){this.loading=!0,axios.get("/countries").then(t=>{this.countries=t.data.data}).catch(t=>{this.postError(t.response.data.message)}).finally(()=>{this.loading=!1})},getProductList(t="",s=!1){let d=t!=""?`?filter=${t}`:"";axios.get(`/products${d}`).then(h=>{s?s(h.data.data):this.productsList=h.data.data}).catch(h=>{console.log(h),this.postError(h.response.data.message)})},editLabel(t){t.editing=!0},addLabel(t){let s={CountryID:1,Description:"",Group:t,Status:1,editing:!0,new:!0,WLID:Date.now()};this.labels.unshift(s)},updateLabel(t){axios.patch(`/labels/${t.WLID}`,t).then(s=>{this.logSystemActivity(t.WLID,6,608,t),this.postSuccess("Changes saved"),this.getLabels()}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{t.editing=!1})},cancelEdit(t){let s=this.labelsUnedited.find(d=>d.WLID===t.WLID);t.Description=s.Description,t.editing=!1},saveLabel(t){axios.post("/labels",t).then(s=>{this.labels.splice(this.labels.findIndex(d=>d.WLID===t.WLID),1),this.labels.unshift(s.data.data),this.logSystemActivity(0,6,600,t),this.postSuccess(s.data.message)}).catch(s=>{this.postError(s.response.data.message)})},deleteLabel(t){this.$swal({title:"Delete Label",html:"Are you sure you want to delete this label?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(s=>{s.value&&axios.delete(`/labels/${t.WLID}`).then(d=>{this.labels.splice(this.labels.findIndex(h=>h.WLID===t.WLID),1),this.logSystemActivity(t.WLID,6,601,[]),this.postSuccess(d.data.message)}).catch(d=>{this.postError(d.response.data.message)})})},removeProduct(t,s){this.$swal({title:"Remove product",html:"Are you sure you want to remove product from this group?",type:"warning",showCancelButton:!0,confirmButtonColor:"#ff5151",cancelButtonColor:"#d33",confirmButtonText:"Yes!"}).then(d=>{d.value&&axios.delete(`/labels/group/${s}/products/${t}`).then(h=>{this.getProducts(s),this.logSystemActivity(t,6,602,{group:s,productCodeId:t}),this.postSuccess(h.data.message)}).catch(h=>{this.postError(h.response.data.message)})})},addProduct(t,s){axios.put(`/labels/group/${s}/products/${t}`).then(d=>{this.getProducts(s),this.logSystemActivity(t,6,603,{group:s,productCodeId:t}),this.postSuccess(d.data.message)}).catch(d=>{this.postError(d.response.data.message)})},addGroup(){this.labels.unshift({Group:0,editing:!0,new:!0,CountryID:1,Country:"",Description:"",Status:1,Name:""})},showProducts(t){this.productsExpanded.includes(t)?(this.productsExpanded.splice(this.productsExpanded.indexOf(t),1),this.products.splice(t,1)):this.getProducts(t,()=>{this.productsExpanded.push(t)})},getProducts(t,s=!1){axios.get(`/labels/group/${t}/products`).then(d=>{this.products.splice(t,1),this.products[t]=d.data.data,s&&s()}).catch(d=>{this.postError(d.response.data.message)})},cancelLabel(t){this.labels.splice(this.labels.findIndex(s=>s.WLID===t.WLID),1)},openEditModal(t){this.emitter.emit("label.add")},check(t,s){s==1?axios.post(`/labels/${t}/disable`).then(d=>{this.logSystemActivity(t,6,604,[]),this.postWarning("Label disabled")}).catch(d=>{console.log(d)}).finally(()=>{this.getLabels()}):axios.post(`/labels/${t}/enable`).then(d=>{this.logSystemActivity(t,6,607,[]),this.postSuccess("Label enabled")}).catch(d=>{console.log(d)}).finally(()=>{this.getLabels()})},checkProduct(t,s,d){d==1?axios.post(`/labels/${s}/disable/product`,{code:t}).then(h=>{this.logSystemActivity(s,6,605,{code:t,group:s}),this.postWarning("Label disabled")}).catch(h=>{console.log(h)}).finally(()=>{this.getProducts(s)}):axios.post(`/labels/${s}/enable/product`,{code:t}).then(h=>{this.logSystemActivity(s,6,606,{code:t,group:s}),this.postSuccess("Label enabled")}).catch(h=>{console.log(h)}).finally(()=>{this.getProducts(s)})}}},Oe={class:"products natcol-table content"},xe={class:"card"},Me=e("div",{class:"card-header"},[e("h3",null,"Labels")],-1),Ge={class:"products-header mb-10"},We={class:"products-navigation"},ze={class:"products-buttons",style:{display:"flex","align-items":"center","justify-content":"center"}},Qe=e("i",{class:"fa fa-plus"},null,-1),He={class:"card-body"},Ye={id:"warning-label-table",class:"products-body"},Je={class:"table table-hover"},je={class:"primary-color text-white"},Re={style:{background:"rgb(60 165 168)",border:"solid 1px rgb(60 165 168)",color:"#fff","padding-left":"15px!important","font-size":"18px"},colspan:"2"},Ke={key:0},Xe={key:1},Ze={style:{background:"rgb(60 165 168)",border:"solid 1px rgb(60 165 168)",color:"#fff"},colspan:"1"},qe=["onClick"],ts=e("i",{class:"fa fa-plus"},null,-1),es=[ts],ss=["onClick"],os={key:0},is={colspan:"3"},rs={key:0},ds={colspan:"4",style:{background:"white","border-bottom":"1px solid gainsboro"}},ns={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},ls=["onClick"],as=e("tr",null,[e("th",null,"Code"),e("th",null,"Name"),e("th",null,"Tools")],-1),cs=["onClick"],us=e("i",{class:"fa fa-trash"},null,-1),ps=[us],hs={key:1,style:{height:"80px"}},fs={style:{"z-index":"9",position:"absolute"}},gs={style:{"padding-bottom":"10px","padding-top":"10px"}},ms={style:{display:"flex","justify-content":"flex-start","align-items":"center"}},bs=["onClick"],ys=e("li",null,"No products found in this group",-1),Cs={key:0,style:{"padding-left":"15px!important","max-width":"120px!important"}},_s=["onUpdate:modelValue"],vs=["value"],ks={key:1,style:{"padding-left":"15px!important","max-width":"120px!important"}},Ps=["innerHTML"],Is=["innerHTML"],ws=["onUpdate:modelValue"],Ds={key:0},$s=["onClick"],Es=e("i",{class:"fa fa-edit"},null,-1),Ls=[Es],Ts=["onClick"],Ss=e("i",{class:"fa fa-trash"},null,-1),As=[Ss],Bs=["onClick"],Us=e("i",{class:"fa fa-save"},null,-1),Vs=[Us],Ns=["onClick"],Fs=e("i",{class:"fa fa-undo"},null,-1),Os=[Fs],xs={key:1},Ms=["onClick"],Gs=e("i",{class:"fa fa-save"},null,-1),Ws=[Gs],zs=["onClick"],Qs=e("i",{class:"fa fa-minus"},null,-1),Hs=[Qs],Ys={key:1},Js=["colspan"],js=e("div",{class:"no-results-found"}," No matching search results found! ",-1),Rs=[js],Ks=e("div",{class:"products-footer card-footer"},null,-1);function Xs(t,s,d,h,u,l){const r=I("treeselect"),v=I("LabelEdit");return o(),i("section",Oe,[e("section",xe,[Me,e("div",Ge,[e("div",We,[e("div",ze,[e("button",{title:"Add New Cautionary and Advisory Label",class:"btn btnSize02 secondaryBtn mt-10 ml-10",onClick:s[0]||(s[0]=c=>l.addGroup())},[Qe,U(" Add New Group ")]),k(r,{class:"mt-10 ml-10",async:!0,searchable:!0,multiple:!0,"close-on-select":!1,"open-on-click":!0,"open-on-focus":!0,"clear-on-select":!0,"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"default-options":u.productsList,"load-options":l.loadOptions,"append-to-body":!1,modelValue:u.productFilter,"onUpdate:modelValue":s[1]||(s[1]=c=>u.productFilter=c),disabled:u.loading},null,8,["default-options","load-options","modelValue","disabled"])])])]),e("div",He,[e("div",Ye,[e("table",Je,[e("thead",je,[e("tr",null,[(o(!0),i(m,null,b(l.visibleColumns,(c,P)=>(o(),i("th",{key:P},[e("span",null,p(c),1)]))),128))])]),u.labels.length>0?(o(!0),i(m,{key:0},b(l.groupedLabels,(c,P)=>(o(),i("tbody",{key:P},[e("tr",null,[e("td",Re,[c.group==0?(o(),i("span",Ke,"New Group")):(o(),i("span",Xe,"Group "+p(c.group),1))]),e("td",Ze,[e("button",{title:"Add Label",onClick:n=>l.addLabel(c.group),class:"btn btn-primary waves-effect table-icon"},es,8,qe),e("button",{title:"Show products",onClick:n=>l.showProducts(c.group),class:"btn btn-primary waves-effect table-icon"},[e("i",{class:V(["fa",[u.productsExpanded.includes(c.group)?"fa-caret-up":"fa-caret-down"]])},null,2)],8,ss)])]),u.productsExpanded.includes(c.group)?(o(),i("tr",os,[e("td",is,[u.products[c.group]&&u.products[c.group].length>0?(o(),i("table",rs,[e("thead",null,[e("tr",null,[e("th",ds,[e("div",ns,[k(r,{modelValue:u.productsAdd[c.group],"onUpdate:modelValue":n=>u.productsAdd[c.group]=n,"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"load-options":l.loadOptions,async:!0,"append-to-body":!1,disabled:u.loading},null,8,["modelValue","onUpdate:modelValue","load-options","disabled"]),u.productsAdd[c.group]?(o(),i("button",{key:0,class:"btn btnSize02 tertiaryBtn ml-10",onClick:n=>l.addProduct(u.productsAdd[c.group],c.group)},"Add",8,ls)):a("",!0)])])]),as]),e("tbody",null,[(o(!0),i(m,null,b(u.products[c.group],n=>(o(),i("tr",{key:n.Code},[e("td",null,p(n.Code),1),e("td",null,p(n.Name)+" ("+p(n.Quantity)+" "+p(n.Units)+") ",1),e("td",null,[e("button",{title:"Remove product from group",onClick:g=>l.removeProduct(n.ProductCodeID,c.group),class:"btn btn-primary table-icon table-icon-danger"},ps,8,cs)])]))),128))])])):(o(),i("div",hs,[e("ul",fs,[e("li",gs,[e("div",ms,[k(r,{modelValue:u.productsAdd[c.group],"onUpdate:modelValue":n=>u.productsAdd[c.group]=n,"disable-branch-nodes":!0,placeholder:"Select Product","show-count":!0,"default-expand-level":1,"load-options":l.loadOptions,async:!0,"append-to-body":!1,disabled:u.loading},null,8,["modelValue","onUpdate:modelValue","load-options","disabled"]),u.productsAdd[c.group]?(o(),i("button",{key:0,class:"btn btnSize02 tertiaryBtn ml-10",onClick:n=>l.addProduct(u.productsAdd[c.group],c.group)},"Add",8,bs)):a("",!0)])]),ys])]))])])):a("",!0),(o(!0),i(m,null,b(c.array,n=>(o(),i("tr",{key:n.ProductCodeID},[n.editing?(o(),i("td",Cs,[f(e("select",{name:"country","onUpdate:modelValue":g=>n.CountryID=g,style:{padding:"5px"}},[(o(!0),i(m,null,b(u.countries,g=>(o(),i("option",{value:g.CountryID,key:g.CountryID},p(g.Name),9,vs))),128))],8,_s),[[y,n.CountryID]])])):(o(),i("td",ks,[e("span",{innerHTML:n.Country},null,8,Ps)])),e("td",null,[n.editing?f((o(),i("textarea",{key:1,type:"text","onUpdate:modelValue":g=>n.Description=g,style:{width:"100%",padding:"5px"}},`
                                        `,8,ws)),[[C,n.Description]]):(o(),i("div",{key:0,style:{padding:"10px"},innerHTML:l.sanitizeDescription(n.Description)},null,8,Is))]),e("td",null,[n.new?(o(),i("div",xs,[n.editing?(o(),i("button",{key:0,title:"Save label",onClick:g=>l.saveLabel(n),class:"btn btn-primary waves-effect table-icon"},Ws,8,Ms)):a("",!0),n.editing?(o(),i("button",{key:1,title:"Cancel creating this label",onClick:g=>l.cancelLabel(n),class:"btn btn-primary table-icon table-icon-danger"},Hs,8,zs)):a("",!0)])):(o(),i("div",Ds,[n.editing?a("",!0):(o(),i("button",{key:0,title:"Edit this label",onClick:g=>l.editLabel(n),class:"btn btn-primary waves-effect table-icon"},Ls,8,$s)),n.editing?a("",!0):(o(),i("button",{key:1,title:"Delete this label",onClick:g=>l.deleteLabel(n),class:"btn btn-primary table-icon table-icon-danger"},As,8,Ts)),n.editing?(o(),i("button",{key:2,title:"Save changes to this label",onClick:g=>l.updateLabel(n),class:"btn btn-primary waves-effect table-icon"},Vs,8,Bs)):a("",!0),n.editing?(o(),i("button",{key:3,title:"Undo changes to this label",onClick:g=>l.cancelEdit(n),class:"btn btn-primary table-icon table-icon-danger"},Os,8,Ns)):a("",!0)]))])]))),128))]))),128)):(o(),i("tbody",Ys,[e("tr",null,[e("td",{colspan:l.visibleColumns.length},Rs,8,Js)])]))])])]),Ks]),k(v)])}const to=w(Fe,[["render",Xs]]);export{to as default};
//# sourceMappingURL=Labels-BXFW3fFE.js.map
