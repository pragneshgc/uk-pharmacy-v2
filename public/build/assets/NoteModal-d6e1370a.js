import c from"./Modal-76bda924.js";import{E as f,n as d}from"./app-a3e6dddd.js";import{V as u}from"./vue2-editor.esm-3249ef74.js";const p={mixins:[f],props:["orderID"],extends:c,components:{VueEditor:u},data:function(){return{form:{options:[{name:'Patient Note <span style="font-style: italic;">(Patient specific notes)</span>',value:1},{name:"Query Note",value:2},{name:'Order Note <span style="font-size: 13px;">(Order specific notes)</span>',value:3}],Type:0,Note:"",Alert:!1,ReferenceNumber:!1,Subscription:!1},userInfo,error:"",editing:!1,preimport:!1,backdrop:!0,dragEventTriggered:!1}},computed:{options(){return this.preimport?[{name:"Subscription Note",value:4},{name:"Order Note",value:3}]:this.userInfo.role==30?this.form.options:[{name:'Order Note <span style="font-size: 13px;">(Order specific notes)</span>',value:3},{name:'Patient Note <span style="font-size: 13px;">(Patient specific notes)</span>',value:1}]}},mounted(){this.$root.$on("modal.open",(o,e)=>{o==this.modalName&&(this.show.modal=!0),e&&e!="preimport"&&e.Type!=3&&e.Type!=4?(this.editing=e,this.form.Type=e.Type,this.form.Note=e.Note,this.form.Alert=e.Alert!=0,console.log("the note is this")):e&&(e.Type==3||e.Type==4)?(this.editing=e,this.form.Type=e.Type,this.form.Note=e.Note,this.form.Alert=!0,this.preimport=!0,this.form.ReferenceNumber=e.ReferenceNumber):e=="preimport"&&(this.form.Type=4,this.form.Note="",this.form.Alert=!0,this.form.ReferenceNumber="",this.form.Subscription="",this.preimport=!0)}),this.$root.$on("modal.close",o=>{o==this.modalName&&this.close()}),this.$root.$on("modal.close.all",()=>{this.close()})},watch:{"form.ReferenceNumber":_.debounce(function(){this.form.ReferenceNumber&&axios.get(`/order/${this.form.ReferenceNumber}/exists`).then(o=>{o.data.data?this.error="This Reference Number is already in the system!":this.error=""}).catch(o=>{this.error=""})},500),"show.modal":function(){setTimeout(()=>{this.show.modal&&!this.dragEventTriggered&&document.getElementById("draggable-div-note")?(function(e){var t=0,r=0,a=0,i=0;document.getElementById("draggable-div-header-note")?document.getElementById("draggable-div-header-note").onmousedown=n:e.onmousedown=n;function n(s){s=s||window.event,s.preventDefault(),a=s.clientX,i=s.clientY,document.onmouseup=m,document.onmousemove=l}function l(s){s=s||window.event,s.preventDefault(),t=a-s.clientX,r=i-s.clientY,a=s.clientX,i=s.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-t+"px"}function m(){document.onmouseup=null,document.onmousemove=null}}(document.getElementById("draggable-div-note")),this.dragEventTriggered=!0):(this.dragEventTriggered=!1,this.backdrop=!0)},300)}},methods:{reset(){this.form.Type=0,this.form.Note="",this.form.PrescriptionID=0,this.form.NoteID=0,this.form.Alert=!1,this.form.ReferenceNumber="",this.form.Subscription="",this.error="",this.preimport=!1,this.editing=!1},close(){this.reset(),this.show.modal=!1},toggleBackdrop(){this.backdrop=!this.backdrop},submit(){if(this.form.Type==0||this.form.Note==""){this.error="Please fill all of the required fields";return}else this.error="";this.form.Type==3&&(this.form.OrderSpecific=!0),this.preimport?this.form.PrescriptionID=null:this.form.PrescriptionID=this.orderID,axios.post("/note",this.form).then(o=>{this.postSuccess(o.data.message),this.$root.$emit("orderupdate"),this.$root.$emit("alertupdate"),this.reset()}).catch(o=>{this.postError(o.response.data.message)}).finally(()=>{this.show.modal=!1})},update(o){if(this.form.Type==0||this.form.Note==""){this.error="Please fill all of the required fields";return}else this.error="";this.form.Type==3&&(this.form.OrderSpecific=!0),this.form.NoteID=this.editing.NoteID,axios.patch(`/note/${this.form.NoteID}`,this.form).then(e=>{this.postSuccess(e.data.message),this.$root.$emit("orderupdate"),this.$root.$emit("alertupdate"),this.reset()}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.show.modal=!1})}}};var h=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"fade"}},[e.show.modal?t("div",{staticClass:"esa-modal"},[e.backdrop?t("div",{staticClass:"backdrop",on:{click:function(r){return e.close()}}}):e._e(),t("div",{staticClass:"modal",attrs:{id:"draggable-div-note"}},[t("div",{staticClass:"modal-header draggable-div-header",attrs:{id:"draggable-div-header-note"}},[t("h3",[e._v("Create Note")])]),t("div",{staticClass:"modal-body"},[t("form",{on:{submit:function(r){return e.submit()}}},[t("label",{attrs:{for:"note-select"}},[e._v("Note type "),t("small",{staticClass:"danger"},[e._v("(required)")])]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.form.Type,expression:"form.Type"}],staticClass:"table-dropdown mb-10",attrs:{name:"note-select"},on:{change:function(r){var a=Array.prototype.filter.call(r.target.options,function(i){return i.selected}).map(function(i){var n="_value"in i?i._value:i.value;return n});e.$set(e.form,"Type",r.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"0",disabled:""}},[e._v("Please select a type")]),e._l(e.options,function(r){return t("option",{key:r.value,domProps:{value:r.value,innerHTML:e._s(r.name)}})})],2),[1,3].includes(e.form.Type)&&!e.preimport?t("input",{class:{unchecked:!e.form.Alert},attrs:{type:"checkbox",name:"specific"},domProps:{checked:e.form.Alert}}):e._e(),[1,3].includes(e.form.Type)&&!e.preimport?t("label",{staticClass:"mb-10",attrs:{title:"Show in a popup to other users when they view this prescription.",for:"specific"},on:{click:function(r){e.form.Alert=!e.form.Alert}}},[t("b",[e._v("Alert other users")])]):e._e(),e.preimport&&!e.editing&&e.form.Type!=4?t("label",{attrs:{for:"reference-number"}},[e._v("Reference Number "),t("small",{staticClass:"danger"},[e._v("(required)")])]):e._e(),e.preimport&&!e.editing&&e.form.Type==4?t("label",{attrs:{for:"reference-number"}},[e._v("Subscription ID "),t("small",{staticClass:"danger"},[e._v("(required)")])]):e._e(),e.preimport&&!e.editing&&e.form.Type!=4?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.ReferenceNumber,expression:"form.ReferenceNumber"}],staticClass:"form-control tBoxSize02 mb-10",attrs:{name:"reference-number",type:"text"},domProps:{value:e.form.ReferenceNumber},on:{input:function(r){r.target.composing||e.$set(e.form,"ReferenceNumber",r.target.value)}}}):e._e(),e.preimport&&!e.editing&&e.form.Type==4?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.Subscription,expression:"form.Subscription"}],staticClass:"form-control tBoxSize02 mb-10",attrs:{name:"reference-number",type:"text"},domProps:{value:e.form.Subscription},on:{input:function(r){r.target.composing||e.$set(e.form,"Subscription",r.target.value)}}}):e._e(),t("label",{attrs:{for:"message-text"}},[e._v("Note"),t("small",{staticClass:"danger"},[e._v("(required)")])]),t("vue-editor",{model:{value:e.form.Note,callback:function(r){e.$set(e.form,"Note",r)},expression:"form.Note"}}),e.error!=""?t("div",{staticClass:"infoBox warning note-error"},[t("p",[e._v(e._s(this.error))])]):e._e()],1)]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btnSize01 secondaryBtn bigButton",on:{click:function(r){return e.close()}}},[e._v(" Cancel ")]),e.form.Type!=0&&e.form.Note!=""&&!e.editing?t("button",{staticClass:"btn btnSize01 primaryBtn",on:{click:function(r){return e.submit()}}},[e._v(" Save ")]):e.editing?t("button",{staticClass:"btn btnSize01 primaryBtn",on:{click:function(r){return e.update()}}},[e._v(" Update ")]):e._e()]),t("span",{staticClass:"backdrop-toggle",attrs:{title:"Unfocus the modal"},on:{click:function(r){return e.toggleBackdrop()}}},[t("i",{staticClass:"fa fa-clone"})]),t("span",{staticClass:"close",attrs:{title:"Close the modal"},on:{click:function(r){return e.close()}}},[t("i",{staticClass:"fa fa-close"})])])]):e._e()])},v=[],g=d(p,h,v,!1,null,null,null,null);const T=g.exports;export{T as default};
