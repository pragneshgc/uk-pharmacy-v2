const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotesPopup-CKW8TDwu.js","assets/app-Day-6uLD.js","assets/app-DWMI0VDG.css","assets/Modal-C4m4T6Vr.js"])))=>i.map(i=>d[i]);
import{_ as N,k as x,E as w,P as L,a as S,o,f as T,w as b,c as n,j as D,b as s,e as y,t as d,d as u,F as f,r as g,n as m,T as P,h as C}from"./app-Day-6uLD.js";const E={mixins:[x,w,L],components:{Notes:()=>S(()=>import("./NotesPopup-CKW8TDwu.js"),__vite__mapDeps([0,1,2])),Modal:()=>S(()=>import("./Modal-C4m4T6Vr.js"),__vite__mapDeps([3,1,2]))},data(){return{loading:!1,locked:!1,printing:!1,lockTimer:null,historyLoading:!1,notesLoading:!1,notesAlert:!1,duplicate:!1,notesConfirmed:!1,expandHistory:!1,orders:[],notes:[],selected:null,history:[],user:{info:userInfo,selected:userInfo.id,list:[]}}},computed:{trayIds(){return this.$store.state.tray.map(e=>e.PrescriptionID)},filteredHistory(){return this.expandHistory?this.history:this.history.slice(0,3)},totalNotesCount(){return this.notes.length==0?0:this.notes.critical.length+this.notes.information.length+this.notes.other.length},printable(){let e=!1,t=!1;return this.selected.Products.forEach(h=>{h.CorrectName||(e=!0),h.CorrectUnit||(t=!0)}),this.totalNotesCount==0&&!this.duplicate&&!e&&!t?!0:!!this.notesConfirmed}},mounted(){this.getOrders(),this.emitter.on("prescriptionpool.getnotes",this.getNotes),this.emitter.on("orderupdate",this.getNotes),this.emitter.on("alertupdate",this.getNotes),this.emitter.on("prescriptionpool.reprint",this.reprint),this.lockTimer=setInterval(()=>{this.checkLock()},5e3)},destroyed(){this.emitter.off("prescriptionpool.getnotes",this.getNotes),this.emitter.off("orderupdate",this.getNotes),this.emitter.off("alertupdate",this.getNotes),this.emitter.off("prescriptionpool.reprint",this.reprint),clearInterval(this.lockTimer)},watch:{trayIds(e,t){this.getOrders(),t.length==0&&e.length>0&&this.$store.commit("clearLogs")},selected(){this.getHistory(),this.getNotes()},locked(){this.locked||this.getOrders(()=>{let e=JSON.parse(JSON.stringify(this.selected));this.selected=null,this.selectOrder(e),this.takeOverOrder(this.selected.PrescriptionID)})}},methods:{selectOrder(e){this.selected=e,this.selected.Products.forEach(t=>{t.Name!=t.Description?this.alternativeNameCheck(t,this.selected.ClientID,c=>{t.CorrectName=c}):t.CorrectName=!0,t.Unit!=t.product_units?this.alternativeUnitCheck(t,this.selected.ClientID,c=>{t.CorrectUnit=c}):t.CorrectUnit=!0}),this.checkLock(()=>{this.locked||this.takeOverOrder(this.selected.PrescriptionID),this.emitter.emit("prescriptionloaded",{prescription:e})}),this.checkOrderStatuses(this.selected.PrescriptionID)},getOrders(e=!1){this.loading=!0,axios.post("/prescription-pool/quick-tray",{ids:this.trayIds}).then(t=>{this.orders=t.data.data,this.orders.length>0&&!e?this.selectOrder(this.orders[0]):e&&e()}).catch(t=>{console.log(t)}).finally(()=>{this.loading=!1})},checkOrderStatuses(e){axios.get(`/order/${e}/statuses`).then(t=>{this.duplicate=t.data.data.duplicate}).catch(t=>{this.postError(t.response.data.message)})},getHistory(){this.historyLoading=!0,axios.get(`/order/${this.selected.PrescriptionID}/history`).then(e=>{this.expandHistory=!1,this.history=e.data.data}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.historyLoading=!1})},getNotes(){this.notesLoading=!0,this.notesConfirmed=!1,axios.get(`/order/${this.selected.PrescriptionID}/notes`).then(e=>{if(this.notes=e.data.data,this.notes.alerts.length>0){let t=`
                    <div class="medicineDetails" style="width: 100%;">
                    <p>Please review the notes below:</p>
                    <ul class="other">`,c=0,h=0;this.notes.alerts.sort((i,l)=>i.Type>l.Type?1:-1),this.notes.alerts.forEach(i=>{i.DeletedAt==null&&i.EditedAt==null&&(c++,i.Type!=h&&(h=i.Type,t+=`<li class="note-header ${h==1?"note-header__danger":""}"><div>${h==1?"Patient Notes":"Order Notes"}</div></li>`),t+=`
                            <li class="note"
                            title="${i.Type==2?"Queried Alert":i.Type==1?"Patient Alert":"Order Alert"} created by ${i.name} ${i.surname}"
                            style="${i.Type==2?"border-left: 5px solid #32a36a;":i.Type==1?"border-left: 5px solid #ff5151;":""}">
                            <div class="note-body" style="text-align: initial;">
                            <p>${i.Note}</p>
                            </div>
                            <div class="note-footer">
                            <span>${i.name+" "+i.surname}</span>
                            <span>${i.CreatedAt}</span>
                            </div>
                            </li>`)}),t+="</ul></div>",c>0?this.notesAlert=t:this.notesAlert=!1}else this.notesAlert=!1}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.notesLoading=!1})},tryPrint(){this.printable?(this.printing=!0,this.dispenserPrint("delivery",!1,()=>{this.dispenserPrint("label",!1,()=>{this.selected.time=Date.now(),this.selected.action="Printed",this.$store.commit("addLog",this.selected),this.emitter.emit("tray.changeprescriptionstatus",{id:this.selected.PrescriptionID,status:7}),this.printing=!1})})):this.openNotes()},reprint(e){this.dispenserPrint("delivery",e),this.dispenserPrint("label",e);let t={PrescriptionID:e,action:"Reprinted",time:Date.now()};this.$store.commit("addLog",t)},dispenserPrint(e,t=!1,c=!1){t||(t=this.selected.PrescriptionID),e=="delivery"?axios.get(`/order/${t}/view`).then(h=>{let i=h.data.data.url,l=h.data.data.type,_=!1;if(localStorage.getItem("settings.application")&&(_=JSON.parse(localStorage.getItem("settings.application")).deliveryNotePrinter),l=="pdf")this.printUrl(`${i}?token=${this.user.info.token}&print=true`,()=>{this.emitter.emit("orderupdate"),c&&c()},"pdf",_);else{let r=`https://esasys.co.uk/?showFile&PRESCRIPTIONID=${t}`;this.printUrl(r,()=>{axios.get(`/prescription/${t}/log-print?token=${this.user.info.token}`).then(a=>{this.emitter.emit("orderupdate"),c&&c()}).catch(a=>{console.log(a),this.postError(a.response.data.message)})},"pdf",_)}}).catch(h=>{this.postError(h.response.data.message)}):e=="label"&&axios.get(`/order/${t}/label`).then(h=>{let i=h.data.data.url,l=!1;localStorage.getItem("settings.application")&&(l=JSON.parse(localStorage.getItem("settings.application")).labelPrinter),this.printUrl(`${i}?token=${this.user.info.token}&print=true`,()=>{this.emitter.emit("orderupdate"),c&&c()},"pdf",l,!0)}).catch(h=>{console.log(h),this.postError(h.response.data.message)})},openNotes(){this.emitter.emit("modal.open","quicktraynotes")},confirmNotes(){this.notesConfirmed=!0,this.emitter.emit("modal.close","quicktraynotes")},showNotesAlert(){this.$swal({title:"Important notes!",html:this.notesAlert,type:"warning",showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,focusConfirm:!1,confirmButtonColor:"#3085d6",confirmButtonText:"I've read these notes!"}).then(e=>{e.value&&(this.notesAlert=!1)})},statusClass(e){return[1,7].includes(e)?"active":[2,8].includes(e)?"success":[4,5,9,10,11,12,13,14,15].includes(e)?"warning":[16].includes(e)?"returned":[3,6].includes(e)?"error":""},checkLock(e=!1){this.selected&&axios.get(`/logs/locked/${this.selected.PrescriptionID}`).then(t=>{t.data.data?this.locked=t.data.data.Name+" "+t.data.data.Surname:this.locked=!1}).catch(t=>{console.log(t),this.locked=!1}).finally(()=>{e&&e()})},unlockOrder(e){axios.post(`logs/unlock/${e}`).then(t=>{this.locked=!1}).catch(t=>{console.log(t),this.locked=!1})},takeOverOrder(e){axios.post(`logs/takeover/${e}`).then(t=>{this.locked=!1}).catch(t=>{console.log(t),this.locked=!1})},alternativeNameCheck(e,t,c){axios.get(`/inventory/products/alternative-name?code=${e.ProductCodeID}&name=${encodeURI(e.Description)}&client=${t}`).then(h=>{c(h.data.data)}).catch(h=>{this.postError(h.response.data.message)})},alternativeUnitCheck(e,t,c){axios.get(`/inventory/products/alternative-unit?code=${e.ProductCodeID}&unit=${encodeURI(e.Unit)}&client=${t}`).then(h=>{c(h.data.data)}).catch(h=>{this.postError(h.response.data.message)})},discrepancyResolution(e,t=!1){e?(this.loading=!0,axios.post("/inventory/products/approve-discrepancy",{ProductCodeID:t.ProductCodeID,ClientID:this.prescription.ClientID,UserID:this.userInfo.id,AlternativeName:t.Description}).then(c=>{this.postSuccess("Alternative name approved"),this.loading=!1,this.search()}).catch(c=>{this.loading=!1,this.postError(c.response.data.message)})):(this.prescriptionStatus=91,this.updateStatus())},redirect(e){this.$router.push({name:"prescription",params:{id:e}})}}},O={key:0,class:"card quick-tray"},A=s("h2",null,"Notes and Alerts",-1),M={style:{width:"100%",height:"100%",display:"flex","flex-direction":"column"}},B={style:{margin:"5px"}},$={key:0,style:{background:"#f53c38","font-size":"20px",padding:"5px",width:"100%"},class:"infoBox warning thin-error"},H=["href"],R=["href"],U={class:"card-header"},z={class:"card-body",style:{padding:"0"}},V=s("thead",null,[s("tr",null,[s("th",null,"Prescription"),s("th",null,"Patient"),s("th",null,"Products"),s("th",null,"Notes"),s("th",null,"History"),s("th",{style:{"text-align":"center"}},"Print")])],-1),q=["onDblclick","onClick"],F=["href"],J={class:"mb-5"},j=["innerHTML"],Q={class:"mb-5"},K={class:"mb-5"},W=["innerHTML"],G={key:0,style:{background:"#fe4949",color:"white","text-align":"center",padding:"3px"}},X=["title"],Y=["innerHTML"],Z={key:0,class:"mt-5"},ee=["innerHTML"],te={key:0},se={key:0},ie={title:"",style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"},oe=["href"],ne=["innerHTML"],re={key:0,class:"quick-tray__fridge"},le=["title"],ae=["title"],de={style:{"max-width":"350px","font-size":"11px"}},ce={key:1},he=["innerHTML"],pe={key:0,class:"quick-tray__fridge"},ue=s("b",null,"Fridge",-1),ye=[ue],fe={key:0,style:{display:"flex","justify-content":"space-between","flex-direction":"column"}},ge={key:1},_e={style:{width:"500px"}},me={key:0,class:"medicineHistory notranslate quick-tray__history"},be=["onDblclick","title"],ke=["href"],ve={key:0},De={key:1},Ie={key:1},Pe={key:2},Ce={key:0,style:{padding:"4px",width:"100%"},class:"btn btnSize03 secondaryBtn"},Se=s("i",{class:"fa fa-caret-down",style:{"padding-right":"5px"}},null,-1),Ne={key:1,style:{padding:"4px",width:"100%"},class:"btn btnSize03 secondaryBtn"},we=s("i",{class:"fa fa-caret-up",style:{"padding-right":"5px"}},null,-1),xe={key:1},Le={style:{"vertical-align":"middle","text-align":"center"}},Te=["disabled"],Ee={key:0,style:{"font-size":"25px"},class:"fa fa-print"},Oe={key:1,style:{"font-size":"25px"},class:"fa fa-exclamation-circle"};function Ae(e,t,c,h,i,l){const _=C("Notes"),r=C("Modal");return o(),T(P,{name:"fade"},{default:b(()=>[i.orders.length>0?(o(),n("section",O,[D(r,{class:"duplicate-modal","modal-name":"quicktraynotes"},{header:b(()=>[A]),body:b(()=>[s("div",M,[s("div",null,[s("ul",B,[i.duplicate?(o(),n("li",$,[y(" There is a possible duplicate order with ID "),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}},d(i.duplicate.PrescriptionID),9,H),y(" that has the same customer reference id "+d(i.duplicate.ReferenceID)+" with status "+d(e.orderStatuses[i.duplicate.Status])+d(i.duplicate.SubStatus?` -
                                    ${e.orderSubStatuses[i.duplicate.SubStatus]}`:"")+". Please investigate by clicking ",1),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}}," here ",8,R),y(" before processing. ")])):u("",!0),!e.product.CorrectName||!e.product.CorrectUnit?(o(!0),n(f,{key:1},g(i.selected.Products,(a,p)=>(o(),n("li",{key:p,style:{background:"#f53c38","font-size":"20px",padding:"5px",width:"100%","margin-top":"5px"},class:"infoBox warning thin-error"},[s("span",null," The product name recieved by "+d(i.selected.CompanyName)+" ("+d(a.Description)+" "+d(a.Unit)+") does not match the product name or it's alternatives in ESA ("+d(a.Name)+" "+d(a.product_units)+") ",1)]))),128)):u("",!0)])]),D(_,{locked:i.locked,notes:i.notes,prescription:i.selected},null,8,["locked","notes","prescription"])])]),footer:b(()=>[s("button",{onClick:t[0]||(t[0]=a=>l.confirmNotes()),class:"btn btnSize01 primaryBtn bigButton"},"I'VE READ THESE NOTES!")]),_:1}),s("div",U,[s("h3",null,"Pending Orders ("+d(i.orders.length)+")",1)]),s("div",z,[s("table",null,[V,s("tbody",null,[(o(!0),n(f,null,g(i.orders,a=>(o(),n("tr",{class:m(["clickable quick-tray__item",[i.selected.PrescriptionID==a.PrescriptionID?"selected":"",i.locked&&i.selected.PrescriptionID==a.PrescriptionID?"locked":""]]),onDblclick:p=>l.redirect(a.PrescriptionID),key:a.PrescriptionID,onClick:p=>l.selectOrder(a)},[s("td",null,[s("a",{href:`#/prescription/${a.PrescriptionID}`},[s("div",J,[s("span",{innerHTML:a.ReferenceID},null,8,j)]),s("div",Q,[s("b",null,d(a.CompanyName),1)]),s("div",K,[s("span",{innerHTML:a.Prescriber},null,8,W)]),i.locked&&i.selected.PrescriptionID==a.PrescriptionID?(o(),n("div",G,[s("b",null,"This item is currently opened by "+d(i.locked),1)])):u("",!0)],8,F)]),s("td",{title:`${a.Sex==1?"Male":a.Sex==2?"Female":a.Sex==3?"Transgender":"Other"} born on ${a.DOB} with a BMI of ${a.BMI}`},[s("span",{style:{padding:"2px"},class:m(["gender",[a.Sex==1?"blue":a.Sex==2?"purple":a.Sex==3?"orange":"grey"]])},[s("span",{innerHTML:a["Patient Name"]},null,8,Y),s("small",null," ("+d(a.Age)+" / "+d(a.Sex==1?"Male":a.Sex==2?"Female":a.Sex==3?"Transgender":"Other")+") ",1)],2),i.selected.PrescriptionID==a.PrescriptionID?(o(),n("div",Z,[s("span",{innerHTML:a["Patient Address"]},null,8,ee)])):u("",!0)],8,X),s("td",null,[i.selected.PrescriptionID==a.PrescriptionID?(o(),n("ul",te,[i.duplicate?(o(),n("li",se,[s("b",ie,[y(" Possible duplicate order with ID "),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}},d(i.duplicate.PrescriptionID),9,oe),y(" and status "+d(e.orderStatuses[i.duplicate.Status])+d(i.duplicate.SubStatus?` -
                                            ${e.orderSubStatuses[i.duplicate.SubStatus]}`:"")+". ",1)])])):u("",!0),(o(!0),n(f,null,g(a.Products,(p,k)=>(o(),n("li",{key:k},[s("b",null,[s("span",{innerHTML:p.ShortName},null,8,ne),y(),p.Fridge?(o(),n("span",re,"Fridge")):u("",!0)]),p.CorrectName?u("",!0):(o(),n("b",{key:0,title:`The product name recieved by ${i.selected.CompanyName} (${p.Description}) does not match the product name or it's alternatives in ESA (${p.Name})`,style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"}," Name Mismatch ",8,le)),p.CorrectUnit?u("",!0):(o(),n("b",{key:1,title:`The product name recieved by ${i.selected.CompanyName} (${p.Description}) does not match the product name or it's alternatives in ESA (${p.Name})`,style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"}," Unit Mismatch ",8,ae)),s("div",de,d(p.Instructions),1)]))),128))])):(o(),n("ul",ce,[(o(!0),n(f,null,g(a.Products,(p,k)=>(o(),n("li",{key:k},[s("span",{innerHTML:p.ShortName},null,8,he),y(),p.Fridge?(o(),n("span",pe,ye)):u("",!0)]))),128))]))]),s("td",null,[i.selected.PrescriptionID==a.PrescriptionID?(o(),n("div",fe,[s("div",null,[s("div",{class:m(["quick-tray__note",[i.notes.critical.length>0?"quick-tray__note-warning":""]])},d(i.notes.critical.length)+" Patient Note(s) ",3),s("div",{class:m(["quick-tray__note",[i.notes.correspondence.length+i.notes.information.length>0?"quick-tray__note-warning":""]])},d(i.notes.correspondence.length+i.notes.information.length)+" Queried Note(s) ",3),s("div",{class:m(["quick-tray__note",[i.notes.other.length+(i.selected.Notes!=""&&i.selected.Notes!=null?1:0)>0?"quick-tray__note-warning":""]])},d(i.notes.other.length+(i.selected.Notes!=""&&i.selected.Notes!=null?1:0))+" Order Note(s) ",3)]),s("button",{onClick:t[1]||(t[1]=p=>l.openNotes()),style:{padding:"4px"},class:"btn btnSize03 secondaryBtn"}," View ")])):(o(),n("span",ge))]),s("td",_e,[i.selected.PrescriptionID==a.PrescriptionID?(o(),n("div",me,[i.historyLoading?u("",!0):(o(!0),n(f,{key:0},g(l.filteredHistory,(p,k)=>(o(),n("ul",{onDblclick:v=>l.redirect(p.PrescriptionID),class:m(["new",l.statusClass(p.Status)]),key:k,title:`Order ${p.PrescriptionID} in status ${e.orderStatuses[p.Status]}. Double-click to open in new tab.`},[(o(!0),n(f,null,g(p.Products,(v,I)=>(o(),n("li",{class:"medicine",key:I},[s("a",{target:"_blank",href:`#/prescription/${p.PrescriptionID}`,style:{"margin-left":"3px"}},d(v.Name)+", "+d(v.Quantity*v.Dosage)+" "+d(v.Units)+" ("+d(p.Client)+") ",9,ke),s("div",null,[I==0?(o(),n("b",ve,[s("span",{class:m(["font-highlight",l.statusClass(p.Status)])},d(e.orderStatuses[p.Status]),3)])):u("",!0),I==0&&[8,6,3,4,12,13,14,15].includes(p.Status)?(o(),n("span",De,[s("b",null,d(p.ShippedDate.slice(0,-5)),1)])):u("",!0)])]))),128))],42,be))),128)),i.historyLoading?(o(),n("div",Ie,"Loading...")):u("",!0),!i.historyLoading&&i.history.length==0?(o(),n("div",Pe,"No previous orders available.. ")):u("",!0),!i.historyLoading&&i.history.length>3?(o(),n("div",{key:3,onClick:t[2]||(t[2]=p=>i.expandHistory=!i.expandHistory)},[i.expandHistory?(o(),n("button",Ne,[we,y("Collapse ")])):(o(),n("button",Ce,[Se,y(" Expand ("+d(i.history.length-l.filteredHistory.length)+" more entries) ",1)]))])):u("",!0)])):(o(),n("span",xe))]),s("td",Le,[i.selected.PrescriptionID==a.PrescriptionID?(o(),n("button",{key:0,disabled:i.locked||i.printing,onClick:t[3]||(t[3]=p=>l.tryPrint()),title:"Print prescription and pharmacy labels",class:"btn btnSize01 secondaryBtn"},[l.printable?(o(),n("i",Ee)):(o(),n("i",Oe))],8,Te)):u("",!0)])],42,q))),128))])])])])):u("",!0)]),_:1})}const Me=N(E,[["render",Ae]]),Be={components:{QuickTray:Me},mixins:[w],data:function(){return{idsVisible:!1,showLogs:!1,orders:[],dispensers:[],userInfo,imgMap:{3:"images/logo/tnt.png",4:"images/logo/dpd.png",5:"images/logo/rmail.png",7:"images/logo/ups.png",70:"images/logo/ups_access_point.jpg",8:"images/logo/tnt.png",10:"images/logo/dhl.png"}}},computed:{showListText(){return this.idsVisible?"Hide List of Order ID's":"Show List of Order ID's"},availableCount(){return this.orders.filter(e=>e.UserID===0).length},tray(){return this.$store.state.tray},trayIds(){return this.$store.state.tray.map(e=>e.PrescriptionID)},printLog(){return this.$store.state.printLog},trayCompany(){let e=[];return this.tray.forEach(t=>{t.DeliveryID==5&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("rml")||e.push("rml")),t.DeliveryID==4&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("dpd")||e.push("dpd")),t.DeliveryID==7&&t.PaymentMethod==0&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("ups")||e.push("ups")),t.DeliveryID==7&&t.PaymentMethod!=0&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("upscod")||e.push("upscod")),t.DeliveryID==10&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("dhl")||e.push("dhl")),t.CompanyName=="EveAdam"&&!t.JVM&&(e.includes("eveadam")||e.push("eveadam")),t.JVM==1&&(e.includes("jvm")||e.push("jvm"))}),e},count(){let e={available:0,rml:0,dpd:0,ups:0,upscod:0,dhl:0,eveadam:0,jvm:0};return this.orders.forEach(t=>{t.UserID==0&&e.available++,t.DeliveryID==5&&t.UserID==0&&e.rml++,t.DeliveryID==4&&t.UserID==0&&e.dpd++}),e}},mounted(){this.refresh(),this.emitter.on,this.emitter.on("tray.clear",()=>{this.refresh()})},methods:{getPendingOrders(){axios.post("/prescription-pool/orders-list",{ids:this.trayIds}).then(e=>{console.log("response")}).catch(e=>{this.postError(e.response.data.message)})},refresh(){this.getOrders(),this.getDispensers()},toggleOrderList(){this.idsVisible=!this.idsVisible,this.idsVisible&&this.refresh()},getOrders(){axios.get("/prescription-pool/orders").then(e=>{this.orders=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getDispensers(){axios.get("/prescription-pool/dispensers").then(e=>{this.dispensers=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},allocate(e=!1,t=!1,c=!1){axios.post("/prescription-pool/allocate",{userID:e,deliveryID:t,orderID:c}).then(h=>{this.refresh(),this.emitter.emit("tray.refresh")}).catch(h=>{this.postError(h.response.data.message)})},release(e=!1,t=!1,c=!1){c?this.checkMessage("Are you sure you want to release all orders!",()=>{this.releaseRequest(e,t,c)}):this.releaseRequest(e,t,c)},releaseRequest(e=!1,t=!1,c=!1){axios.post("/prescription-pool/release",{userID:e,dispenserPoolID:t,all:c}).then(h=>{this.refresh(),this.emitter.emit("tray.refresh")}).catch(h=>{this.postError(h.response.data.message)})},viewAssigned(){this.emitter.emit("tray.toggle")},checkMessage(e,t){this.$swal({title:"Are you sure you want to release all orders?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, release everything!"}).then(c=>{c.value&&t()})},reprint(e){this.emitter.emit("prescriptionpool.reprint",e)}}},$e={class:"content prescription-pool"},He={class:"card"},Re=s("div",{class:"card-header"},[s("h3",null,"Prescription Pool")],-1),Ue={class:"card-body",style:{display:"flex","justify-content":"space-between"}},ze=["title"],Ve=["title"],qe=["disabled"],Fe={key:0,class:"prescription-pool_print-log"},Je=s("li",{style:{"border-bottom":"1px solid gainsboro"}},"Print Log",-1),je=["href"],Qe=["onClick"],Ke={key:0,class:"card-body order-id-list"},We=s("hr",null,null,-1),Ge={key:0},Xe=s("li",{class:"pool-list-layout"},[s("div",{class:"pool-column"},[s("b",null,"Order ID")]),s("div",{class:"pool-column"},[s("b",null,"Allocated To")]),s("div",{class:"pool-column"},[s("b",null,"Type")]),s("div",{class:"pool-actions"},[s("b",null,"Tools")])],-1),Ye={class:"pool-column"},Ze={class:"pool-column"},et={key:0},tt={key:1},st={class:"pool-column"},it={key:0},ot={key:1},nt={key:2},rt={key:3},lt={key:4},at={key:5},dt={class:"pool-actions"},ct=["disabled","onClick"],ht=["disabled","onClick"],pt={key:1},ut={key:0,class:"card"},yt=s("div",{class:"card-header pool-list-layout"},[s("div",{class:"pool-column"}," Dispenser "),s("div",{class:"pool-column"}," Available Orders "),s("div",{class:"pool-actions"}," Tools ")],-1),ft={class:"card-body"},gt={class:"pool-list-layout"},_t=s("div",{class:"pool-column"},[s("b",null,"AVAILABLE IN THE POOL")],-1),mt={class:"pool-column"},bt={class:"pool-actions"},kt=s("span",{class:"ml-20"},[s("b",null,"ALLOCATE NEW (MAX 15)")],-1),vt=["disabled"],Dt=["disabled"],It={class:"pool-column"},Pt={key:0},Ct={class:"pool-column"},St={class:"pool-actions"},Nt=["title","disabled","onClick"],wt=["title","disabled","onClick"];function xt(e,t,c,h,i,l){const _=C("QuickTray");return o(),n("div",$e,[s("section",He,[Re,s("div",Ue,[s("div",null,[s("button",{class:"btn btnSize02 secondaryBtn mb-10",onClick:t[0]||(t[0]=r=>l.toggleOrderList()),title:l.showListText},d(l.showListText),9,ze),s("button",{class:"btn btnSize02 secondaryBtn mb-10",onClick:t[1]||(t[1]=r=>l.viewAssigned()),title:"View all orders assigned to you"}," View Assigned Orders "),l.printLog.length>0?(o(),n("button",{key:0,class:"btn btnSize02 secondaryBtn mb-10",onClick:t[2]||(t[2]=r=>e.showLogs=!e.showLogs)},d(e.showLogs?"Hide":"Show")+" Print Logs ",1)):u("",!0),l.tray.length>0?(o(),n("button",{key:1,title:"Release orders assigned to "+e.userInfo.name,onClick:t[3]||(t[3]=r=>l.release(e.userInfo.esa_user_id,!1)),class:"btn btnSize02 tertiaryBtn"}," Release Orders ",8,Ve)):(o(),n("button",{key:2,class:"btn btnSize02 secondaryBtn mb-10",title:"Release all assigned orders",disabled:l.count.available==e.orders.length,onClick:t[4]||(t[4]=r=>l.release(!1,!1,!0))}," Release All ",8,qe))]),D(P,{name:"fade"},{default:b(()=>[l.printLog.length>0&&e.showLogs?(o(),n("div",Fe,[s("ul",null,[Je,(o(!0),n(f,null,g(l.printLog,r=>(o(),n("li",{key:r.PrescriptionID},[s("span",null,[y(d(r.action)+" ",1),s("b",null,[s("a",{target:"_blank",href:`#/prescription/${r.PrescriptionID}`},d(r.PrescriptionID),9,je)]),y(" on "+d(new Date(r.time).toLocaleTimeString("en-GB")),1)]),s("button",{style:{padding:"4px"},class:"btn btnSize03 secondaryBtn",onClick:a=>l.reprint(r.PrescriptionID)},"Reprint",8,Qe)]))),128))])])):u("",!0)]),_:1})]),D(P,{name:"fade"},{default:b(()=>[e.idsVisible?(o(),n("div",Ke,[We,e.orders.length>0?(o(),n("ul",Ge,[Xe,(o(!0),n(f,null,g(e.orders,r=>(o(),n("li",{class:"pool-list-layout",key:r.PrescriptionID},[s("div",Ye,d(r.PrescriptionID),1),s("div",Ze,[r.name==null&&r.surname==null?(o(),n("span",et," Not Assigned ")):(o(),n("span",tt,d(r.name+" "+r.surname),1))]),s("div",st,[r.DeliveryID==5?(o(),n("b",it,"Royal Mail")):r.DeliveryID==4?(o(),n("b",ot,"DPD")):r.DeliveryID==7&&r.PaymentMethod==0?(o(),n("b",nt,"UPS")):r.DeliveryID==7&&r.PaymentMethod!=0?(o(),n("b",rt,"UPS COD")):r.DeliveryID==10?(o(),n("b",lt,"DHL")):(o(),n("b",at,"UNKNOWN"))]),s("div",dt,[s("button",{disabled:r.UserID==e.userInfo.esa_user_id||e.userInfo.role!=20,onClick:a=>l.allocate(!1,!1,r.DispenserPoolID),class:"btn btnSize02 tertiaryBtn"}," Take Over ",8,ct),s("button",{disabled:r.UserID==0,onClick:a=>l.release(!1,r.DispenserPoolID),class:"btn btnSize02 tertiaryBtn ml-20"}," Release ",8,ht)])]))),128))])):(o(),n("div",pt," No orders found "))])):u("",!0)]),_:1})]),D(_),l.tray.length==0?(o(),n("section",ut,[yt,s("div",ft,[s("ul",null,[s("li",gt,[_t,s("div",mt,[s("b",null,d(l.count.available),1)]),s("div",bt,[kt,s("button",{title:"Take over all available Royal Mail orders",disabled:e.userInfo.role!=20&&e.userInfo.role!=19||l.count.rml==0||!l.trayCompany.includes("rml")&&l.trayCompany.length>0,onClick:t[5]||(t[5]=r=>l.allocate(!1,"rml",!1)),class:"btn btnSize02 tertiaryBtn ml-20"},[y(" Royal Mail "),s("b",null,"("+d(l.count.rml)+")",1)],8,vt),s("button",{title:"Take over all available DPD orders",disabled:e.userInfo.role!=20&&e.userInfo.role!=19||l.count.dpd==0||!l.trayCompany.includes("dpd")&&l.trayCompany.length>0,onClick:t[6]||(t[6]=r=>l.allocate(!1,"dpd",!1)),class:"btn btnSize02 tertiaryBtn ml-20"},[y(" DPD "),s("b",null,"("+d(l.count.dpd)+")",1)],8,Dt)])]),(o(!0),n(f,null,g(e.dispensers,r=>(o(),n("li",{class:"pool-list-layout",key:r.id},[s("div",It,[y(d(r.name)+" ",1),r.id==e.userInfo.id?(o(),n("b",Pt,"(CURRENT USER)")):u("",!0)]),s("div",Ct,[s("b",null,d(r.count),1)]),s("div",St,[r.id!=e.userInfo.id?(o(),n("button",{key:0,title:"Take over orders assigned to "+r.name,disabled:r.count==0,onClick:a=>l.allocate(r.esa_user_id,!1,!1),class:"btn btnSize02 tertiaryBtn mr-20"}," TAKE OVER ",8,Nt)):u("",!0),s("button",{title:"Release orders assigned to "+r.name,disabled:r.count==0,onClick:a=>l.release(r.esa_user_id,!1),class:"btn btnSize02 tertiaryBtn"}," RELEASE ",8,wt)])]))),128))])])])):u("",!0)])}const Tt=N(Be,[["render",xt]]);export{Tt as default};
//# sourceMappingURL=PrescriptionPool-BnQbGrTX.js.map
