const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotesPopup-ZKq2nPkC.js","assets/app-82NRaNNR.js","assets/app-DWMI0VDG.css","assets/Modal-PiY0E_4J.js"])))=>i.map(i=>d[i]);
import{_ as w,s as x,u as P,p as T,E as L,P as E,l as N,e as C,o,h as O,j as b,c as n,m as D,a as s,g as y,t as d,b as u,F as f,f as g,n as m,T as S}from"./app-82NRaNNR.js";const A={setup(){const{tray:e}=x(P()),{addLog:t,clearLogs:h}=P();return{tray:e,addLog:t,clearLogs:h}},mixins:[T,L,E],components:{Notes:()=>N(()=>import("./NotesPopup-ZKq2nPkC.js"),__vite__mapDeps([0,1,2])),Modal:()=>N(()=>import("./Modal-PiY0E_4J.js"),__vite__mapDeps([3,1,2]))},data(){return{loading:!1,locked:!1,printing:!1,lockTimer:null,historyLoading:!1,notesLoading:!1,notesAlert:!1,duplicate:!1,notesConfirmed:!1,expandHistory:!1,orders:[],notes:[],selected:null,history:[],user:{info:userInfo,selected:userInfo.id,list:[]}}},computed:{trayIds(){return this.tray.map(e=>e.PrescriptionID)},filteredHistory(){return this.expandHistory?this.history:this.history.slice(0,3)},totalNotesCount(){return this.notes.length==0?0:this.notes.critical.length+this.notes.information.length+this.notes.other.length},printable(){let e=!1,t=!1;return this.selected.Products.forEach(c=>{c.CorrectName||(e=!0),c.CorrectUnit||(t=!0)}),this.totalNotesCount==0&&!this.duplicate&&!e&&!t?!0:!!this.notesConfirmed}},mounted(){this.getOrders(),this.emitter.on("prescriptionpool.getnotes",this.getNotes),this.emitter.on("orderupdate",this.getNotes),this.emitter.on("alertupdate",this.getNotes),this.emitter.on("prescriptionpool.reprint",this.reprint),this.lockTimer=setInterval(()=>{this.checkLock()},5e3)},destroyed(){this.emitter.off("prescriptionpool.getnotes",this.getNotes),this.emitter.off("orderupdate",this.getNotes),this.emitter.off("alertupdate",this.getNotes),this.emitter.off("prescriptionpool.reprint",this.reprint),clearInterval(this.lockTimer)},watch:{trayIds(e,t){this.getOrders(),t.length==0&&e.length>0&&this.clearLogs()},selected(){this.getHistory(),this.getNotes()},locked(){this.locked||this.getOrders(()=>{let e=JSON.parse(JSON.stringify(this.selected));this.selected=null,this.selectOrder(e),this.takeOverOrder(this.selected.PrescriptionID)})}},methods:{selectOrder(e){this.selected=e,this.selected.Products.forEach(t=>{t.Name!=t.Description?this.alternativeNameCheck(t,this.selected.ClientID,h=>{t.CorrectName=h}):t.CorrectName=!0,t.Unit!=t.product_units?this.alternativeUnitCheck(t,this.selected.ClientID,h=>{t.CorrectUnit=h}):t.CorrectUnit=!0}),this.checkLock(()=>{this.locked||this.takeOverOrder(this.selected.PrescriptionID),this.emitter.emit("prescriptionloaded",{prescription:e})}),this.checkOrderStatuses(this.selected.PrescriptionID)},getOrders(e=!1){this.loading=!0,axios.post("/prescription-pool/quick-tray",{ids:this.trayIds}).then(t=>{this.orders=t.data.data,this.orders.length>0&&!e?this.selectOrder(this.orders[0]):e&&e()}).catch(t=>{console.log(t)}).finally(()=>{this.loading=!1})},checkOrderStatuses(e){axios.get(`/order/${e}/statuses`).then(t=>{this.duplicate=t.data.data.duplicate}).catch(t=>{this.postError(t.response.data.message)})},getHistory(){this.historyLoading=!0,axios.get(`/order/${this.selected.PrescriptionID}/history`).then(e=>{this.expandHistory=!1,this.history=e.data.data}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.historyLoading=!1})},getNotes(){this.notesLoading=!0,this.notesConfirmed=!1,axios.get(`/order/${this.selected.PrescriptionID}/notes`).then(e=>{if(this.notes=e.data.data,this.notes.alerts.length>0){let t=`
                    <div class="medicineDetails" style="width: 100%;">
                    <p>Please review the notes below:</p>
                    <ul class="other">`,h=0,c=0;this.notes.alerts.sort((i,a)=>i.Type>a.Type?1:-1),this.notes.alerts.forEach(i=>{i.DeletedAt==null&&i.EditedAt==null&&(h++,i.Type!=c&&(c=i.Type,t+=`<li class="note-header ${c==1?"note-header__danger":""}"><div>${c==1?"Patient Notes":"Order Notes"}</div></li>`),t+=`
                            <li class="note"
                            title="${i.Type==2?"Queried Alert":i.Type==1?"Patient Alert":"Order Alert"} created by ${i.name} ${i.surname}"
                            style="${i.Type==2?"border-left: 5px solid #32a36a;":i.Type==1?"border-left: 5px solid #ff5151;":""}">
                            <div class="note-body" style="text-align: initial;">
                            <p>${i.Note}</p>
                            </div>
                            <div class="note-footer">
                            <span>${i.name+" "+i.surname}</span>
                            <span>${i.CreatedAt}</span>
                            </div>
                            </li>`)}),t+="</ul></div>",h>0?this.notesAlert=t:this.notesAlert=!1}else this.notesAlert=!1}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.notesLoading=!1})},tryPrint(){this.printable?(this.printing=!0,this.dispenserPrint("delivery",!1,()=>{this.dispenserPrint("label",!1,()=>{this.selected.time=Date.now(),this.selected.action="Printed",this.addLog(this.selected),this.emitter.emit("tray.changeprescriptionstatus",{id:this.selected.PrescriptionID,status:7}),this.printing=!1})})):this.openNotes()},reprint(e){this.dispenserPrint("delivery",e),this.dispenserPrint("label",e);let t={PrescriptionID:e,action:"Reprinted",time:Date.now()};this.addLog(t)},dispenserPrint(e,t=!1,h=!1){t||(t=this.selected.PrescriptionID),e=="delivery"?axios.get(`/order/${t}/view`).then(c=>{let i=c.data.data.url,a=c.data.data.type,_=!1;if(localStorage.getItem("settings.application")&&(_=JSON.parse(localStorage.getItem("settings.application")).deliveryNotePrinter),a=="pdf")this.printUrl(`${i}?token=${this.user.info.token}&print=true`,()=>{this.emitter.emit("orderupdate"),h&&h()},"pdf",_);else{let r=`https://esasys.co.uk/?showFile&PRESCRIPTIONID=${t}`;this.printUrl(r,()=>{axios.get(`/prescription/${t}/log-print?token=${this.user.info.token}`).then(l=>{this.emitter.emit("orderupdate"),h&&h()}).catch(l=>{console.log(l),this.postError(l.response.data.message)})},"pdf",_)}}).catch(c=>{this.postError(c.response.data.message)}):e=="label"&&axios.get(`/order/${t}/label`).then(c=>{let i=c.data.data.url,a=!1;localStorage.getItem("settings.application")&&(a=JSON.parse(localStorage.getItem("settings.application")).labelPrinter),this.printUrl(`${i}?token=${this.user.info.token}&print=true`,()=>{this.emitter.emit("orderupdate"),h&&h()},"pdf",a,!0)}).catch(c=>{console.log(c),this.postError(c.response.data.message)})},openNotes(){this.emitter.emit("modal.open","quicktraynotes")},confirmNotes(){this.notesConfirmed=!0,this.emitter.emit("modal.close","quicktraynotes")},showNotesAlert(){this.$swal({title:"Important notes!",html:this.notesAlert,type:"warning",showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,focusConfirm:!1,confirmButtonColor:"#3085d6",confirmButtonText:"I've read these notes!"}).then(e=>{e.value&&(this.notesAlert=!1)})},statusClass(e){return[1,7].includes(e)?"active":[2,8].includes(e)?"success":[4,5,9,10,11,12,13,14,15].includes(e)?"warning":[16].includes(e)?"returned":[3,6].includes(e)?"error":""},checkLock(e=!1){this.selected&&axios.get(`/logs/locked/${this.selected.PrescriptionID}`).then(t=>{t.data.data?this.locked=t.data.data.Name+" "+t.data.data.Surname:this.locked=!1}).catch(t=>{console.log(t),this.locked=!1}).finally(()=>{e&&e()})},unlockOrder(e){axios.post(`logs/unlock/${e}`).then(t=>{this.locked=!1}).catch(t=>{console.log(t),this.locked=!1})},takeOverOrder(e){axios.post(`logs/takeover/${e}`).then(t=>{this.locked=!1}).catch(t=>{console.log(t),this.locked=!1})},alternativeNameCheck(e,t,h){axios.get(`/inventory/products/alternative-name?code=${e.ProductCodeID}&name=${encodeURI(e.Description)}&client=${t}`).then(c=>{h(c.data.data)}).catch(c=>{this.postError(c.response.data.message)})},alternativeUnitCheck(e,t,h){axios.get(`/inventory/products/alternative-unit?code=${e.ProductCodeID}&unit=${encodeURI(e.Unit)}&client=${t}`).then(c=>{h(c.data.data)}).catch(c=>{this.postError(c.response.data.message)})},discrepancyResolution(e,t=!1){e?(this.loading=!0,axios.post("/inventory/products/approve-discrepancy",{ProductCodeID:t.ProductCodeID,ClientID:this.prescription.ClientID,UserID:this.userInfo.id,AlternativeName:t.Description}).then(h=>{this.postSuccess("Alternative name approved"),this.loading=!1,this.search()}).catch(h=>{this.loading=!1,this.postError(h.response.data.message)})):(this.prescriptionStatus=91,this.updateStatus())},redirect(e){this.$router.push({name:"prescription",params:{id:e}})}}},M={key:0,class:"card quick-tray"},B=s("h2",null,"Notes and Alerts",-1),H={style:{width:"100%",height:"100%",display:"flex","flex-direction":"column"}},R={style:{margin:"5px"}},U={key:0,style:{background:"#f53c38","font-size":"20px",padding:"5px",width:"100%"},class:"infoBox warning thin-error"},$=["href"],z=["href"],V={class:"card-header"},q={class:"card-body",style:{padding:"0"}},F=s("thead",null,[s("tr",null,[s("th",null,"Prescription"),s("th",null,"Patient"),s("th",null,"Products"),s("th",null,"Notes"),s("th",null,"History"),s("th",{style:{"text-align":"center"}},"Print")])],-1),J=["onDblclick","onClick"],j=["href"],Q={class:"mb-5"},K=["innerHTML"],W={class:"mb-5"},G={class:"mb-5"},X=["innerHTML"],Y={key:0,style:{background:"#fe4949",color:"white","text-align":"center",padding:"3px"}},Z=["title"],ee=["innerHTML"],te={key:0,class:"mt-5"},se=["innerHTML"],ie={key:0},oe={key:0},ne={title:"",style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"},re=["href"],le=["innerHTML"],ae={key:0,class:"quick-tray__fridge"},de=["title"],ce=["title"],he={style:{"max-width":"350px","font-size":"11px"}},pe={key:1},ue=["innerHTML"],ye={key:0,class:"quick-tray__fridge"},fe=s("b",null,"Fridge",-1),ge=[fe],_e={key:0,style:{display:"flex","justify-content":"space-between","flex-direction":"column"}},me={key:1},be={style:{width:"500px"}},ke={key:0,class:"medicineHistory notranslate quick-tray__history"},ve=["onDblclick","title"],De=["href"],Ie={key:0},Pe={key:1},Ce={key:1},Se={key:2},Ne={key:0,style:{padding:"4px",width:"100%"},class:"btn btnSize03 secondaryBtn"},we=s("i",{class:"fa fa-caret-down",style:{"padding-right":"5px"}},null,-1),xe={key:1,style:{padding:"4px",width:"100%"},class:"btn btnSize03 secondaryBtn"},Le=s("i",{class:"fa fa-caret-up",style:{"padding-right":"5px"}},null,-1),Te={key:1},Ee={style:{"vertical-align":"middle","text-align":"center"}},Oe=["disabled"],Ae={key:0,style:{"font-size":"25px"},class:"fa fa-print"},Me={key:1,style:{"font-size":"25px"},class:"fa fa-exclamation-circle"};function Be(e,t,h,c,i,a){const _=C("Notes"),r=C("Modal");return o(),O(S,{name:"fade"},{default:b(()=>[i.orders.length>0?(o(),n("section",M,[D(r,{class:"duplicate-modal","modal-name":"quicktraynotes"},{header:b(()=>[B]),body:b(()=>[s("div",H,[s("div",null,[s("ul",R,[i.duplicate?(o(),n("li",U,[y(" There is a possible duplicate order with ID "),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}},d(i.duplicate.PrescriptionID),9,$),y(" that has the same customer reference id "+d(i.duplicate.ReferenceID)+" with status "+d(e.orderStatuses[i.duplicate.Status])+d(i.duplicate.SubStatus?` -
                                    ${e.orderSubStatuses[i.duplicate.SubStatus]}`:"")+". Please investigate by clicking ",1),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}}," here ",8,z),y(" before processing. ")])):u("",!0),!e.product.CorrectName||!e.product.CorrectUnit?(o(!0),n(f,{key:1},g(i.selected.Products,(l,p)=>(o(),n("li",{key:p,style:{background:"#f53c38","font-size":"20px",padding:"5px",width:"100%","margin-top":"5px"},class:"infoBox warning thin-error"},[s("span",null," The product name recieved by "+d(i.selected.CompanyName)+" ("+d(l.Description)+" "+d(l.Unit)+") does not match the product name or it's alternatives in ESA ("+d(l.Name)+" "+d(l.product_units)+") ",1)]))),128)):u("",!0)])]),D(_,{locked:i.locked,notes:i.notes,prescription:i.selected},null,8,["locked","notes","prescription"])])]),footer:b(()=>[s("button",{onClick:t[0]||(t[0]=l=>a.confirmNotes()),class:"btn btnSize01 primaryBtn bigButton"},"I'VE READ THESE NOTES!")]),_:1}),s("div",V,[s("h3",null,"Pending Orders ("+d(i.orders.length)+")",1)]),s("div",q,[s("table",null,[F,s("tbody",null,[(o(!0),n(f,null,g(i.orders,l=>(o(),n("tr",{class:m(["clickable quick-tray__item",[i.selected.PrescriptionID==l.PrescriptionID?"selected":"",i.locked&&i.selected.PrescriptionID==l.PrescriptionID?"locked":""]]),onDblclick:p=>a.redirect(l.PrescriptionID),key:l.PrescriptionID,onClick:p=>a.selectOrder(l)},[s("td",null,[s("a",{href:`#/prescription/${l.PrescriptionID}`},[s("div",Q,[s("span",{innerHTML:l.ReferenceID},null,8,K)]),s("div",W,[s("b",null,d(l.CompanyName),1)]),s("div",G,[s("span",{innerHTML:l.Prescriber},null,8,X)]),i.locked&&i.selected.PrescriptionID==l.PrescriptionID?(o(),n("div",Y,[s("b",null,"This item is currently opened by "+d(i.locked),1)])):u("",!0)],8,j)]),s("td",{title:`${l.Sex==1?"Male":l.Sex==2?"Female":l.Sex==3?"Transgender":"Other"} born on ${l.DOB} with a BMI of ${l.BMI}`},[s("span",{style:{padding:"2px"},class:m(["gender",[l.Sex==1?"blue":l.Sex==2?"purple":l.Sex==3?"orange":"grey"]])},[s("span",{innerHTML:l["Patient Name"]},null,8,ee),s("small",null," ("+d(l.Age)+" / "+d(l.Sex==1?"Male":l.Sex==2?"Female":l.Sex==3?"Transgender":"Other")+") ",1)],2),i.selected.PrescriptionID==l.PrescriptionID?(o(),n("div",te,[s("span",{innerHTML:l["Patient Address"]},null,8,se)])):u("",!0)],8,Z),s("td",null,[i.selected.PrescriptionID==l.PrescriptionID?(o(),n("ul",ie,[i.duplicate?(o(),n("li",oe,[s("b",ne,[y(" Possible duplicate order with ID "),s("a",{target:"_blank",href:`#/prescription/${i.duplicate.PrescriptionID}`,style:{color:"#A9E2F3"}},d(i.duplicate.PrescriptionID),9,re),y(" and status "+d(e.orderStatuses[i.duplicate.Status])+d(i.duplicate.SubStatus?` -
                                            ${e.orderSubStatuses[i.duplicate.SubStatus]}`:"")+". ",1)])])):u("",!0),(o(!0),n(f,null,g(l.Products,(p,k)=>(o(),n("li",{key:k},[s("b",null,[s("span",{innerHTML:p.ShortName},null,8,le),y(),p.Fridge?(o(),n("span",ae,"Fridge")):u("",!0)]),p.CorrectName?u("",!0):(o(),n("b",{key:0,title:`The product name recieved by ${i.selected.CompanyName} (${p.Description}) does not match the product name or it's alternatives in ESA (${p.Name})`,style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"}," Name Mismatch ",8,de)),p.CorrectUnit?u("",!0):(o(),n("b",{key:1,title:`The product name recieved by ${i.selected.CompanyName} (${p.Description}) does not match the product name or it's alternatives in ESA (${p.Name})`,style:{background:"#f53c38","font-size":"14px","padding-bottom":"0","padding-top":"0"},class:"infoBox warning thin-error"}," Unit Mismatch ",8,ce)),s("div",he,d(p.Instructions),1)]))),128))])):(o(),n("ul",pe,[(o(!0),n(f,null,g(l.Products,(p,k)=>(o(),n("li",{key:k},[s("span",{innerHTML:p.ShortName},null,8,ue),y(),p.Fridge?(o(),n("span",ye,ge)):u("",!0)]))),128))]))]),s("td",null,[i.selected.PrescriptionID==l.PrescriptionID?(o(),n("div",_e,[s("div",null,[s("div",{class:m(["quick-tray__note",[i.notes.critical.length>0?"quick-tray__note-warning":""]])},d(i.notes.critical.length)+" Patient Note(s) ",3),s("div",{class:m(["quick-tray__note",[i.notes.correspondence.length+i.notes.information.length>0?"quick-tray__note-warning":""]])},d(i.notes.correspondence.length+i.notes.information.length)+" Queried Note(s) ",3),s("div",{class:m(["quick-tray__note",[i.notes.other.length+(i.selected.Notes!=""&&i.selected.Notes!=null?1:0)>0?"quick-tray__note-warning":""]])},d(i.notes.other.length+(i.selected.Notes!=""&&i.selected.Notes!=null?1:0))+" Order Note(s) ",3)]),s("button",{onClick:t[1]||(t[1]=p=>a.openNotes()),style:{padding:"4px"},class:"btn btnSize03 secondaryBtn"}," View ")])):(o(),n("span",me))]),s("td",be,[i.selected.PrescriptionID==l.PrescriptionID?(o(),n("div",ke,[i.historyLoading?u("",!0):(o(!0),n(f,{key:0},g(a.filteredHistory,(p,k)=>(o(),n("ul",{onDblclick:v=>a.redirect(p.PrescriptionID),class:m(["new",a.statusClass(p.Status)]),key:k,title:`Order ${p.PrescriptionID} in status ${e.orderStatuses[p.Status]}. Double-click to open in new tab.`},[(o(!0),n(f,null,g(p.Products,(v,I)=>(o(),n("li",{class:"medicine",key:I},[s("a",{target:"_blank",href:`#/prescription/${p.PrescriptionID}`,style:{"margin-left":"3px"}},d(v.Name)+", "+d(v.Quantity*v.Dosage)+" "+d(v.Units)+" ("+d(p.Client)+") ",9,De),s("div",null,[I==0?(o(),n("b",Ie,[s("span",{class:m(["font-highlight",a.statusClass(p.Status)])},d(e.orderStatuses[p.Status]),3)])):u("",!0),I==0&&[8,6,3,4,12,13,14,15].includes(p.Status)?(o(),n("span",Pe,[s("b",null,d(p.ShippedDate.slice(0,-5)),1)])):u("",!0)])]))),128))],42,ve))),128)),i.historyLoading?(o(),n("div",Ce,"Loading...")):u("",!0),!i.historyLoading&&i.history.length==0?(o(),n("div",Se,"No previous orders available.. ")):u("",!0),!i.historyLoading&&i.history.length>3?(o(),n("div",{key:3,onClick:t[2]||(t[2]=p=>i.expandHistory=!i.expandHistory)},[i.expandHistory?(o(),n("button",xe,[Le,y("Collapse ")])):(o(),n("button",Ne,[we,y(" Expand ("+d(i.history.length-a.filteredHistory.length)+" more entries) ",1)]))])):u("",!0)])):(o(),n("span",Te))]),s("td",Ee,[i.selected.PrescriptionID==l.PrescriptionID?(o(),n("button",{key:0,disabled:i.locked||i.printing,onClick:t[3]||(t[3]=p=>a.tryPrint()),title:"Print prescription and pharmacy labels",class:"btn btnSize01 secondaryBtn"},[a.printable?(o(),n("i",Ae)):(o(),n("i",Me))],8,Oe)):u("",!0)])],42,J))),128))])])])])):u("",!0)]),_:1})}const He=w(A,[["render",Be]]),Re={setup(){const{printLog:e,tray:t}=x(P());return{printLog:e,tray:t}},components:{QuickTray:He},mixins:[L],data:function(){return{idsVisible:!1,showLogs:!1,orders:[],dispensers:[],userInfo,imgMap:{3:"images/logo/tnt.png",4:"images/logo/dpd.png",5:"images/logo/rmail.png",7:"images/logo/ups.png",70:"images/logo/ups_access_point.jpg",8:"images/logo/tnt.png",10:"images/logo/dhl.png"}}},computed:{showListText(){return this.idsVisible?"Hide List of Order ID's":"Show List of Order ID's"},availableCount(){return this.orders.filter(e=>e.UserID===0).length},trayIds(){return this.tray.map(e=>e.PrescriptionID)},trayCompany(){let e=[];return this.tray.forEach(t=>{t.DeliveryID==5&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("rml")||e.push("rml")),t.DeliveryID==4&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("dpd")||e.push("dpd")),t.DeliveryID==7&&t.PaymentMethod==0&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("ups")||e.push("ups")),t.DeliveryID==7&&t.PaymentMethod!=0&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("upscod")||e.push("upscod")),t.DeliveryID==10&&t.CompanyName!="EveAdam"&&!t.JVM&&(e.includes("dhl")||e.push("dhl")),t.CompanyName=="EveAdam"&&!t.JVM&&(e.includes("eveadam")||e.push("eveadam")),t.JVM==1&&(e.includes("jvm")||e.push("jvm"))}),e},count(){let e={available:0,rml:0,dpd:0,ups:0,upscod:0,dhl:0,eveadam:0,jvm:0};return this.orders.forEach(t=>{t.UserID==0&&e.available++,t.DeliveryID==5&&t.UserID==0&&e.rml++,t.DeliveryID==4&&t.UserID==0&&e.dpd++}),e}},mounted(){this.refresh(),this.emitter.on,this.emitter.on("tray.clear",()=>{this.refresh()})},methods:{getPendingOrders(){axios.post("/prescription-pool/orders-list",{ids:this.trayIds}).then(e=>{console.log("response")}).catch(e=>{this.postError(e.response.data.message)})},refresh(){this.getOrders(),this.getDispensers()},toggleOrderList(){this.idsVisible=!this.idsVisible,this.idsVisible&&this.refresh()},getOrders(){axios.get("/prescription-pool/orders").then(e=>{this.orders=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},getDispensers(){axios.get("/prescription-pool/dispensers").then(e=>{this.dispensers=e.data.data}).catch(e=>{this.postError(e.response.data.message)})},allocate(e=!1,t=!1,h=!1){axios.post("/prescription-pool/allocate",{userID:e,deliveryID:t,orderID:h}).then(c=>{this.refresh(),this.emitter.emit("tray.refresh")}).catch(c=>{this.postError(c.response.data.message)})},release(e=!1,t=!1,h=!1){h?this.checkMessage("Are you sure you want to release all orders!",()=>{this.releaseRequest(e,t,h)}):this.releaseRequest(e,t,h)},releaseRequest(e=!1,t=!1,h=!1){axios.post("/prescription-pool/release",{userID:e,dispenserPoolID:t,all:h}).then(c=>{this.refresh(),this.emitter.emit("tray.refresh")}).catch(c=>{this.postError(c.response.data.message)})},viewAssigned(){this.emitter.emit("tray.toggle")},checkMessage(e,t){this.$swal({title:"Are you sure you want to release all orders?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, release everything!"}).then(h=>{h.value&&t()})},reprint(e){this.emitter.emit("prescriptionpool.reprint",e)}}},Ue={class:"content prescription-pool"},$e={class:"card"},ze=s("div",{class:"card-header"},[s("h3",null,"Prescription Pool")],-1),Ve={class:"card-body",style:{display:"flex","justify-content":"space-between"}},qe=["title"],Fe=["title"],Je=["disabled"],je={key:0,class:"prescription-pool_print-log"},Qe=s("li",{style:{"border-bottom":"1px solid gainsboro"}},"Print Log",-1),Ke=["href"],We=["onClick"],Ge={key:0,class:"card-body order-id-list"},Xe=s("hr",null,null,-1),Ye={key:0},Ze=s("li",{class:"pool-list-layout"},[s("div",{class:"pool-column"},[s("b",null,"Order ID")]),s("div",{class:"pool-column"},[s("b",null,"Allocated To")]),s("div",{class:"pool-column"},[s("b",null,"Type")]),s("div",{class:"pool-actions"},[s("b",null,"Tools")])],-1),et={class:"pool-column"},tt={class:"pool-column"},st={key:0},it={key:1},ot={class:"pool-column"},nt={key:0},rt={key:1},lt={key:2},at={key:3},dt={key:4},ct={key:5},ht={class:"pool-actions"},pt=["disabled","onClick"],ut=["disabled","onClick"],yt={key:1},ft={key:0,class:"card"},gt=s("div",{class:"card-header pool-list-layout"},[s("div",{class:"pool-column"}," Dispenser "),s("div",{class:"pool-column"}," Available Orders "),s("div",{class:"pool-actions"}," Tools ")],-1),_t={class:"card-body"},mt={class:"pool-list-layout"},bt=s("div",{class:"pool-column"},[s("b",null,"AVAILABLE IN THE POOL")],-1),kt={class:"pool-column"},vt={class:"pool-actions"},Dt=s("span",{class:"ml-20"},[s("b",null,"ALLOCATE NEW (MAX 15)")],-1),It=["disabled"],Pt=["disabled"],Ct={class:"pool-column"},St={key:0},Nt={class:"pool-column"},wt={class:"pool-actions"},xt=["title","disabled","onClick"],Lt=["title","disabled","onClick"];function Tt(e,t,h,c,i,a){const _=C("QuickTray");return o(),n("div",Ue,[s("section",$e,[ze,s("div",Ve,[s("div",null,[s("button",{class:"btn btnSize02 secondaryBtn mb-10",onClick:t[0]||(t[0]=r=>a.toggleOrderList()),title:a.showListText},d(a.showListText),9,qe),s("button",{class:"btn btnSize02 secondaryBtn mb-10",onClick:t[1]||(t[1]=r=>a.viewAssigned()),title:"View all orders assigned to you"}," View Assigned Orders "),c.printLog.length>0?(o(),n("button",{key:0,class:"btn btnSize02 secondaryBtn mb-10",onClick:t[2]||(t[2]=r=>e.showLogs=!e.showLogs)},d(e.showLogs?"Hide":"Show")+" Print Logs ",1)):u("",!0),c.tray.length>0?(o(),n("button",{key:1,title:"Release orders assigned to "+e.userInfo.name,onClick:t[3]||(t[3]=r=>a.release(e.userInfo.esa_user_id,!1)),class:"btn btnSize02 tertiaryBtn"}," Release Orders ",8,Fe)):(o(),n("button",{key:2,class:"btn btnSize02 secondaryBtn mb-10",title:"Release all assigned orders",disabled:a.count.available==e.orders.length,onClick:t[4]||(t[4]=r=>a.release(!1,!1,!0))}," Release All ",8,Je))]),D(S,{name:"fade"},{default:b(()=>[c.printLog.length>0&&e.showLogs?(o(),n("div",je,[s("ul",null,[Qe,(o(!0),n(f,null,g(c.printLog,(r,l)=>(o(),n("li",{key:l},[s("span",null,[y(d(r.action)+" ",1),s("b",null,[s("a",{target:"_blank",href:`#/prescription/${r.PrescriptionID}`},d(r.PrescriptionID),9,Ke)]),y(" on "+d(new Date(r.time).toLocaleTimeString("en-GB")),1)]),s("button",{style:{padding:"4px"},class:"btn btnSize03 secondaryBtn",onClick:p=>a.reprint(r.PrescriptionID)},"Reprint",8,We)]))),128))])])):u("",!0)]),_:1})]),D(S,{name:"fade"},{default:b(()=>[e.idsVisible?(o(),n("div",Ge,[Xe,e.orders.length>0?(o(),n("ul",Ye,[Ze,(o(!0),n(f,null,g(e.orders,r=>(o(),n("li",{class:"pool-list-layout",key:r.PrescriptionID},[s("div",et,d(r.PrescriptionID),1),s("div",tt,[r.name==null&&r.surname==null?(o(),n("span",st," Not Assigned ")):(o(),n("span",it,d(r.name+" "+r.surname),1))]),s("div",ot,[r.DeliveryID==5?(o(),n("b",nt,"Royal Mail")):r.DeliveryID==4?(o(),n("b",rt,"DPD")):r.DeliveryID==7&&r.PaymentMethod==0?(o(),n("b",lt,"UPS")):r.DeliveryID==7&&r.PaymentMethod!=0?(o(),n("b",at,"UPS COD")):r.DeliveryID==10?(o(),n("b",dt,"DHL")):(o(),n("b",ct,"UNKNOWN"))]),s("div",ht,[s("button",{disabled:r.UserID==e.userInfo.esa_user_id||e.userInfo.role!=20,onClick:l=>a.allocate(!1,!1,r.DispenserPoolID),class:"btn btnSize02 tertiaryBtn"}," Take Over ",8,pt),s("button",{disabled:r.UserID==0,onClick:l=>a.release(!1,r.DispenserPoolID),class:"btn btnSize02 tertiaryBtn ml-20"}," Release ",8,ut)])]))),128))])):(o(),n("div",yt," No orders found "))])):u("",!0)]),_:1})]),D(_),c.tray.length==0?(o(),n("section",ft,[gt,s("div",_t,[s("ul",null,[s("li",mt,[bt,s("div",kt,[s("b",null,d(a.count.available),1)]),s("div",vt,[Dt,s("button",{title:"Take over all available Royal Mail orders",disabled:e.userInfo.role!=20&&e.userInfo.role!=19||a.count.rml==0||!a.trayCompany.includes("rml")&&a.trayCompany.length>0,onClick:t[5]||(t[5]=r=>a.allocate(!1,"rml",!1)),class:"btn btnSize02 tertiaryBtn ml-20"},[y(" Royal Mail "),s("b",null,"("+d(a.count.rml)+")",1)],8,It),s("button",{title:"Take over all available DPD orders",disabled:e.userInfo.role!=20&&e.userInfo.role!=19||a.count.dpd==0||!a.trayCompany.includes("dpd")&&a.trayCompany.length>0,onClick:t[6]||(t[6]=r=>a.allocate(!1,"dpd",!1)),class:"btn btnSize02 tertiaryBtn ml-20"},[y(" DPD "),s("b",null,"("+d(a.count.dpd)+")",1)],8,Pt)])]),(o(!0),n(f,null,g(e.dispensers,r=>(o(),n("li",{class:"pool-list-layout",key:r.id},[s("div",Ct,[y(d(r.name)+" ",1),r.id==e.userInfo.id?(o(),n("b",St,"(CURRENT USER)")):u("",!0)]),s("div",Nt,[s("b",null,d(r.count),1)]),s("div",wt,[r.id!=e.userInfo.id?(o(),n("button",{key:0,title:"Take over orders assigned to "+r.name,disabled:r.count==0,onClick:l=>a.allocate(r.esa_user_id,!1,!1),class:"btn btnSize02 tertiaryBtn mr-20"}," TAKE OVER ",8,xt)):u("",!0),s("button",{title:"Release orders assigned to "+r.name,disabled:r.count==0,onClick:l=>a.release(r.esa_user_id,!1),class:"btn btnSize02 tertiaryBtn"}," RELEASE ",8,Lt)])]))),128))])])])):u("",!0)])}const Ot=w(Re,[["render",Tt]]);export{Ot as default};
//# sourceMappingURL=PrescriptionPool-LO461Fcw.js.map
