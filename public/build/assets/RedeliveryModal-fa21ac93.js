import{E as l,e as c,h,n as u}from"./app-a3e6dddd.js";import f from"./Modal-76bda924.js";const m={extends:f,props:["orderID"],mixins:[l,c],components:{DiffTableAddress:h},data(){return{selected:!1,loading:!1,watch:!1,countries:[],companies:[],details:{order:{},oldOrder:{},ups:{},oldUps:{},details:{}},saveConfirmation:!1,confirmationChanges:{},confirmationChangesUPS:{},confirmationOld:{},confirmationOldUPS:{},disabledFields:[]}},mounted(){},computed:{columnDelivery(){return["DAddress1","DAddress2","DAddress3","DAddress4","DPostcode","DCountryCode","DeliveryID"]}},watch:{"details.order.DCountryCode":function(){this.watch&&this.getDeliveryCompany()},"details.order.DeliveryID":function(){this.watch&&this.getPostcodeFormatting()}},methods:{getOrderDetails(s=!1){this.watch=!1,axios.get("/order-edit/"+this.orderID).then(e=>{this.details=e.data.data,s&&(this.details.order.DAddress1="",this.details.order.DAddress2="",this.details.order.DAddress3="",this.details.order.DAddress4="",this.details.order.DPostcode=""),this.loading=!1}).catch(e=>{this.postError(e.response.data.message),this.loading=!1}).finally(()=>{this.watch=!0})},close(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationOld={},this.confirmationOld={},this.confirmationOldUPS={},this.details={order:{},oldOrder:{},ups:{},oldUps:{}},this.$emit("closeredelivery")},back(){this.saveConfirmation=!1,this.confirmationChanges={},this.confirmationChangesUPS={}},redelivery(){this.loading=!0,axios.post(`/order/${this.orderID}/redeliver`).then(s=>{this.postSuccess(s.data.message),this.show.modal=!1,this.$root.$emit("orderupdate"),this.close()}).catch(s=>{this.postError(s.response.data.message)}).finally(()=>{this.loading=!1})},selectAddressUpdate(){this.selected=!0,this.getCountries(),this.getCompanies(),this.getOrderDetails(!0)},updateAddress(){},getCountries(){axios.get("/countries").then(s=>{this.countries=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},getCompanies(){axios.get("/delivery-companies").then(s=>{this.companies=s.data.data}).catch(s=>{this.postError(s.response.data.message)})},validateAddress(s=!1){this.loadingValidation=!0,axios.post(`/api/validate-address/${this.currentOrderID}`).then(e=>{this.postSuccess(e.data.message),s&&s()}).catch(e=>{this.postError(e.response.data.message)}).finally(()=>{this.loadingValidation=!1,this.search()})},getCounterColor(s,e){if(e[s]!=null&&this.alias[s].value){if(e[s].length>0&&this.alias[s].combined&&e[this.alias[s].combined]!=null)return e[s].length+e[this.alias[s].combined].length<=this.alias[s].value?"input-count-success":"input-count-danger";if(e[s].length>0&&e[s].length<=this.alias[s].value)return"input-count-success";if(e[s].length>this.alias[s].value)return"input-count-danger"}return""},getDeliveryCompany(){axios.post(`/order-edit/${this.orderID}/delivery-company`,this.details.order).then(s=>{let e=s.data.data;e.DeliveryID&&(this.details.order.DeliveryID=e.DeliveryID),e.CountryCode&&(this.details.order.CountryCode=e.CountryCode),this.getPostcodeFormatting(),this.postSuccess("Delivery company updated")}).catch(s=>{this.postError(s.response.data.message)})},getPostcodeFormatting(){this.details.order.DeliveryID==10&&axios.post(`/order-edit/${this.orderID}/postcode-formatting`,this.details.order).then(s=>{let e=s.data.data;e.Postcode&&(this.details.order.Postcode=e.Postcode),e.DPostcode&&(this.details.order.DPostcode=e.DPostcode)}).catch(s=>{this.postError(s.response.data.message)})},save(s=!1){if(this.saveConfirmation)this.submit(s);else{let e=JSON.parse(JSON.stringify(this.details.order));delete e.ClientID,axios.post(`/order-edit/check/${this.orderID}`,{order:e,ups:this.details.ups}).then(t=>{Object.keys(t.data.data.changes).length>0||Object.keys(t.data.data.changesUPS).length?(this.confirmationChanges=t.data.data.changes,this.confirmationChangesUPS=t.data.data.changesUPS,this.confirmationOld=t.data.data.old,this.confirmationOldUPS=t.data.data.oldUPS,this.saveConfirmation=!0):this.saveConfirmation=!1}).catch(t=>{this.saveConfirmation=!1,this.postError(t)})}},submit(s=!1){let e=JSON.parse(JSON.stringify(this.details.order));delete e.ClientID,this.loading=!0,axios.post(`/api/validate-address/${this.orderID}`,{addressChange:e}).then(t=>{t.data.success?(this.postSuccess("Address Validated"),axios.post("/order-edit/"+this.orderID,{order:e,ups:this.details.ups}).then(a=>{this.postSuccess("Saved"),this.redelivery()}).catch(a=>{this.postError(a)}).finally(()=>{this.saveConfirmation=!1,this.loading=!1})):this.postError("Could not validate address")}).catch(t=>{this.postError(t),this.loading=!1})},isEqual:_.isEqual}};var p=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"fade"}},[t("div",{staticClass:"esa-modal"},[t("div",{staticClass:"backdrop",on:{click:function(a){return e.close()}}}),t("div",{staticClass:"modal"},[t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"loader"},[e._v("Loading...")])]),t("div",{staticClass:"modal-header"},[t("h3",[e._v("Redelivery")])]),t("div",{staticClass:"modal-body"},[e.selected?e._e():t("div",{staticClass:"redelivery-selection",staticStyle:{width:"100%","text-align":"center"}},[t("h3",{staticStyle:{"text-align":"center"}},[e._v("Please select the method of redelivery")]),t("br"),t("button",{staticClass:"btn btnSize01 secondaryBtn",on:{click:function(a){return e.redelivery()}}},[e._v("Redelivery to Existing Address")]),t("button",{staticClass:"btn btnSize01 secondaryBtn",on:{click:function(a){return e.selectAddressUpdate()}}},[e._v("Redelivery to New Address")])]),e.selected?t("div",{staticClass:"redelivery-selection",staticStyle:{width:"100%","align-self":"flex-start"}},[t("transition",{attrs:{name:"fade"}},[e.countries.length!=0&&e.companies.length!=0&&!e.loading&&Object.keys(e.confirmationChanges).length==0&&Object.keys(e.confirmationChangesUPS).length==0?t("form",{staticClass:"pxp-form address-form mb-20",on:{submit:function(a){return a.preventDefault(),e.save.apply(null,arguments)}}},[t("div",{staticClass:"form-column",staticStyle:{width:"100%"}},[t("h3",[e._v("Delivery Details")]),e._l(e.details.order,function(a,i){return e.columnDelivery.includes(i)?t("div",{key:i,staticClass:"form-group form-group-2"},[t("label",{attrs:{for:a}},[e._v(e._s(e.alias[i].title))]),e.alias[i].value?t("label",{staticClass:"input-count",class:e.getCounterColor(i,e.details.order),attrs:{for:a}},[e._v(e._s(e.details.order[i]?e.details.order[i].length:0)+"/"+e._s(e.alias[i].value))]):e._e(),["JVM","UPSAccessPointAddress","CountryCode","DCountryCode","DeliveryID","Notes"].includes(i)?["DCountryCode","CountryCode"].includes(i)?t("select",{directives:[{name:"model",rawName:"v-model",value:e.details.order[i],expression:"details.order[value]"}],class:[e.details.order[i]&&e.details.order[i]!=""?"select-dropdown-active":""],on:{change:function(r){var n=Array.prototype.filter.call(r.target.options,function(o){return o.selected}).map(function(o){var d="_value"in o?o._value:o.value;return d});e.$set(e.details.order,i,r.target.multiple?n:n[0])}}},e._l(e.countries,function(r){return t("option",{domProps:{value:r.CountryID}},[e._v(e._s(r.Name)+" ")])}),0):["DeliveryID"].includes(i)?t("select",{directives:[{name:"model",rawName:"v-model",value:e.details.order[i],expression:"details.order[value]"}],class:[e.details.order[i]&&e.details.order[i]!=""?"select-dropdown-active":""],on:{change:function(r){var n=Array.prototype.filter.call(r.target.options,function(o){return o.selected}).map(function(o){var d="_value"in o?o._value:o.value;return d});e.$set(e.details.order,i,r.target.multiple?n:n[0])}}},e._l(e.companies,function(r){return t("option",{domProps:{value:r.SettingID}},[e._v(e._s(r.Name)+" ")])}),0):e._e():t("input",{directives:[{name:"model",rawName:"v-model",value:e.details.order[i],expression:"details.order[value]"}],attrs:{disabled:e.disabledFields.includes(i),name:a,placeholder:""},domProps:{value:e.details.order[i]},on:{input:function(r){r.target.composing||e.$set(e.details.order,i,r.target.value)}}})]):e._e()})],2)]):e._e()]),t("transition",{attrs:{name:"fade"}},[(Object.keys(e.confirmationChanges).length>0||Object.keys(e.confirmationChangesUPS).length>0)&&!e.loading?t("div",{staticClass:"pxp-form mb-20",staticStyle:{height:"auto"}},[t("div",{staticClass:"infoBox warning"},[t("p",[e._v("Please review and confirm all the changes in the order before saving!")])]),t("DiffTableAddress",{attrs:{"old-object":e.confirmationOld,"new-object":e.confirmationChanges,"old-object-u-p-s":e.confirmationOldUPS,"new-object-u-p-s":e.confirmationChangesUPS,"countries-prop":e.countries,"companies-prop":e.companies}})],1):e._e()])],1):e._e()]),t("div",{staticClass:"modal-footer"},[!e.isEqual(e.details.order,e.details.oldOrder)||!e.isEqual(e.details.ups,e.details.oldUPS)&&e.selected&&!e.loading?t("button",{staticClass:"btn btnSize01 tertiaryBtn bigButton",attrs:{disabled:e.loading},on:{click:function(a){return e.save()}}},[e.saveConfirmation?t("span",[e._v(" Save and Redeliver ")]):t("span",[e._v(" Review ")])]):e._e(),(!e.isEqual(e.details.order,e.details.oldOrder)||!e.isEqual(e.details.ups,e.details.oldUPS))&&e.saveConfirmation?t("button",{staticClass:"btn btnSize01 tertiaryBtn bigButton",attrs:{disabled:e.loading},on:{click:function(a){return e.back()}}},[t("span",[e._v(" Back ")])]):e._e(),t("button",{staticClass:"btn btnSize01 secondaryBtn bigButton",attrs:{disabled:e.loading},on:{click:function(a){return e.close()}}},[e._v(" Cancel ")])]),t("span",{staticClass:"close",on:{click:function(a){return e.close()}}},[e._v("X")])],1)])])},g=[],v=u(m,p,g,!1,null,null,null,null);const D=v.exports;export{D as default};
